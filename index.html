<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Empire Maritime - Gestionnaire de Port</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Orbitron', monospace;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
            background-attachment: fixed;
            color: var(--text-color);
            overflow-x: hidden;
            touch-action: pan-y; /* Permettre le d√©filement vertical uniquement */
            -webkit-overflow-scrolling: touch;
            /* Optimisations fluidit√© */
            will-change: scroll-position;
            -webkit-transform: translateZ(0);
            transform: translateZ(0);
        }

        /* Optimisations sp√©cifiques mobile */
        @media (max-width: 768px) {
            body {
                background-attachment: scroll; /* D√©sactiver fixed sur mobile pour performance */
                touch-action: pan-y pan-x pinch-zoom; /* Permettre tous les gestes de d√©filement */
                -webkit-overflow-scrolling: touch; /* D√©filement fluide iOS */
                overscroll-behavior: contain; /* √âviter le rebond excessif */
            }
        }

        @media (max-width: 480px) {
            body {
                font-size: 14px; /* L√©g√®rement plus petit sur tr√®s petits √©crans */
                line-height: 1.5;
            }
        }

        /* Grille cyberpunk anim√©e en arri√®re-plan */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(rgba(0, 255, 255, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 255, 255, 0.03) 1px, transparent 1px);
            background-size: 50px 50px;
            animation: gridMove 20s linear infinite;
            z-index: -1;
            pointer-events: none; /* Important pour ne pas bloquer les interactions tactiles */
        }

        /* Optimisations globales mobile */
        @media (max-width: 768px) {
            body::before {
                animation: none; /* D√©sactiver l'animation sur mobile pour performance */
                background-size: 30px 30px; /* Grille plus petite sur mobile */
            }
        }

        @keyframes gridMove {
            0% { transform: translate(0, 0); }
            100% { transform: translate(50px, 50px); }
        }

        /* Variables CSS futuristes */
        :root {
            --primary-color: #00ffff;
            --secondary-color: #ff00ff;
            --accent-color: #00ff41;
            --success-color: #00ff88;
            --warning-color: #ffff00;
            --danger-color: #ff0080;
            --dark-bg: rgba(0, 0, 0, 0.8);
            --glass-bg: rgba(0, 20, 40, 0.3);
            --neon-glow: 0 0 20px currentColor, 0 0 40px currentColor, 0 0 60px currentColor;
            --border-radius: 8px;
            --shadow-light: 0 0 10px rgba(0, 255, 255, 0.3);
            --shadow-medium: 0 0 20px rgba(0, 255, 255, 0.4), 0 0 40px rgba(255, 0, 255, 0.2);
            --shadow-heavy: 0 0 30px rgba(0, 255, 255, 0.6), 0 0 60px rgba(255, 0, 255, 0.4);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
            touch-action: pan-y; /* Permettre le d√©filement vertical */
            -webkit-overflow-scrolling: touch;
        }

        /* Optimisations container mobile */
        @media (max-width: 768px) {
            .container {
                padding: 15px 10px;
                max-width: 100%;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 10px 8px;
            }
        }

        .header {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 2px solid var(--primary-color);
            padding: 20px 25px;
            border-radius: var(--border-radius);
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            box-shadow: var(--shadow-medium);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 255, 255, 0.1), transparent);
            animation: hologramScan 3s linear infinite;
            pointer-events: none;
        }

        @keyframes hologramScan {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .header:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-heavy);
            border-color: var(--accent-color);
        }

        .logo {
            font-size: 28px;
            font-weight: 700;
            color: var(--primary-color);
            text-shadow: var(--neon-glow);
            display: flex;
            align-items: center;
            gap: 10px;
            animation: neonPulse 2s ease-in-out infinite alternate;
            position: relative;
            z-index: 2;
        }

        @keyframes neonPulse {
            0% { 
                text-shadow: 
                    0 0 5px var(--primary-color),
                    0 0 10px var(--primary-color),
                    0 0 15px var(--primary-color);
            }
            100% { 
                text-shadow: 
                    0 0 10px var(--primary-color),
                    0 0 20px var(--primary-color),
                    0 0 30px var(--primary-color),
                    0 0 40px var(--primary-color);
            }
        }

        .logo::before {
            content: "üöÄ";
            font-size: 32px;
            filter: drop-shadow(0 0 10px var(--accent-color));
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-5px) rotate(5deg); }
        }

        .resources {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .resource {
            background: rgba(0, 20, 40, 0.95);
            backdrop-filter: blur(10px);
            border: 2px solid var(--primary-color);
            padding: 12px 18px;
            border-radius: var(--border-radius);
            font-size: 16px;
            font-weight: 700;
            transition: var(--transition);
            box-shadow: var(--shadow-light);
            display: flex;
            align-items: center;
            gap: 8px;
            position: relative;
            overflow: hidden;
            color: #ffffff;
            text-shadow: 0 0 15px currentColor, 0 2px 4px rgba(0, 0, 0, 0.8);
        }

        .resource::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 255, 255, 0.2), transparent);
            transition: left 0.5s;
            pointer-events: none;
        }

        .resource:hover::before {
            left: 100%;
        }

        .resource:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
            border-color: var(--accent-color);
            text-shadow: 0 0 20px currentColor, 0 2px 4px rgba(0, 0, 0, 0.8);
            background: rgba(0, 30, 60, 0.98);
        }

        .fuel-resource {
            border-color: var(--warning-color);
            color: #ffff00;
            background: rgba(40, 40, 0, 0.95);
            text-shadow: 0 0 15px #ffff00, 0 2px 4px rgba(0, 0, 0, 0.8);
            font-weight: 700;
        }

        .fuel-resource:hover {
            border-color: var(--warning-color);
            box-shadow: 0 0 20px rgba(255, 255, 0, 0.5);
        }

        .navigation {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 12px;
            margin-bottom: 25px;
            padding: 0 5px;
            touch-action: pan-y; /* Permettre le d√©filement vertical */
            -webkit-overflow-scrolling: touch;
            /* Optimisations fluidit√© */
            will-change: transform;
            -webkit-transform: translateZ(0);
            transform: translateZ(0);
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
        }

        /* Optimisations navigation mobile */
        @media (max-width: 768px) {
            body {
                background-attachment: scroll; /* Plus fluide sur mobile */
            }
            
            .navigation {
                grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
                gap: 8px;
                padding: 0 10px;
                margin-bottom: 20px;
                /* Optimisations suppl√©mentaires mobile */
                contain: layout style paint;
                isolation: isolate;
            }
        }

        @media (max-width: 480px) {
            .navigation {
                grid-template-columns: repeat(2, 1fr); /* 2 colonnes sur tr√®s petits √©crans */
                gap: 6px;
                padding: 0 8px;
                /* Performance maximale sur petits √©crans */
                transform: translate3d(0, 0, 0);
                -webkit-transform: translate3d(0, 0, 0);
            }
        }

        .nav-btn {
            position: relative;
            padding: 14px 20px;
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            border: 2px solid var(--primary-color);
            border-radius: var(--border-radius);
            color: var(--primary-color);
            font-weight: 600;
            font-size: 13px;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: var(--shadow-light);
            overflow: hidden;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
            touch-action: manipulation; /* Optimiser pour les taps */
            -webkit-tap-highlight-color: rgba(0, 255, 255, 0.3);
            user-select: none;
            /* Optimisations fluidit√© */
            will-change: transform, box-shadow;
            -webkit-transform: translateZ(0);
            transform: translateZ(0);
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Optimisations boutons navigation mobile */
        @media (max-width: 768px) {
            .nav-btn {
                padding: 16px 12px; /* Plus de padding vertical pour faciliter les taps */
                font-size: 12px;
                min-height: 48px; /* Taille minimale recommand√©e pour mobile */
                gap: 6px;
                /* R√©duction des effets sur mobile pour plus de fluidit√© */
                backdrop-filter: blur(5px);
                transition: transform 0.2s ease-out, box-shadow 0.2s ease-out;
            }
            
            .nav-btn::before {
                display: none; /* Supprimer l'effet de balayage sur mobile */
            }
        }

        @media (max-width: 480px) {
            .nav-btn {
                padding: 18px 8px;
                font-size: 11px;
                min-height: 52px; /* Encore plus grand sur tr√®s petits √©crans */
                letter-spacing: 0.5px;
                /* Performance maximale */
                backdrop-filter: none;
                background: rgba(0, 20, 40, 0.8);
                transition: transform 0.15s ease-out;
            }
            
            .nav-btn:active {
                transform: scale(0.98) translateZ(0);
            }
        }

        .nav-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 255, 255, 0.3), transparent);
            transition: left 0.5s;
            pointer-events: none;
        }

        .nav-btn:hover::before {
            left: 100%;
        }

        .nav-btn:hover {
            transform: translateY(-2px) translateZ(0);
            box-shadow: var(--shadow-medium);
            border-color: var(--accent-color);
            color: var(--accent-color);
            text-shadow: 0 0 10px currentColor;
        }

        .nav-btn.active {
            background: rgba(0, 255, 65, 0.1);
            border-color: var(--accent-color);
            color: var(--accent-color);
            box-shadow: var(--shadow-heavy);
            transform: translateY(-1px);
            text-shadow: 0 0 15px currentColor;
        }

        .nav-btn.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--accent-color);
            box-shadow: 0 0 10px var(--accent-color);
            animation: activeGlow 2s ease-in-out infinite alternate;
            pointer-events: none;
        }

        @keyframes activeGlow {
            0% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        .screen {
            display: none;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 2px solid var(--primary-color);
            border-radius: var(--border-radius);
            padding: 30px;
            min-height: 65vh;
            box-shadow: var(--shadow-medium);
            position: relative;
            overflow: hidden;
        }

        .screen::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                repeating-linear-gradient(
                    0deg,
                    transparent,
                    transparent 2px,
                    rgba(0, 255, 255, 0.03) 2px,
                    rgba(0, 255, 255, 0.03) 4px
                );
            pointer-events: none;
            animation: scanlines 0.1s linear infinite;
        }

        @keyframes scanlines {
            0% { transform: translateY(0); }
            100% { transform: translateY(4px); }
        }

        .screen::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 255, 255, 0.1), transparent);
            animation: hologramSweep 4s linear infinite;
            pointer-events: none;
        }

        @keyframes hologramSweep {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .screen.active {
            display: block;
            animation: slideInUp 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes slideInUp {
            from { 
                opacity: 0; 
                transform: translateY(30px) scale(0.95);
            }
            to { 
                opacity: 1; 
                transform: translateY(0) scale(1);
            }
        }

        .screen h2 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 20px;
            color: var(--accent-color);
            text-shadow: 0 0 20px currentColor;
            display: flex;
            align-items: center;
            gap: 12px;
            text-transform: uppercase;
            letter-spacing: 2px;
            position: relative;
            z-index: 2;
        }

        .ships-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .ship-card {
            background: var(--glass-bg);
            backdrop-filter: blur(15px);
            border-radius: var(--border-radius);
            padding: 25px;
            border: 2px solid var(--primary-color);
            transition: var(--transition);
            box-shadow: var(--shadow-light);
            position: relative;
            overflow: hidden;
        }

        .ship-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, var(--accent-color), var(--primary-color));
            transform: scaleX(0);
            transition: transform 0.3s ease;
            box-shadow: 0 0 10px currentColor;
            pointer-events: none;
        }

        .ship-card::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                repeating-linear-gradient(
                    45deg,
                    transparent,
                    transparent 20px,
                    rgba(0, 255, 255, 0.02) 20px,
                    rgba(0, 255, 255, 0.02) 22px
                );
            pointer-events: none;
        }

        .ship-card:hover::before {
            transform: scaleX(1);
        }

        .ship-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-heavy);
            border-color: var(--accent-color);
            background: rgba(0, 255, 255, 0.05);
        }

        .ship-card.traveling {
            border-color: var(--warning-color);
            background: rgba(255, 255, 0, 0.05);
            animation: travelPulse 2s ease-in-out infinite alternate;
        }

        @keyframes travelPulse {
            0% { 
                box-shadow: 0 0 20px rgba(255, 255, 0, 0.3);
            }
            100% { 
                box-shadow: 0 0 30px rgba(255, 255, 0, 0.6);
            }
        }

        .ship-card.traveling::before {
            background: linear-gradient(90deg, var(--warning-color), var(--danger-color));
            transform: scaleX(1);
            animation: energyFlow 1s linear infinite;
        }

        @keyframes energyFlow {
            0% { background-position: 0% 50%; }
            100% { background-position: 100% 50%; }
        }

        .ship-status {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .ship-name {
            font-size: 18px;
            font-weight: bold;
            color: #00d4ff;
        }

        .status-badge {
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
        }

        .status-available {
            background: #00b894;
            color: white;
        }

        .status-traveling {
            background: #fdcb6e;
            color: #2d3436;
        }

        .ship-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 15px 0;
        }

        .stat {
            text-align: center;
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
        }

        .stat-value {
            font-size: 20px;
            font-weight: bold;
            color: #00d4ff;
        }

        .stat-label {
            font-size: 12px;
            opacity: 0.8;
        }

        .destinations-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
            touch-action: pan-y; /* Permettre le d√©filement vertical */
            -webkit-overflow-scrolling: touch;
        }

        /* Optimisations grilles mobile */
        @media (max-width: 768px) {
            .destinations-grid {
                grid-template-columns: 1fr; /* Une seule colonne sur mobile */
                gap: 15px;
                margin-top: 15px;
            }
        }

        @media (max-width: 480px) {
            .destinations-grid {
                gap: 12px;
                margin-top: 12px;
            }
        }

        .destination-card {
            background: var(--glass-bg);
            backdrop-filter: blur(15px);
            border-radius: var(--border-radius);
            padding: 20px;
            cursor: pointer;
            transition: var(--transition);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: var(--shadow-light);
            position: relative;
            overflow: hidden;
        }

        .destination-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, var(--accent-color), var(--success-color));
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .destination-card:hover::before {
            transform: scaleX(1);
        }

        .destination-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-heavy);
            border-color: rgba(255, 255, 255, 0.3);
            background: rgba(255, 255, 255, 0.15);
        }

        .destination-card.insufficient-fuel {
            border-color: var(--danger-color);
            background: linear-gradient(135deg, rgba(255, 107, 107, 0.1), rgba(214, 48, 49, 0.1));
        }

        .destination-card.insufficient-fuel::before {
            background: linear-gradient(90deg, var(--danger-color), #e74c3c);
            transform: scaleX(1);
        }

        .destination-name {
            font-size: 16px;
            font-weight: bold;
            color: #00d4ff;
            margin-bottom: 8px;
        }

        .destination-info {
            font-size: 14px;
            opacity: 0.9;
        }

        .fuel-cost {
            background: rgba(255, 193, 7, 0.2);
            border-radius: 10px;
            padding: 5px 8px;
            margin: 5px 0;
            font-weight: bold;
            color: #ffc107;
        }

        .btn {
            position: relative;
            padding: 14px 24px;
            background: var(--glass-bg);
            border: 2px solid var(--accent-color);
            border-radius: var(--border-radius);
            color: var(--accent-color);
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: var(--transition);
            width: 100%;
            margin-top: 12px;
            box-shadow: var(--shadow-light);
            overflow: hidden;
            text-transform: uppercase;
            letter-spacing: 1px;
            backdrop-filter: blur(10px);
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 255, 65, 0.3), transparent);
            transition: left 0.5s;
            pointer-events: none;
        }

        .btn::after {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(45deg, transparent 30%, rgba(0, 255, 65, 0.1) 50%, transparent 70%);
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:hover::after {
            opacity: 1;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
            background: rgba(0, 255, 65, 0.1);
            text-shadow: 0 0 10px currentColor;
        }

        .btn:active {
            transform: translateY(0);
            box-shadow: var(--shadow-light);
        }

        .btn:disabled {
            background: var(--glass-bg);
            border-color: #636e72;
            color: #636e72;
            cursor: not-allowed;
            transform: none;
            opacity: 0.4;
        }

        .btn:disabled::before,
        .btn:disabled::after {
            display: none;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid var(--primary-color);
            border-radius: var(--border-radius);
            overflow: hidden;
            margin: 15px 0;
            position: relative;
            box-shadow: inset 0 0 10px rgba(0, 255, 255, 0.2);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-color), var(--primary-color));
            transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: var(--border-radius);
            position: relative;
            box-shadow: 0 0 15px currentColor;
            animation: energyPulse 2s ease-in-out infinite alternate;
        }

        @keyframes energyPulse {
            0% { 
                box-shadow: 0 0 10px currentColor;
                filter: brightness(1);
            }
            100% { 
                box-shadow: 0 0 20px currentColor, 0 0 30px currentColor;
                filter: brightness(1.2);
            }
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            animation: dataStream 1.5s linear infinite;
            pointer-events: none;
        }

        @keyframes dataStream {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .ship-animation {
            position: relative;
            width: 100%;
            height: 40px;
            background: linear-gradient(to right, #0984e3, #74b9ff, #0984e3);
            border-radius: 20px;
            margin: 10px 0;
            overflow: hidden;
        }

        .sailing-ship {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            font-size: 24px;
            animation: sailing 3s ease-in-out infinite;
            z-index: 2;
        }

        .wave {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 200%;
            height: 20px;
            background: repeating-linear-gradient(
                90deg,
                rgba(255,255,255,0.1) 0px,
                rgba(255,255,255,0.2) 10px,
                rgba(255,255,255,0.1) 20px
            );
            animation: waves 2s linear infinite;
        }

        @keyframes sailing {
            0%, 100% { transform: translateY(-50%) rotate(-2deg); }
            50% { transform: translateY(-50%) rotate(2deg); }
        }

        @keyframes waves {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }

        .ship-trail {
            position: absolute;
            top: 50%;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(to right, transparent, rgba(255,255,255,0.3), transparent);
            transform: translateY(-50%);
            animation: trail 4s ease-in-out infinite;
        }

        @keyframes trail {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 0.8; }
        }

        .shop-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .shop-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
        }

        .shop-item h3 {
            color: #00d4ff;
            margin-bottom: 10px;
        }

        .price {
            font-size: 18px;
            font-weight: bold;
            color: #fdcb6e;
            margin: 10px 0;
        }

        .refinery-section {
            background: rgba(255, 193, 7, 0.1);
            border: 2px solid #ffc107;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .refinery-title {
            color: #ffc107;
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .fuel-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .maintenance-progress {
            margin: 10px 0;
            padding: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
        }

        .maintenance-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            overflow: hidden;
            margin: 5px 0;
        }

        .maintenance-fill {
            height: 100%;
            transition: all 0.3s ease;
            border-radius: 4px;
        }

        .maintenance-fill.good {
            background: linear-gradient(90deg, #00b894, #00cec9);
        }

        .maintenance-fill.warning {
            background: linear-gradient(90deg, #fdcb6e, #e17055);
        }

        .maintenance-fill.critical {
            background: linear-gradient(90deg, #d63031, #e84393);
        }

        .maintenance-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
            opacity: 0.9;
        }

        .fuel-option {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
        }

        .fuel-amount {
            font-size: 24px;
            font-weight: bold;
            color: #ffc107;
            margin: 10px 0;
        }

        .save-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .save-btn {
            flex: 1;
            padding: 10px;
            background: linear-gradient(45deg, #00b894, #00a085);
            border: none;
            border-radius: 20px;
            color: white;
            font-weight: bold;
            cursor: pointer;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
            backdrop-filter: blur(5px);
            touch-action: pan-y; /* Permettre le d√©filement dans les modales */
            -webkit-overflow-scrolling: touch;
            overflow-y: auto; /* Permettre le d√©filement si contenu trop grand */
        }

        /* Optimisations modales mobile */
        @media (max-width: 768px) {
            .modal {
                padding: 10px; /* Ajouter du padding pour √©viter les bords */
            }
            to { opacity: 1; }
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 35px;
            border-radius: var(--border-radius);
            max-width: 90vw;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-heavy);
            animation: modalSlideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes modalSlideIn {
            from { 
                opacity: 0; 
                transform: translate(-50%, -50%) scale(0.9) translateY(20px);
            }
            to { 
                opacity: 1; 
                transform: translate(-50%, -50%) scale(1) translateY(0);
            }
        }

        .close {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            color: #ddd;
            transition: var(--transition);
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
        }

        .close:hover {
            color: var(--danger-color);
            background: rgba(255, 107, 107, 0.2);
            transform: rotate(90deg);
        }

        .notification {
            position: fixed;
            top: 25px;
            right: 25px;
            background: linear-gradient(45deg, var(--success-color), var(--accent-color));
            color: white;
            padding: 16px 24px;
            border-radius: var(--border-radius);
            z-index: 1001;
            display: none;
            box-shadow: var(--shadow-heavy);
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            animation: notificationSlideIn 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            max-width: 350px;
            font-weight: 500;
        }

        @keyframes notificationSlideIn {
            from { 
                opacity: 0; 
                transform: translateX(100%) scale(0.8);
            }
            to { 
                opacity: 1; 
                transform: translateX(0) scale(1);
            }
        }

        .admin-section {
            background: var(--glass-bg);
            backdrop-filter: blur(15px);
            border-radius: var(--border-radius);
            padding: 25px;
            margin: 25px 0;
            border: 1px solid var(--danger-color);
            box-shadow: var(--shadow-medium);
            position: relative;
            overflow: hidden;
        }

        .admin-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, var(--danger-color), var(--warning-color));
        }

        .admin-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }

        .admin-card {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--border-radius);
            padding: 25px;
            transition: var(--transition);
            box-shadow: var(--shadow-light);
        }

        .admin-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-medium);
            background: rgba(255, 255, 255, 0.15);
        }

        .admin-card h3 {
            color: var(--accent-color);
            margin-bottom: 15px;
            font-size: 18px;
            font-weight: 600;
        }

        .admin-input {
            width: 100%;
            padding: 12px 16px;
            margin: 8px 0 18px 0;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(5px);
            color: white;
            font-size: 14px;
            transition: var(--transition);
        }

        .admin-input:focus {
            outline: none;
            border-color: var(--accent-color);
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
        }

        .admin-input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .btn {
            background: linear-gradient(135deg, #00b894, #00cec9);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 184, 148, 0.3);
        }

        .btn.maintenance-preventive {
            background: linear-gradient(135deg, #fdcb6e, #e17055);
            box-shadow: 0 4px 15px rgba(253, 203, 110, 0.3);
        }

        .btn.maintenance-emergency {
            background: linear-gradient(135deg, #d63031, #e84393);
            box-shadow: 0 4px 15px rgba(214, 48, 49, 0.3);
        }

        .admin-btn {
            background: linear-gradient(45deg, #e17055, #d63031);
            border: none;
            border-radius: 10px;
            color: white;
            padding: 10px 15px;
            margin: 5px;
            cursor: pointer;
            font-weight: bold;
        }

        .admin-btn:hover {
            transform: scale(1.05);
        }

        .admin-warning {
            background: rgba(231, 112, 85, 0.2);
            border: 1px solid #e17055;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            color: #fdcb6e;
            font-weight: bold;
        }

        .sell-ship-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            border: 2px solid transparent;
            transition: all 0.3s ease;
            position: relative;
        }

        .sell-ship-card:hover {
            border-color: #fdcb6e;
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(253, 203, 110, 0.2);
        }

        .sell-ship-card.not-sellable {
            opacity: 0.6;
            border-color: #636e72;
            background: rgba(99, 110, 114, 0.2);
        }

        .sell-ship-card.not-sellable:hover {
            transform: none;
            border-color: #636e72;
        }

        .sell-price {
            background: rgba(253, 203, 110, 0.2);
            border: 1px solid #fdcb6e;
            border-radius: 10px;
            padding: 10px;
            margin: 10px 0;
            text-align: center;
            font-weight: bold;
            color: #fdcb6e;
        }

        .sell-btn {
            background: linear-gradient(45deg, #fdcb6e, #e17055);
            border: none;
            border-radius: 25px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            padding: 12px 20px;
            margin-top: 10px;
        }

        .sell-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(253, 203, 110, 0.4);
        }

        .sell-btn:disabled {
            background: #636e72;
            cursor: not-allowed;
            transform: none;
        }

        .not-sellable-reason {
            background: rgba(214, 48, 49, 0.2);
            border: 1px solid #d63031;
            border-radius: 8px;
            padding: 8px;
            margin-top: 10px;
            font-size: 12px;
            color: #fab1a0;
            text-align: center;
        }

        .editor-btn {
            transition: all 0.3s ease;
        }

        .editor-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        .route-form input, .route-form textarea {
            transition: all 0.3s ease;
        }

        .route-form input:focus, .route-form textarea:focus {
            outline: none;
            border-color: #74b9ff;
            box-shadow: 0 0 10px rgba(116, 185, 255, 0.3);
        }

        @media (max-width: 768px) {
            .container {
                padding: 5px;
            }

            .header {
                flex-direction: column;
                gap: 10px;
            }

            .resources {
                justify-content: center;
            }

            .nav-btn {
                font-size: 11px;
                padding: 10px 6px;
            }

            .ships-grid {
                grid-template-columns: 1fr;
            }

            .destinations-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">üö¢ Empire Maritime</div>
            <div class="resources">
                <div class="resource">üí∞ <span id="money">1000</span>‚Ç¨</div>
                <div class="resource fuel-resource">‚õΩ <span id="fuel">100</span>L</div>
                <div class="resource" style="background: rgba(0, 212, 255, 0.2); border: 1px solid #00d4ff;">üë• <span id="header-passengers">300</span></div>
                <div class="resource">‚öì <span id="reputation">0</span></div>
                <div class="resource">üèÜ <span id="level">1</span></div>
            </div>
        </div>

        <div class="save-buttons">
            <button class="save-btn" onclick="saveGame()">üíæ Sauvegarder</button>
            <button class="save-btn" onclick="loadGame()">üìÇ Charger</button>
            <button class="save-btn" onclick="resetGame()" style="background: linear-gradient(45deg, #e17055, #d63031);">üîÑ Reset</button>
        </div>

        <div class="navigation">
            <button class="nav-btn active" onclick="showScreen('fleet')">üö¢ Flotte</button>
            <button class="nav-btn" onclick="showScreen('destinations')">üó∫Ô∏è Destinations</button>
            <button class="nav-btn" onclick="showScreen('shop')">üõí Boutique</button>
            <button class="nav-btn" onclick="showScreen('sell')">üí∞ Vente</button>
            <button class="nav-btn" onclick="showScreen('clients')">üë• Clients</button>
            <button class="nav-btn" onclick="showScreen('editor')">üó∫Ô∏è √âditeur</button>
            <button class="nav-btn" onclick="showScreen('admin')">‚öôÔ∏è Admin</button>
            <button class="nav-btn" onclick="showScreen('gasfactory')">üè≠ Usine √† Gasoil</button>
            <button class="nav-btn" onclick="showScreen('stats')">üìä Statistiques</button>
        </div>

        <div id="fleet-screen" class="screen active">
            <h2>üö¢ Votre Flotte</h2>
            <div id="ships-container" class="ships-grid"></div>
        </div>

        <div id="destinations-screen" class="screen">
            <h2>üó∫Ô∏è Destinations Disponibles</h2>
            <div id="selected-ship-info"></div>
            <div id="destinations-container" class="destinations-grid"></div>
        </div>

        <div id="shop-screen" class="screen">
            <h2>üõí Boutique Maritime</h2>
            
            <div class="refinery-section">
                <div class="refinery-title">
                    <span>‚õΩ</span> Raffinerie de Carburant
                </div>
                <p style="opacity: 0.9; margin-bottom: 15px;">Achetez du gasoil pour alimenter vos navires. Chaque destination n√©cessite du carburant pour le voyage.</p>
                
                <div class="fuel-controls">
                    <div class="fuel-option">
                        <h4>Petit Plein</h4>
                        <div class="fuel-amount">50L</div>
                        <div class="price">100‚Ç¨</div>
                        <button class="btn" onclick="buyFuel(50, 100)">Acheter</button>
                    </div>
                    <div class="fuel-option">
                        <h4>Plein Moyen</h4>
                        <div class="fuel-amount">150L</div>
                        <div class="price">280‚Ç¨</div>
                        <button class="btn" onclick="buyFuel(150, 280)">Acheter</button>
                    </div>
                    <div class="fuel-option">
                        <h4>Grand Plein</h4>
                        <div class="fuel-amount">500L</div>
                        <div class="price">900‚Ç¨</div>
                        <button class="btn" onclick="buyFuel(500, 900)">Acheter</button>
                    </div>
                    <div class="fuel-option">
                        <h4>Plein Maximum</h4>
                        <div class="fuel-amount">1000L</div>
                        <div class="price">1600‚Ç¨</div>
                        <button class="btn" onclick="buyFuel(1000, 1600)">Acheter</button>
                    </div>
                </div>
            </div>

            <h3 style="margin-top: 30px; margin-bottom: 20px;">üö¢ Navires</h3>
            <div id="shop-container" class="shop-grid"></div>
        </div>

        <div id="sell-screen" class="screen">
            <h2>üí∞ Vente de Navires</h2>
            <p style="opacity: 0.9; margin-bottom: 20px;">Vendez vos navires pour r√©cup√©rer de la liquidit√©. Prix de vente : 70% du prix d'achat.</p>
            
            <div class="sell-warning" style="background: rgba(255, 193, 7, 0.2); border: 1px solid #ffc107; border-radius: 10px; padding: 15px; margin-bottom: 20px;">
                ‚ö†Ô∏è <strong>Attention :</strong> Vous ne pouvez pas vendre un navire en voyage. Vous devez garder au moins 1 navire.
            </div>
            
            <div id="sell-ships-container" class="ships-grid"></div>
        </div>

        <div id="clients-screen" class="screen">
            <h2>üèÜ Pool Global de Passagers</h2>
            <p style="opacity: 0.9; margin-bottom: 20px;">G√©rez votre pool global de passagers et lancez des promotions pour augmenter la demande.</p>
            
            <!-- Pool Principal -->
            <div class="pool-main" style="background: linear-gradient(135deg, rgba(0, 212, 255, 0.15), rgba(116, 185, 255, 0.15)); border: 2px solid #00d4ff; border-radius: 20px; padding: 30px; margin-bottom: 30px; text-align: center;">
                <div style="font-size: 18px; color: #00d4ff; margin-bottom: 10px; font-weight: bold;">üèä POOL GLOBAL DE PASSAGERS</div>
                <div style="font-size: 48px; font-weight: bold; color: #00d4ff; margin: 15px 0;" id="global-passenger-pool">300</div>
                <div style="font-size: 16px; opacity: 0.8; margin-bottom: 15px;">passagers en attente de transport</div>
                
                <div style="display: flex; justify-content: center; align-items: center; gap: 20px; margin-top: 20px;">
                    <div style="background: rgba(0, 184, 148, 0.2); padding: 10px 15px; border-radius: 10px; font-size: 14px;">
                        <span style="color: #00b894; font-weight: bold;">üìà +<span id="next-generation">15</span> dans <span id="time-to-next">25</span> min</span>
                    </div>
                    <div style="background: rgba(253, 203, 110, 0.2); padding: 10px 15px; border-radius: 10px; font-size: 14px;">
                        <span style="color: #fdcb6e; font-weight: bold;">üéÜ <span id="active-promos-count">0</span> promotions actives</span>
                    </div>
                </div>
            </div>
            
            <!-- Indicateur de Capacit√© -->
            <div class="capacity-indicator" style="background: rgba(255, 255, 255, 0.05); border-radius: 15px; padding: 20px; margin-bottom: 25px;">
                <h3 style="color: #74b9ff; margin-bottom: 15px;">‚öôÔ∏è √âtat de la Flotte</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div class="fleet-stat" style="text-align: center; padding: 15px; background: rgba(116, 185, 255, 0.1); border-radius: 10px;">
                        <div style="font-size: 24px; font-weight: bold; color: #74b9ff;" id="total-fleet-capacity">360</div>
                        <div style="font-size: 12px; opacity: 0.8;">Capacit√© Totale Flotte</div>
                    </div>
                    <div class="fleet-stat" style="text-align: center; padding: 15px; background: rgba(0, 184, 148, 0.1); border-radius: 10px;">
                        <div style="font-size: 24px; font-weight: bold; color: #00b894;" id="available-ships">3</div>
                        <div style="font-size: 12px; opacity: 0.8;">Navires Disponibles</div>
                    </div>
                    <div class="fleet-stat" style="text-align: center; padding: 15px;" id="pool-status-indicator">
                        <div style="font-size: 24px; font-weight: bold;" id="pool-status-text">‚úÖ</div>
                        <div style="font-size: 12px; opacity: 0.8;" id="pool-status-desc">Pool Suffisant</div>
                    </div>
                </div>
            </div>
            
            <!-- Centre Promotionnel Nouveau Syst√®me -->
            <div class="promotion-panel" style="background: rgba(255, 193, 7, 0.1); border: 1px solid #ffc107; border-radius: 15px; padding: 20px; margin-bottom: 20px;">
                <h3 style="color: #ffc107; margin-bottom: 15px;">üéÜ Centre Promotionnel - Pool Global</h3>
                
                <!-- Promotions Instantan√©es -->
                <div style="margin-bottom: 20px;">
                    <h4 style="color: #fdcb6e; margin-bottom: 10px;">‚ö° Boost Instantan√©</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 10px;">
                        <button class="promo-btn" onclick="launchPoolPromotion('boost_small')" style="background: linear-gradient(45deg, #00b894, #00cec9); border: none; border-radius: 10px; color: white; padding: 12px; font-weight: bold; cursor: pointer; font-size: 12px;">
                            üöÄ +50 Passagers<br><span style="font-size: 10px; opacity: 0.8;">200‚Ç¨</span>
                        </button>
                        <button class="promo-btn" onclick="launchPoolPromotion('boost_medium')" style="background: linear-gradient(45deg, #fdcb6e, #e17055); border: none; border-radius: 10px; color: white; padding: 12px; font-weight: bold; cursor: pointer; font-size: 12px;">
                            ‚ö° +100 Passagers<br><span style="font-size: 10px; opacity: 0.8;">350‚Ç¨</span>
                        </button>
                        <button class="promo-btn" onclick="launchPoolPromotion('boost_large')" style="background: linear-gradient(45deg, #e17055, #d63031); border: none; border-radius: 10px; color: white; padding: 12px; font-weight: bold; cursor: pointer; font-size: 12px;">
                            üí• +200 Passagers<br><span style="font-size: 10px; opacity: 0.8;">600‚Ç¨</span>
                        </button>
                    </div>
                </div>
                
                <!-- Promotions Temporelles -->
                <div>
                    <h4 style="color: #74b9ff; margin-bottom: 10px;">‚è∞ Boost Temporel</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 10px;">
                        <button class="promo-btn" onclick="launchPoolPromotion('accelerate')" style="background: linear-gradient(45deg, #74b9ff, #0984e3); border: none; border-radius: 10px; color: white; padding: 12px; font-weight: bold; cursor: pointer; font-size: 12px;">
                            üìà Acc√©l√©ration x2<br><span style="font-size: 10px; opacity: 0.8;">400‚Ç¨ - 2h</span>
                        </button>
                        <button class="promo-btn" onclick="launchPoolPromotion('rush_hour')" style="background: linear-gradient(45deg, #a29bfe, #6c5ce7); border: none; border-radius: 10px; color: white; padding: 12px; font-weight: bold; cursor: pointer; font-size: 12px;">
                            üî• Rush Hour<br><span style="font-size: 10px; opacity: 0.8;">500‚Ç¨ - 1h</span>
                        </button>
                        <button class="promo-btn" onclick="launchPoolPromotion('special_event')" style="background: linear-gradient(45deg, #fd79a8, #e84393); border: none; border-radius: 10px; color: white; padding: 12px; font-weight: bold; cursor: pointer; font-size: 12px;">
                            üåü √âv√©nement Sp√©cial<br><span style="font-size: 10px; opacity: 0.8;">700‚Ç¨ - 3h</span>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Promotions Actives -->
            <div id="active-promotions-list" style="margin-bottom: 20px;"></div>
        </div>

        <div id="editor-screen" class="screen">
            <h2>üó∫Ô∏è √âditeur de Trajet</h2>
            <div class="editor-intro" style="background: rgba(116, 185, 255, 0.1); border: 1px solid #74b9ff; border-radius: 15px; padding: 20px; margin-bottom: 20px;">
                <h3 style="color: #74b9ff; margin-bottom: 10px;">üéÜ Cr√©ez vos propres routes commerciales !</h3>
                <p style="opacity: 0.9; margin-bottom: 15px;">D√©finissez de nouvelles destinations, param√©trez les distances, co√ªts et r√©compenses pour cr√©er un r√©seau commercial unique.</p>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 20px;">
                    <div style="text-align: center; padding: 15px; background: rgba(0, 184, 148, 0.1); border-radius: 10px;">
                        <div style="font-size: 24px; margin-bottom: 5px;">üéØ</div>
                        <div style="font-weight: bold; color: #00b894;">Routes Personnalis√©es</div>
                        <div style="font-size: 12px; opacity: 0.8;">Cr√©ez vos trajets</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: rgba(253, 203, 110, 0.1); border-radius: 10px;">
                        <div style="font-size: 24px; margin-bottom: 5px;">‚öôÔ∏è</div>
                        <div style="font-weight: bold; color: #fdcb6e;">Param√©trage Avanc√©</div>
                        <div style="font-size: 12px; opacity: 0.8;">Distance, co√ªts, gains</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: rgba(116, 185, 255, 0.1); border-radius: 10px;">
                        <div style="font-size: 24px; margin-bottom: 5px;">üìä</div>
                        <div style="font-weight: bold; color: #74b9ff;">Int√©gration Dynamique</div>
                        <div style="font-size: 12px; opacity: 0.8;">Demande auto-g√©n√©r√©e</div>
                    </div>
                </div>
            </div>

            <div class="editor-actions" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
                <button onclick="showRouteCreator()" class="editor-btn" style="background: linear-gradient(45deg, #00b894, #00cec9); border: none; border-radius: 15px; color: white; padding: 20px; font-size: 16px; font-weight: bold; cursor: pointer; transition: all 0.3s;">
                    ‚ûï Cr√©er une Nouvelle Route
                </button>
                <button onclick="showCustomRoutes()" class="editor-btn" style="background: linear-gradient(45deg, #74b9ff, #0984e3); border: none; border-radius: 15px; color: white; padding: 20px; font-size: 16px; font-weight: bold; cursor: pointer; transition: all 0.3s;">
                    üó∫Ô∏è G√©rer Mes Routes
                </button>
            </div>

            <div id="route-creator" style="display: none; background: rgba(255, 255, 255, 0.05); border-radius: 15px; padding: 25px; margin-bottom: 20px;">
                <h3 style="color: #00b894; margin-bottom: 20px;">‚ûï Cr√©ateur de Route</h3>
                <div class="route-form" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div>
                        <label style="display: block; margin-bottom: 5px; color: #ddd;">Nom de la destination :</label>
                        <input type="text" id="route-name" placeholder="Ex: √éle Tropicale" style="width: 100%; padding: 10px; border: 1px solid #555; border-radius: 8px; background: rgba(255,255,255,0.1); color: white;">
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 5px; color: #ddd;">Distance (km) :</label>
                        <input type="number" id="route-distance" placeholder="150" min="10" max="1000" style="width: 100%; padding: 10px; border: 1px solid #555; border-radius: 8px; background: rgba(255,255,255,0.1); color: white;">
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 5px; color: #ddd;">Co√ªt carburant (L/100km) :</label>
                        <input type="number" id="route-fuel-cost" placeholder="8" min="1" max="50" step="0.1" style="width: 100%; padding: 10px; border: 1px solid #555; border-radius: 8px; background: rgba(255,255,255,0.1); color: white;">
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 5px; color: #ddd;">R√©compense de base (‚Ç¨) :</label>
                        <input type="number" id="route-reward" placeholder="120" min="10" max="1000" style="width: 100%; padding: 10px; border: 1px solid #555; border-radius: 8px; background: rgba(255,255,255,0.1); color: white;">
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 5px; color: #ddd;">R√©putation requise :</label>
                        <input type="number" id="route-reputation" placeholder="0" min="0" max="100" style="width: 100%; padding: 10px; border: 1px solid #555; border-radius: 8px; background: rgba(255,255,255,0.1); color: white;">
                    </div>
                </div>
                <div style="margin-top: 20px;">
                    <label style="display: block; margin-bottom: 5px; color: #ddd;">Description :</label>
                    <textarea id="route-description" placeholder="Une belle destination avec des plages de sable blanc..." rows="3" style="width: 100%; padding: 10px; border: 1px solid #555; border-radius: 8px; background: rgba(255,255,255,0.1); color: white; resize: vertical;"></textarea>
                </div>
                <div style="display: flex; gap: 15px; margin-top: 20px;">
                    <button onclick="createCustomRoute()" style="background: #00b894; border: none; border-radius: 8px; color: white; padding: 12px 24px; font-weight: bold; cursor: pointer; flex: 1;">
                        ‚úÖ Cr√©er la Route
                    </button>
                    <button onclick="cancelRouteCreation()" style="background: #636e72; border: none; border-radius: 8px; color: white; padding: 12px 24px; font-weight: bold; cursor: pointer;">
                        ‚ùå Annuler
                    </button>
                </div>
            </div>

            <div id="custom-routes-list" style="display: none;">
                <h3 style="color: #74b9ff; margin-bottom: 20px;">üó∫Ô∏è Mes Routes Personnalis√©es</h3>
                <div id="custom-routes-container" class="destinations-grid"></div>
            </div>
        </div>

        <div id="admin-screen" class="screen">
            <h2>‚öôÔ∏è Panneau d'Administration</h2>
            <div class="admin-warning">
                ‚ö†Ô∏è ATTENTION : Ces param√®tres modifient l'√©quilibre du jeu. Utilisez avec pr√©caution !
            </div>
            
            <div class="admin-grid">
                <div class="admin-card">
                    <h3>üí∞ √âconomie G√©n√©rale</h3>
                    <label>Argent de d√©part :</label>
                    <input type="number" id="startMoney" class="admin-input" placeholder="1000" value="1000">
                    
                    <label>Gasoil de d√©part :</label>
                    <input type="number" id="startFuel" class="admin-input" placeholder="100" value="100">
                    
                    <label>Multiplicateur gains :</label>
                    <input type="number" id="rewardMultiplier" class="admin-input" placeholder="1.0" value="1.0" step="0.1">
                    
                    <button class="admin-btn" onclick="applyEconomySettings()">Appliquer √âconomie</button>
                </div>

                <div class="admin-card">
                    <h3>üè≠ Usine √† Gasoil</h3>
                    <label>Intervalle production (secondes) :</label>
                    <input type="number" id="admin-gasfactory-interval" class="admin-input" placeholder="3600" value="3600">
                    <label>Litres/cycle :</label>
                    <input type="number" id="admin-gasfactory-prod" class="admin-input" placeholder="2" value="2">
                    <label>Prix am√©lioration (‚Ç¨) :</label>
                    <input type="number" id="admin-gasfactory-upgrade-price" class="admin-input" placeholder="500" value="500">
                    <button class="admin-btn" onclick="applyGasFactorySettings()">Appliquer Usine</button>
                </div>

                <div class="admin-card">
                    <h3>üîß Maintenance Navires</h3>
                    <label>Heures avant maintenance :</label>
                    <input type="number" id="maintenanceHours" class="admin-input" placeholder="50" value="50" step="1">
                    <label>Co√ªt maintenance (‚Ç¨) :</label>
                    <input type="number" id="maintenanceCost" class="admin-input" placeholder="200" value="200" step="10">
                    <label>P√©nalit√© urgence (‚Ç¨) :</label>
                    <input type="number" id="maintenancePenalty" class="admin-input" placeholder="50" value="50" step="10">
                    <button class="admin-btn" onclick="applyMaintenanceSettings()">Appliquer Maintenance</button>
                </div>

                <div class="admin-card">
                    <h3>üé´ Prix des Billets (‚Ç¨/passager)</h3>
                    <label>Port Local :</label>
                    <input type="number" id="dest1Ticket" class="admin-input" placeholder="2" value="2" step="0.5">
                    
                    <label>Marseille :</label>
                    <input type="number" id="dest2Ticket" class="admin-input" placeholder="8" value="8" step="0.5">
                    
                    <label>Londres :</label>
                    <input type="number" id="dest3Ticket" class="admin-input" placeholder="15" value="15" step="0.5">
                    
                    <label>New York :</label>
                    <input type="number" id="dest4Ticket" class="admin-input" placeholder="45" value="45" step="0.5">
                    
                    <label>Tokyo :</label>
                    <input type="number" id="dest5Ticket" class="admin-input" placeholder="80" value="80" step="0.5">
                    
                    <label>Singapour :</label>
                    <input type="number" id="dest6Ticket" class="admin-input" placeholder="60" value="60" step="0.5">
                    
                    <button class="admin-btn" onclick="applyTicketPrices()">Appliquer Prix Billets</button>
                </div>

                <div class="admin-card">
                    <h3>üó∫Ô∏è Gains Destinations (ANCIEN)</h3>
                    <p style="opacity: 0.7; font-size: 12px; margin-bottom: 15px;">‚ö†Ô∏è Syst√®me remplac√© par les prix des billets</p>
                    <label>Port Local :</label>
                    <input type="number" id="dest1Reward" class="admin-input" placeholder="50" value="50">
                    
                    <label>Marseille :</label>
                    <input type="number" id="dest2Reward" class="admin-input" placeholder="150" value="150">
                    
                    <label>Londres :</label>
                    <input type="number" id="dest3Reward" class="admin-input" placeholder="400" value="400">
                    
                    <label>New York :</label>
                    <input type="number" id="dest4Reward" class="admin-input" placeholder="1200" value="1200">
                    
                    <label>Tokyo :</label>
                    <input type="number" id="dest5Reward" class="admin-input" placeholder="2500" value="2500">
                    
                    <label>Singapour :</label>
                    <input type="number" id="dest6Reward" class="admin-input" placeholder="1800" value="1800">
                    
                    <button class="admin-btn" onclick="applyDestinationRewards()">Appliquer Destinations</button>
                </div>
                <div class="admin-card">
                    <h3>‚õΩ Carburant par Destination</h3>
                    <label>Port Local :</label>
                    <input type="number" id="dest1Fuel" class="admin-input" placeholder="5" value="5">
                    <label>Marseille :</label>
                    <input type="number" id="dest2Fuel" class="admin-input" placeholder="15" value="15">
                    <label>Londres :</label>
                    <input type="number" id="dest3Fuel" class="admin-input" placeholder="40" value="40">
                    <label>New York :</label>
                    <input type="number" id="dest4Fuel" class="admin-input" placeholder="120" value="120">
                    <label>Tokyo :</label>
                    <input type="number" id="dest5Fuel" class="admin-input" placeholder="200" value="200">
                    <label>Singapour :</label>
                    <input type="number" id="dest6Fuel" class="admin-input" placeholder="150" value="150">
                    <button class="admin-btn" onclick="applyDestinationFuel()">Appliquer Carburant</button>
                </div>

                <div class="admin-card">
                    <h3>‚è±Ô∏è Temps de Livraison (heures)</h3>
                    <label>Port Local :</label>
                    <input type="number" id="dest1Time" class="admin-input" placeholder="0.0833" value="0.0833" step="0.1">
                    <label>Marseille :</label>
                    <input type="number" id="dest2Time" class="admin-input" placeholder="2" value="2" step="0.1">
                    <label>Londres :</label>
                    <input type="number" id="dest3Time" class="admin-input" placeholder="6" value="6" step="0.1">
                    <label>New York :</label>
                    <input type="number" id="dest4Time" class="admin-input" placeholder="24" value="24" step="0.1">
                    <label>Tokyo :</label>
                    <input type="number" id="dest5Time" class="admin-input" placeholder="48" value="48" step="0.1">
                    <label>Singapour :</label>
                    <input type="number" id="dest6Time" class="admin-input" placeholder="36" value="36" step="0.1">
                    <button class="admin-btn" onclick="applyDestinationTimes()">Appliquer Temps</button>
                </div>

                <div class="admin-card">
                    <h3>üèä Pool Global de Passagers</h3>
                    <label>Pool initial de passagers :</label>
                    <input type="number" id="initialPassengerPool" class="admin-input" placeholder="300" value="300" min="50" max="1000">
                    
                    <label>G√©n√©ration par cycle (passagers) :</label>
                    <input type="number" id="passengerGenerationRate" class="admin-input" placeholder="15" value="15" min="5" max="50">
                    
                    <label>Intervalle de g√©n√©ration (minutes) :</label>
                    <input type="number" id="generationInterval" class="admin-input" placeholder="30" value="30" min="10" max="120">
                    
                    <label>Multiplicateur promotions instantan√©es :</label>
                    <input type="number" id="instantPromoMultiplier" class="admin-input" placeholder="1.0" value="1.0" step="0.1" min="0.5" max="3.0">
                    
                    <label>Multiplicateur promotions temporelles :</label>
                    <input type="number" id="temporalPromoMultiplier" class="admin-input" placeholder="2.0" value="2.0" step="0.1" min="1.5" max="5.0">
                    
                    <button class="admin-btn" onclick="applyPassengerPoolSettings()">Appliquer Pool Passagers</button>
                </div>

                <div class="admin-card">
                    <h3>üö¢ Prix des Navires (‚Ç¨)</h3>
                    <label>Cargo Standard :</label>
                    <input type="number" id="ship1Price" class="admin-input" placeholder="2500" value="2500">
                    
                    <label>Cargo Rapide :</label>
                    <input type="number" id="ship2Price" class="admin-input" placeholder="5000" value="5000">
                    
                    <label>Porte-conteneurs :</label>
                    <input type="number" id="ship3Price" class="admin-input" placeholder="15000" value="15000">
                    
                    <label>Yacht de Luxe :</label>
                    <input type="number" id="ship4Price" class="admin-input" placeholder="25000" value="25000">
                    
                    <label>Paquebot Moderne :</label>
                    <input type="number" id="ship5Price" class="admin-input" placeholder="45000" value="45000">
                    
                    <label>Navire de Croisi√®re :</label>
                    <input type="number" id="ship6Price" class="admin-input" placeholder="75000" value="75000">
                    
                    <label>M√©ga-Paquebot :</label>
                    <input type="number" id="ship7Price" class="admin-input" placeholder="120000" value="120000">
                    
                    <label>Titan des Mers :</label>
                    <input type="number" id="ship8Price" class="admin-input" placeholder="200000" value="200000">
                    
                    <button class="admin-btn" onclick="applyShipPrices()">Appliquer Prix Navires</button>
                </div>

                <div class="admin-card">
                    <h3>‚öôÔ∏è Sp√©cifications des Navires</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 10px; margin-bottom: 15px;">
                        <strong>Navire</strong>
                        <strong>Capacit√©</strong>
                        <strong>Vitesse</strong>
                        <strong>Consommation</strong>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 10px; margin-bottom: 10px; align-items: center;">
                        <label>Cargo Standard:</label>
                        <input type="number" id="ship1Capacity" class="admin-input" placeholder="100" value="100" style="padding: 5px;">
                        <input type="number" id="ship1Speed" class="admin-input" placeholder="1.2" value="1.2" step="0.1" style="padding: 5px;">
                        <input type="number" id="ship1Fuel" class="admin-input" placeholder="0.8" value="0.8" step="0.1" style="padding: 5px;">
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 10px; margin-bottom: 10px; align-items: center;">
                        <label>Cargo Rapide:</label>
                        <input type="number" id="ship2Capacity" class="admin-input" placeholder="80" value="80" style="padding: 5px;">
                        <input type="number" id="ship2Speed" class="admin-input" placeholder="2" value="2" step="0.1" style="padding: 5px;">
                        <input type="number" id="ship2Fuel" class="admin-input" placeholder="1.5" value="1.5" step="0.1" style="padding: 5px;">
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 10px; margin-bottom: 10px; align-items: center;">
                        <label>Porte-conteneurs:</label>
                        <input type="number" id="ship3Capacity" class="admin-input" placeholder="300" value="300" style="padding: 5px;">
                        <input type="number" id="ship3Speed" class="admin-input" placeholder="0.8" value="0.8" step="0.1" style="padding: 5px;">
                        <input type="number" id="ship3Fuel" class="admin-input" placeholder="2.5" value="2.5" step="0.1" style="padding: 5px;">
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 10px; margin-bottom: 10px; align-items: center;">
                        <label>Yacht de Luxe:</label>
                        <input type="number" id="ship4Capacity" class="admin-input" placeholder="20" value="20" style="padding: 5px;">
                        <input type="number" id="ship4Speed" class="admin-input" placeholder="3" value="3" step="0.1" style="padding: 5px;">
                        <input type="number" id="ship4Fuel" class="admin-input" placeholder="3" value="3" step="0.1" style="padding: 5px;">
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 10px; margin-bottom: 10px; align-items: center;">
                        <label>Paquebot Moderne:</label>
                        <input type="number" id="ship5Capacity" class="admin-input" placeholder="800" value="800" style="padding: 5px;">
                        <input type="number" id="ship5Speed" class="admin-input" placeholder="1.5" value="1.5" step="0.1" style="padding: 5px;">
                        <input type="number" id="ship5Fuel" class="admin-input" placeholder="4.2" value="4.2" step="0.1" style="padding: 5px;">
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 10px; margin-bottom: 10px; align-items: center;">
                        <label>Navire de Croisi√®re:</label>
                        <input type="number" id="ship6Capacity" class="admin-input" placeholder="1500" value="1500" style="padding: 5px;">
                        <input type="number" id="ship6Speed" class="admin-input" placeholder="1.8" value="1.8" step="0.1" style="padding: 5px;">
                        <input type="number" id="ship6Fuel" class="admin-input" placeholder="6.5" value="6.5" step="0.1" style="padding: 5px;">
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 10px; margin-bottom: 10px; align-items: center;">
                        <label>M√©ga-Paquebot:</label>
                        <input type="number" id="ship7Capacity" class="admin-input" placeholder="2500" value="2500" style="padding: 5px;">
                        <input type="number" id="ship7Speed" class="admin-input" placeholder="2.2" value="2.2" step="0.1" style="padding: 5px;">
                        <input type="number" id="ship7Fuel" class="admin-input" placeholder="9.8" value="9.8" step="0.1" style="padding: 5px;">
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 10px; margin-bottom: 15px; align-items: center;">
                        <label>Titan des Mers:</label>
                        <input type="number" id="ship8Capacity" class="admin-input" placeholder="4000" value="4000" style="padding: 5px;">
                        <input type="number" id="ship8Speed" class="admin-input" placeholder="2.5" value="2.5" step="0.1" style="padding: 5px;">
                        <input type="number" id="ship8Fuel" class="admin-input" placeholder="15.0" value="15.0" step="0.1" style="padding: 5px;">
                    </div>
                    
                    <button class="admin-btn" onclick="applyShipSpecs()">Appliquer Sp√©cifications</button>
                </div>

                <div class="admin-card">
                    <h3>üéÆ Actions Rapides</h3>
                    <button class="admin-btn" onclick="addMoney()">+1000‚Ç¨</button>
                    <button class="admin-btn" onclick="addFuel()">+500L Gasoil</button>
                    <button class="admin-btn" onclick="maxReputation()">Max R√©putation</button>
                    <button class="admin-btn" onclick="resetToDefaults()">R√©initialiser Param√®tres</button>
                    <button class="admin-btn" onclick="exportSettings()">Exporter Config</button>
                    <button class="admin-btn" onclick="importSettings()">Importer Config</button>
                </div>
            </div>
        </div>

        <div id="stats-screen" class="screen">
            <h2>üìä Statistiques de l'Empire</h2>
            <div id="stats-container"></div>
        </div>

        <div id="gasfactory-screen" class="screen">
            <h2>üè≠ Usine √† Gasoil</h2>
            <div id="gasfactory-container" style="margin-top: 25px;">
                <div style="font-size: 18px; margin-bottom: 10px;">Niveau : <span id="gasfactory-level"></span></div>
                <div style="font-size: 16px;">Production/cycle : <span id="gasfactory-prod"></span> L</div>
                <div style="font-size: 16px;">Intervalle : <span id="gasfactory-interval"></span></div>
                <div style="font-size: 16px;">Stock actuel : <span id="gasfactory-stock"></span> L</div>
                <div style="font-size: 16px; margin-top:10px;">Prix am√©lioration : <span id="gasfactory-upgrade-price"></span> ‚Ç¨</div>
                <button id="gasfactory-upgrade-btn" class="btn" style="margin-top: 18px;" onclick="upgradeGasFactory()">üîº Am√©liorer l'usine</button>
            </div>
        </div>
    </div>

    <div id="travel-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2>üö¢ Envoyer en Mission</h2>
            <div id="travel-details"></div>
            <button class="btn" onclick="startTravel()">üöÄ Commencer le Voyage</button>
        </div>
    </div>

    <div id="notification" class="notification"></div>

    <script>
        // √âtat du jeu
        let gameState = {
            money: 1000,
            fuel: 100,
            reputation: 0,
            level: 1,
            ships: [
                {
                    id: 1,
                    name: "Petit Cargo",
                    type: "cargo",
                    capacity: 50,
                    speed: 1,
                    fuelConsumption: 1,
                    status: "available",
                    destination: null,
                    arrivalTime: null,
                    earnings: 0
                }
            ],
            destinations: [
                {
                    id: 1,
                    name: "Port Local",
                    distance: 0.0833,
                    reward: 50,
                    reputation: 2,
                    fuelCost: 5,
                    description: "Livraison express locale"
                },
                {
                    id: 2,
                    name: "Marseille",
                    distance: 2,
                    reward: 150,
                    reputation: 5,
                    fuelCost: 15,
                    description: "Port m√©diterran√©en anim√©"
                },
                {
                    id: 3,
                    name: "Londres",
                    distance: 6,
                    reward: 400,
                    reputation: 15,
                    fuelCost: 40,
                    description: "Grand port commercial"
                },
                {
                    id: 4,
                    name: "New York",
                    distance: 24,
                    reward: 1200,
                    reputation: 40,
                    fuelCost: 120,
                    description: "M√©tropole am√©ricaine"
                },
                {
                    id: 5,
                    name: "Tokyo",
                    distance: 48,
                    reward: 2500,
                    reputation: 80,
                    fuelCost: 200,
                    description: "Capital du Pacifique"
                },
                {
                    id: 6,
                    name: "Singapour",
                    distance: 36,
                    reward: 1800,
                    reputation: 60,
                    fuelCost: 150,
                    description: "Hub asiatique"
                }
            ],
            shopItems: [
                {
                    id: 1,
                    name: "Cargo Standard",
                    price: 2500,
                    type: "ship",
                    specs: { capacity: 100, speed: 1.2, fuelConsumption: 0.8 }
                },
                {
                    id: 2,
                    name: "Cargo Rapide",
                    price: 5000,
                    type: "ship",
                    specs: { capacity: 80, speed: 2, fuelConsumption: 1.5 }
                },
                {
                    id: 3,
                    name: "Porte-conteneurs",
                    price: 15000,
                    type: "ship",
                    specs: { capacity: 300, speed: 0.8, fuelConsumption: 2.5 }
                },
                {
                    id: 4,
                    name: "Yacht de Luxe",
                    price: 25000,
                    type: "ship",
                    specs: { capacity: 20, speed: 3, fuelConsumption: 3 }
                },
                {
                    id: 5,
                    name: "Paquebot Moderne",
                    price: 45000,
                    type: "ship",
                    specs: { capacity: 800, speed: 1.5, fuelConsumption: 4.2 }
                },
                {
                    id: 6,
                    name: "Navire de Croisi√®re",
                    price: 75000,
                    type: "ship",
                    specs: { capacity: 1500, speed: 1.8, fuelConsumption: 6.5 }
                },
                {
                    id: 7,
                    name: "M√©ga-Paquebot",
                    price: 120000,
                    type: "ship",
                    specs: { capacity: 2500, speed: 2.2, fuelConsumption: 9.8 }
                },
                {
                    id: 8,
                    name: "Titan des Mers",
                    price: 200000,
                    type: "ship",
                    specs: { capacity: 4000, speed: 2.5, fuelConsumption: 15.0 }
                }
            ],
            statistics: {
                totalEarnings: 0,
                totalTrips: 0,
                totalDistance: 0,
                totalFuelConsumed: 0
            },
            adminSettings: {
                rewardMultiplier: 1.0,
                startMoney: 1000,
                startFuel: 100,
                fuelPricePerLiter: 2
            }
        };

        let selectedShip = null;
        let currentScreen = 'fleet';

        // Ajout structure usine √† gasoil si absente
        function ensureGasFactory() {
            if (!gameState.gasFactory) {
                gameState.gasFactory = {};
            }
            if (typeof gameState.gasFactory.level !== 'number') gameState.gasFactory.level = 1;
            if (typeof gameState.gasFactory.productionPerCycle !== 'number') gameState.gasFactory.productionPerCycle = 2;
            if (typeof gameState.gasFactory.productionInterval !== 'number') gameState.gasFactory.productionInterval = 3600000;
            if (typeof gameState.gasFactory.nextUpgradePrice !== 'number') gameState.gasFactory.nextUpgradePrice = 500;
        }

        // Affichage usine √† gasoil
        function updateGasFactoryDisplay() {
            ensureGasFactory();
            if (!document.getElementById('gasfactory-level')) return;
            document.getElementById('gasfactory-level').textContent = gameState.gasFactory.level;
            document.getElementById('gasfactory-prod').textContent = gameState.gasFactory.productionPerCycle;
            document.getElementById('gasfactory-interval').textContent = msToHuman(gameState.gasFactory.productionInterval);
            document.getElementById('gasfactory-stock').textContent = gameState.fuel;
            document.getElementById('gasfactory-upgrade-price').textContent = gameState.gasFactory.nextUpgradePrice;
            document.getElementById('gasfactory-upgrade-btn').disabled = gameState.money < gameState.gasFactory.nextUpgradePrice;
        }
        window.updateGasFactoryDisplay = updateGasFactoryDisplay;

        // Am√©lioration usine √† gasoil
        function upgradeGasFactory() {
            ensureGasFactory();
            if (gameState.money >= gameState.gasFactory.nextUpgradePrice) {
                gameState.money -= gameState.gasFactory.nextUpgradePrice;
                gameState.gasFactory.level += 1;
                gameState.gasFactory.productionPerCycle += 1;
                gameState.gasFactory.nextUpgradePrice = Math.floor(gameState.gasFactory.nextUpgradePrice * 1.6);
                updateDisplay();
                saveGame();
                showNotification('Usine am√©lior√©e ! Production accrue.');
            } else {
                showNotification('Pas assez d\'argent pour am√©liorer l\'usine !');
            }
        }
        window.upgradeGasFactory = upgradeGasFactory;

        // Production automatique usine √† gasoil
        let gasFactoryIntervalId = null;
        function startGasFactoryInterval() {
            if (gasFactoryIntervalId) clearInterval(gasFactoryIntervalId);
            ensureGasFactory();
            gasFactoryIntervalId = setInterval(() => {
                ensureGasFactory();
                gameState.fuel += gameState.gasFactory.productionPerCycle;
                gameState.gasFactory.lastProductionTime = Date.now();
                updateDisplay();
                saveGame();
                showNotification('Production de gasoil : +' + gameState.gasFactory.productionPerCycle + 'L');
            }, gameState.gasFactory.productionInterval);
        }
        window.startGasFactoryInterval = startGasFactoryInterval;

        // Appliquer les param√®tres usine √† gasoil depuis l'admin
        function updateGasFactoryAdminFields() {
            ensureGasFactory();
            var intervalInput = document.getElementById('admin-gasfactory-interval');
            var prodInput = document.getElementById('admin-gasfactory-prod');
            var priceInput = document.getElementById('admin-gasfactory-upgrade-price');
            if (intervalInput) intervalInput.value = Math.floor(gameState.gasFactory.productionInterval / 1000);
            if (prodInput) prodInput.value = gameState.gasFactory.productionPerCycle;
            if (priceInput) priceInput.value = gameState.gasFactory.nextUpgradePrice;
        }
        window.updateGasFactoryAdminFields = updateGasFactoryAdminFields;

        function applyGasFactorySettings() {
            const intervalSec = parseInt(document.getElementById('admin-gasfactory-interval').value) || 3600;
            const interval = intervalSec * 1000;
            const prod = parseInt(document.getElementById('admin-gasfactory-prod').value) || 2;
            const price = parseInt(document.getElementById('admin-gasfactory-upgrade-price').value) || 500;
            ensureGasFactory();
            gameState.gasFactory.productionInterval = interval;
            gameState.gasFactory.productionPerCycle = prod;
            gameState.gasFactory.nextUpgradePrice = price;
            showNotification('Param√®tres usine appliqu√©s !');
            saveGame();
            updateDisplay();
            startGasFactoryInterval();
            updateGasFactoryAdminFields();
        }
        window.applyGasFactorySettings = applyGasFactorySettings;

        // Conversion ms -> texte humain
        function msToHuman(ms) {
            if (!ms) return '';
            let min = Math.floor(ms/60000)%60;
            let h = Math.floor(ms/3600000);
            return (h>0?h+'h ':'') + (min>0?min+'min':'');
        }
        window.msToHuman = msToHuman;

        // Sauvegarde/chargement usine √† gasoil
        const origSaveGame = saveGame;
        saveGame = function() {
            ensureGasFactory();
            origSaveGame();
        }
        window.saveGame = saveGame;

        const origLoadGame = loadGame;
        loadGame = function() {
            origLoadGame();
            ensureGasFactory();
            // Production offline usine √† gasoil bas√©e sur le timestamp global
            const now = Date.now();
            const last = gameState.timestamp || now;
            const elapsed = now - last;
            const cycles = Math.floor(elapsed / gameState.gasFactory.productionInterval);
            if (cycles > 0) {
                gameState.fuel += cycles * gameState.gasFactory.productionPerCycle;
            }
            updateGasFactoryDisplay();
            startGasFactoryInterval();
        }
        window.loadGame = loadGame;

        updateGasFactoryDisplay();

        // Fonctions d'affichage
        function updateDisplay() {
            document.getElementById('money').textContent = gameState.money;
            document.getElementById('fuel').textContent = gameState.fuel;
            document.getElementById('reputation').textContent = gameState.reputation;
            document.getElementById('level').textContent = gameState.level;
            
            // Mettre √† jour l'affichage des passagers dans l'interface principale
            initializePassengerPool();
            const headerPassengersElement = document.getElementById('header-passengers');
            if (headerPassengersElement) {
                headerPassengersElement.textContent = gameState.passengerPool.totalPassengers;
            }
            
            updateShipsDisplay();
            updateDestinationsDisplay();
            updateShopDisplay();
            updateStatsDisplay();
            updateGasFactoryDisplay();
            updatePoolDisplay(); // Nouveau syst√®me de pool global
        }

        function getMaintenanceProgressBar(ship) {
            const maintenanceHours = gameState.adminSettings?.maintenanceHours || 50;
            const hoursNavigated = ship.hoursNavigated || 0;
            const percentage = Math.min(100, (hoursNavigated / maintenanceHours) * 100);
            
            let fillClass = 'good';
            let statusText = 'Bon √©tat';
            
            if (percentage >= 85) {
                fillClass = 'critical';
                statusText = 'Critique';
            } else if (percentage >= 60) {
                fillClass = 'warning';
                statusText = 'Attention';
            }
            
            return `
                <div class="maintenance-progress">
                    <div class="maintenance-info">
                        <span>üîß Maintenance: ${Math.round(percentage)}%</span>
                        <span>${statusText}</span>
                    </div>
                    <div class="maintenance-bar">
                        <div class="maintenance-fill ${fillClass}" style="width: ${percentage}%"></div>
                    </div>
                    <div class="maintenance-info">
                        <span>${Math.round(hoursNavigated)}h / ${maintenanceHours}h</span>
                    </div>
                </div>
            `;
        }

        function updateShipsDisplay() {
            const container = document.getElementById('ships-container');
            container.innerHTML = '';

            gameState.ships.forEach(ship => {
                const shipCard = document.createElement('div');
                shipCard.className = `ship-card ${ship.status === 'traveling' ? 'traveling' : ''}`;
                
                let statusBadge = '';
                if (ship.status === 'available') {
                    statusBadge = '<span class="status-badge status-available">Disponible</span>';
                } else if (ship.status === 'traveling') {
                    statusBadge = '<span class="status-badge status-traveling">En voyage</span>';
                } else if (ship.status === 'maintenance_required') {
                    statusBadge = '<span class="status-badge" style="background: #d63031;">Maintenance requise</span>';
                }

                let progressBar = '';
                let actionButton = '';

                if (ship.status === 'traveling') {
                    const totalTime = ship.travelTime * 60 * 60 * 1000;
                    const elapsed = Date.now() - ship.departureTime;
                    const progress = Math.min(100, (elapsed / totalTime) * 100);
                    const remainingMs = Math.max(0, totalTime - elapsed);
                    const remainingHours = Math.floor(remainingMs / (60 * 60 * 1000));
                    const remainingMinutes = Math.floor((remainingMs % (60 * 60 * 1000)) / (60 * 1000));
                    
                    let timeDisplay = '';
                    if (remainingHours > 0) {
                        timeDisplay = `${remainingHours}h ${remainingMinutes}min`;
                    } else {
                        timeDisplay = `${remainingMinutes}min`;
                    }
                    
                    progressBar = `
                        <div class="ship-animation">
                            <div class="wave"></div>
                            <div class="ship-trail"></div>
                            <div class="sailing-ship" style="left: ${progress}%">üö¢</div>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${progress}%"></div>
                        </div>
                        <div>Arriv√©e dans: ${timeDisplay} vers ${ship.destination.name}</div>
                    `;
                } else if (ship.status === 'maintenance_required') {
                    const baseCost = gameState.adminSettings?.maintenanceCost || 200;
                    const penalty = gameState.adminSettings?.maintenancePenalty || 50;
                    const totalCost = baseCost + penalty;
                    actionButton = `<button class="btn maintenance-emergency" onclick="performMaintenance(${ship.id})">‚ö†Ô∏è Maintenance d'urgence (${totalCost}‚Ç¨)</button>`;
                } else {
                    const maintenanceHours = gameState.adminSettings?.maintenanceHours || 50;
                    const hoursNavigated = ship.hoursNavigated || 0;
                    const percentage = (hoursNavigated / maintenanceHours) * 100;
                    const baseCost = gameState.adminSettings?.maintenanceCost || 200;
                    
                    let buttons = `<button class="btn" onclick="selectShipForTravel(${ship.id})">üöÄ Envoyer en Mission</button>`;
                    
                    // Ajouter bouton maintenance pr√©ventive si >= 20%
                    if (percentage >= 20) {
                        buttons = `
                            <button class="btn maintenance-preventive" onclick="performMaintenance(${ship.id}, true)">üîß Maintenance (${baseCost}‚Ç¨)</button>
                            <button class="btn" onclick="selectShipForTravel(${ship.id})">üöÄ Mission</button>
                        `;
                    }
                    
                    actionButton = buttons;
                }

                shipCard.innerHTML = `
                    <div class="ship-status">
                        <div class="ship-name">${ship.name}</div>
                        ${statusBadge}
                    </div>
                    <div class="ship-stats">
                        <div class="stat">
                            <div class="stat-value">${ship.capacity}</div>
                            <div class="stat-label">Capacit√©</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value">${ship.speed}x</div>
                            <div class="stat-label">Vitesse</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value">${ship.fuelConsumption}x</div>
                            <div class="stat-label">Consommation</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value">${Math.round(ship.hoursNavigated || 0)}h</div>
                            <div class="stat-label">Navigation</div>
                        </div>
                    </div>
                    ${getMaintenanceProgressBar(ship)}
                    ${progressBar}
                    ${actionButton}
                `;

                container.appendChild(shipCard);
            });
        }

        function updateDestinationsDisplay() {
            const container = document.getElementById('destinations-container');
            container.innerHTML = '';

            gameState.destinations.forEach(destination => {
                const destCard = document.createElement('div');
                let fuelCost = destination.fuelCost;
                
                if (selectedShip) {
                    fuelCost = Math.ceil(destination.fuelCost * selectedShip.fuelConsumption);
                }
                
                const hasEnoughFuel = gameState.fuel >= fuelCost;
                destCard.className = `destination-card ${!hasEnoughFuel ? 'insufficient-fuel' : ''}`;
                destCard.onclick = () => selectDestination(destination);

                // Calculer les gains pr√©vus avec le nouveau syst√®me
        let expectedEarnings = 0;
        let passengerInfo = "";
        
        if (selectedShip) {
            // Initialiser le pool de passagers pour obtenir le nombre disponible
            initializePassengerPool();
            const pool = gameState.passengerPool;
            const passengersAvailable = Math.min(pool.totalPassengers, selectedShip.capacity);
            const ticketPrice = destination.ticketPrice || destination.reward || 10;
            
            if (passengersAvailable > 0) {
                expectedEarnings = Math.floor(passengersAvailable * ticketPrice * (gameState.adminSettings?.rewardMultiplier || 1.0));
                passengerInfo = `<div>üë• ${passengersAvailable} passagers √ó ${ticketPrice}‚Ç¨ = ${expectedEarnings}‚Ç¨</div>`;
            } else {
                passengerInfo = `<div style="color: #f39c12;">‚ö†Ô∏è Aucun passager disponible (voyage √† vide)</div>`;
            }
        } else {
            // Affichage g√©n√©rique sans navire s√©lectionn√©
            const ticketPrice = destination.ticketPrice || destination.reward || 10;
            passengerInfo = `<div>üé´ ${ticketPrice}‚Ç¨ par passager</div>`;
        }

                destCard.innerHTML = `
                    <div class="destination-name">${destination.name}</div>
                    <div class="destination-info">
                        <div>üïí ${destination.name === "Port Local" ? "5 min" : (destination.distance < 1 ? Math.round(destination.distance * 60) + 'min' : destination.distance + 'h')} de voyage</div>
                        ${passengerInfo}
                        <div>‚öì +${destination.reputation} r√©putation</div>
                        <div class="fuel-cost">‚õΩ ${fuelCost}L de carburant</div>
                        ${!hasEnoughFuel ? '<div style="color: #d63031; font-weight: bold;">‚ùå Carburant insuffisant</div>' : ''}
                        <div style="margin-top: 8px; opacity: 0.8;">${destination.description}</div>
                    </div>
                `;

                container.appendChild(destCard);
            });
        }

        function updateShopDisplay() {
            const container = document.getElementById('shop-container');
            container.innerHTML = '';

            gameState.shopItems.forEach(item => {
                const shopItem = document.createElement('div');
                shopItem.className = 'shop-item';

                const canAfford = gameState.money >= item.price;
                const buttonClass = canAfford ? 'btn' : 'btn';
                const buttonText = canAfford ? 'Acheter' : 'Pas assez d\'argent';

                shopItem.innerHTML = `
                    <h3>${item.name}</h3>
                    <div>Capacit√©: ${item.specs.capacity}</div>
                    <div>Vitesse: ${item.specs.speed}x</div>
                    <div>Consommation: ${item.specs.fuelConsumption}x</div>
                    <div class="price">${item.price}‚Ç¨</div>
                    <button class="${buttonClass}" onclick="buyItem(${item.id})" ${!canAfford ? 'disabled' : ''}>
                        ${buttonText}
                    </button>
                `;

                container.appendChild(shopItem);
            });
        }

        function updateStatsDisplay() {
            const container = document.getElementById('stats-container');
            container.innerHTML = `
                <div class="ship-stats">
                    <div class="stat">
                        <div class="stat-value">${gameState.statistics.totalEarnings}</div>
                        <div class="stat-label">Gains totaux (‚Ç¨)</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value">${gameState.statistics.totalTrips}</div>
                        <div class="stat-label">Voyages effectu√©s</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value">${gameState.statistics.totalDistance}</div>
                        <div class="stat-label">Distance parcourue (h)</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value">${gameState.statistics.totalFuelConsumed}</div>
                        <div class="stat-label">Carburant consomm√© (L)</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value">${gameState.ships.length}</div>
                        <div class="stat-label">Navires poss√©d√©s</div>
                    </div>
                </div>
            `;
        }

        function updateSellDisplay() {
            const container = document.getElementById('sell-ships-container');
            container.innerHTML = '';

            if (gameState.ships.length === 0) {
                container.innerHTML = '<p style="text-align: center; opacity: 0.7;">Aucun navire √† vendre.</p>';
                return;
            }

            gameState.ships.forEach(ship => {
                const sellCard = document.createElement('div');
                
                // V√©rifier si le bateau peut √™tre vendu
                const isTraveling = ship.destination && ship.arrivalTime > Date.now();
                const isLastShip = gameState.ships.length === 1;
                const canSell = !isTraveling && !isLastShip;
                
                // Calculer le prix de vente (70% du prix d'achat)
                const originalPrice = gameState.shopItems.find(item => item.name === ship.name)?.price || 1000;
                const sellPrice = Math.floor(originalPrice * 0.7);
                
                sellCard.className = `sell-ship-card ${!canSell ? 'not-sellable' : ''}`;
                
                let reasonText = '';
                if (isTraveling) {
                    reasonText = '<div class="not-sellable-reason">üö¢ Navire en voyage</div>';
                } else if (isLastShip) {
                    reasonText = '<div class="not-sellable-reason">‚ö†Ô∏è Dernier navire (impossible √† vendre)</div>';
                }
                
                let statusBadge = '';
                if (isTraveling) {
                    const timeLeft = ship.arrivalTime - Date.now();
                    const hoursLeft = Math.ceil(timeLeft / (1000 * 60 * 60));
                    statusBadge = `<span class="status-badge status-traveling">En voyage (${hoursLeft}h)</span>`;
                } else {
                    statusBadge = '<span class="status-badge status-available">Disponible</span>';
                }
                
                sellCard.innerHTML = `
                    <div class="ship-status">
                        <div class="ship-name">${ship.name}</div>
                        ${statusBadge}
                    </div>
                    <div class="ship-stats">
                        <div class="stat">
                            <div class="stat-value">${ship.capacity}</div>
                            <div class="stat-label">Capacit√©</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value">${ship.speed}x</div>
                            <div class="stat-label">Vitesse</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value">${ship.fuelConsumption}x</div>
                            <div class="stat-label">Consommation</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value">${Math.round(ship.hoursNavigated || 0)}h</div>
                            <div class="stat-label">Navigation</div>
                        </div>
                    </div>
                    <div class="sell-price">
                        üí∞ Prix de vente: ${sellPrice}‚Ç¨
                        <div style="font-size: 12px; opacity: 0.8; margin-top: 5px;">
                            (Prix d'achat: ${originalPrice}‚Ç¨)
                        </div>
                    </div>
                    <button class="sell-btn" onclick="sellShip(${ship.id})" ${!canSell ? 'disabled' : ''}>
                        ${canSell ? 'üí∞ Vendre ce navire' : '‚ùå Impossible √† vendre'}
                    </button>
                    ${reasonText}
                `;
                
                container.appendChild(sellCard);
            });
        }

        function sellShip(shipId) {
            const ship = gameState.ships.find(s => s.id === shipId);
            if (!ship) return;
            
            // V√©rifications de s√©curit√©
            const isTraveling = ship.destination && ship.arrivalTime > Date.now();
            const isLastShip = gameState.ships.length === 1;
            
            if (isTraveling) {
                showNotification('‚ùå Impossible de vendre un navire en voyage!');
                return;
            }
            
            if (isLastShip) {
                showNotification('‚ùå Vous devez garder au moins un navire!');
                return;
            }
            
            // Calculer le prix de vente
            const originalPrice = gameState.shopItems.find(item => item.name === ship.name)?.price || 1000;
            const sellPrice = Math.floor(originalPrice * 0.7);
            
            // Confirmation de vente
            if (confirm(`√ätes-vous s√ªr de vouloir vendre "${ship.name}" pour ${sellPrice}‚Ç¨ ?`)) {
                // Supprimer le navire de la flotte
                gameState.ships = gameState.ships.filter(s => s.id !== shipId);
                
                // Ajouter l'argent
                gameState.money += sellPrice;
                
                // Mettre √† jour les statistiques
                gameState.statistics.shipsOwned = gameState.ships.length;
                
                // Jouer un son de succ√®s
                playSound('success');
                
                // Afficher une notification
                showNotification(`‚úÖ ${ship.name} vendu pour ${sellPrice}‚Ç¨!`);
                
                // Mettre √† jour l'affichage
                updateDisplay();
                updateSellDisplay();
                
                // Sauvegarder
                saveGame();
            }
        }

        // Nouveau syst√®me de pool global de passagers
        function initializePassengerPool() {
            if (!gameState.passengerPool) {
                gameState.passengerPool = {
                    totalPassengers: 300,
                    lastGeneration: Date.now(),
                    activePromotions: [],
                    settings: {
                        generationRate: 15,
                        generationInterval: 30 * 60 * 1000, // 30 minutes en ms
                        instantPromoMultiplier: 1.0,
                        temporalPromoMultiplier: 2.0
                    }
                };
            }
        }

        // Syst√®me de gestion des clients
        function initializeClientSystem() {
            if (!gameState.clientSystem) {
                gameState.clientSystem = {
                    demandByDestination: {},
                    activePromotions: [],
                    satisfactionRate: 100,
                    totalDemand: 0,
                    lastDemandUpdate: Date.now()
                };
                
                // Initialiser la demande pour chaque destination
                gameState.destinations.forEach(dest => {
                    gameState.clientSystem.demandByDestination[dest.id] = {
                        passengers: Math.floor(Math.random() * 50) + 10, // 10-60 passagers
                        basePrice: dest.reward,
                        currentPrice: dest.reward,
                        trend: 'stable' // 'increasing', 'decreasing', 'stable'
                    };
                });
            }
        }

        function updateDemand() {
            initializeClientSystem();
            initializePassengerPool();
            const now = Date.now();
            
            // Mettre √† jour la demande toutes les 30 secondes
            if (now - gameState.clientSystem.lastDemandUpdate > 30000) {
                gameState.destinations.forEach(dest => {
                    const demand = gameState.clientSystem.demandByDestination[dest.id];
                    
                    // Fluctuation al√©atoire de la demande (-5 √† +10 passagers)
                    const change = Math.floor(Math.random() * 16) - 5;
                    demand.passengers = Math.max(5, Math.min(150, demand.passengers + change));
                    
                    // D√©finir la tendance
                    if (change > 3) demand.trend = 'increasing';
                    else if (change < -3) demand.trend = 'decreasing';
                    else demand.trend = 'stable';
                    
                    // Ajuster le prix selon la demande
                    if (demand.passengers > 80) {
                        demand.currentPrice = Math.floor(demand.basePrice * 1.2); // +20% si forte demande
                    } else if (demand.passengers < 30) {
                        demand.currentPrice = Math.floor(demand.basePrice * 0.8); // -20% si faible demande
                    } else {
                        demand.currentPrice = demand.basePrice;
                    }
                });
                
                gameState.clientSystem.lastDemandUpdate = now;
                calculateTotalDemand();
            }
        }

        function calculateTotalDemand() {
            let total = 0;
            Object.values(gameState.clientSystem.demandByDestination).forEach(demand => {
                total += demand.passengers;
            });
            gameState.clientSystem.totalDemand = total;
        }

        function launchPromotion(type, discount) {
            initializeClientSystem();
            
            // V√©rifier si une promo du m√™me type est d√©j√† active
            const existingPromo = gameState.clientSystem.activePromotions.find(p => p.type === type);
            if (existingPromo) {
                showNotification('‚ùå Une promotion de ce type est d√©j√† active!');
                return;
            }
            
            const cost = calculatePromotionCost(type, discount);
            if (gameState.money < cost) {
                showNotification('‚ùå Pas assez d\'argent pour lancer cette promotion!');
                return;
            }
            
            // D√©duire le co√ªt
            gameState.money -= cost;
            
            // Cr√©er la promotion
            const promotion = {
                type: type,
                discount: discount,
                startTime: Date.now(),
                duration: getPromotionDuration(type), // en millisecondes
                effect: getPromotionEffect(type)
            };
            
            gameState.clientSystem.activePromotions.push(promotion);
            
            // Appliquer l'effet imm√©diat
            applyPromotionEffect(promotion);
            
            showNotification(`‚úÖ Promotion "${getPromotionName(type)}" lanc√©e pour ${cost}‚Ç¨!`);
            playSound('success');
            updateDisplay();
            updateClientsDisplay();
        }

        function launchTargetedPromotion(destinationId, discount) {
            initializeClientSystem();
            
            // V√©rifier si une promo est d√©j√† active sur cette destination
            const existingPromo = gameState.clientSystem.activePromotions.find(p => p.targetDestination === destinationId);
            if (existingPromo) {
                showNotification('‚ùå Une promotion est d√©j√† active sur cette destination!');
                return;
            }
            
            // Co√ªt r√©duit pour une promo cibl√©e (60% du co√ªt d'une promo g√©n√©rale)
            const cost = Math.floor(calculatePromotionCost('global', discount) * 0.6);
            if (gameState.money < cost) {
                showNotification('‚ùå Pas assez d\'argent pour lancer cette promotion!');
                return;
            }
            
            // D√©duire le co√ªt
            gameState.money -= cost;
            
            // Trouver le nom de la destination
            const destination = gameState.destinations.find(d => d.id === destinationId);
            const destinationName = destination ? destination.name : 'Destination';
            
            // Cr√©er la promotion cibl√©e
            const promotion = {
                type: 'targeted',
                targetDestination: destinationId,
                discount: discount,
                startTime: Date.now(),
                duration: 8 * 60 * 1000, // 8 minutes pour une promo cibl√©e
                effect: { demandBoost: 1.4, targeted: true } // Boost plus fort mais cibl√©
            };
            
            gameState.clientSystem.activePromotions.push(promotion);
            
            // Appliquer l'effet imm√©diat sur la destination cibl√©e
            applyTargetedPromotionEffect(promotion);
            
            showNotification(`‚úÖ Promotion "${destinationName} -${discount}%" lanc√©e pour ${cost}‚Ç¨!`);
            playSound('success');
            updateDisplay();
            updateClientsDisplay();
        }

        function applyTargetedPromotionEffect(promotion) {
            const demand = gameState.clientSystem.demandByDestination[promotion.targetDestination];
            if (demand) {
                const boost = Math.floor(demand.passengers * (promotion.effect.demandBoost - 1));
                demand.passengers += boost;
                calculateTotalDemand();
            }
        }

        // Nouvelles fonctions pour les promotions du pool global
        function launchPoolPromotion(promoType) {
            initializePassengerPool();
            
            const promotions = {
                'boost_small': { cost: 200, passengers: 50, type: 'instant' },
                'boost_medium': { cost: 350, passengers: 100, type: 'instant' },
                'boost_large': { cost: 600, passengers: 200, type: 'instant' },
                'accelerate': { cost: 400, duration: 2 * 60 * 60 * 1000, multiplier: 2.0, type: 'temporal' }, // 2h
                'rush_hour': { cost: 500, duration: 1 * 60 * 60 * 1000, multiplier: 3.0, type: 'temporal' }, // 1h
                'special_event': { cost: 700, duration: 3 * 60 * 60 * 1000, multiplier: 2.5, type: 'temporal' } // 3h
            };
            
            const promo = promotions[promoType];
            if (!promo) {
                showNotification('‚ùå Type de promotion invalide!');
                return;
            }
            
            // V√©rifier si on a assez d'argent
            if (gameState.money < promo.cost) {
                showNotification('‚ùå Pas assez d\'argent pour cette promotion!');
                return;
            }
            
            // V√©rifier si une promotion temporelle du m√™me type est d√©j√† active
            if (promo.type === 'temporal') {
                const existingTemporal = gameState.passengerPool.activePromotions.find(p => p.type === 'temporal');
                if (existingTemporal) {
                    showNotification('‚ùå Une promotion temporelle est d√©j√† active!');
                    return;
                }
            }
            
            // D√©duire le co√ªt
            gameState.money -= promo.cost;
            
            if (promo.type === 'instant') {
                // Promotion instantan√©e : ajouter des passagers imm√©diatement
                const actualBoost = Math.floor(promo.passengers * gameState.passengerPool.settings.instantPromoMultiplier);
                gameState.passengerPool.totalPassengers += actualBoost;
                showNotification(`üöÄ +${actualBoost} passagers ajout√©s instantan√©ment au pool!`);
            } else if (promo.type === 'temporal') {
                // Promotion temporelle : acc√©l√©rer la g√©n√©ration
                const promotion = {
                    type: 'temporal',
                    startTime: Date.now(),
                    endTime: Date.now() + promo.duration,
                    multiplier: promo.multiplier,
                    name: getPoolPromoName(promoType)
                };
                
                gameState.passengerPool.activePromotions.push(promotion);
                showNotification(`‚è∞ ${promotion.name} activ√©e pour ${Math.floor(promo.duration / (60 * 60 * 1000))}h!`);
            }
            
            playSound('success');
            updateDisplay();
            updatePoolDisplay();
            saveGame();
        }

        function getPoolPromoName(promoType) {
            const names = {
                'accelerate': 'Acc√©l√©ration x2',
                'rush_hour': 'Rush Hour',
                'special_event': '√âv√©nement Sp√©cial'
            };
            return names[promoType] || 'Promotion';
        }

        // Fonction pour mettre √† jour l'affichage du pool global
        function updatePoolDisplay() {
            initializePassengerPool();
            const pool = gameState.passengerPool;
            const now = Date.now();
            
            // Mettre √† jour le nombre total de passagers
            const poolElement = document.getElementById('global-passenger-pool');
            if (poolElement) {
                poolElement.textContent = pool.totalPassengers;
            }
            
            // Calculer le temps jusqu'√† la prochaine g√©n√©ration
            const timeToNext = Math.max(0, pool.settings.generationInterval - (now - pool.lastGeneration));
            const minutesLeft = Math.ceil(timeToNext / (60 * 1000));
            
            const nextGenElement = document.getElementById('next-generation');
            const timeToNextElement = document.getElementById('time-to-next');
            if (nextGenElement && timeToNextElement) {
                let generationAmount = pool.settings.generationRate;
                
                // Appliquer les bonus des promotions temporelles actives
                pool.activePromotions.forEach(promo => {
                    if (promo.type === 'temporal' && now < promo.endTime) {
                        generationAmount = Math.floor(generationAmount * pool.settings.temporalPromoMultiplier);
                    }
                });
                
                nextGenElement.textContent = generationAmount;
                timeToNextElement.textContent = minutesLeft;
            }
            
            // Mettre √† jour le compteur de promotions actives
            const activePromosElement = document.getElementById('active-promos-count');
            if (activePromosElement) {
                const activeCount = pool.activePromotions.filter(promo => now < promo.endTime).length;
                activePromosElement.textContent = activeCount;
            }
            
            // Calculer les statistiques de la flotte
            const availableShips = gameState.ships.filter(ship => ship.status === 'available').length;
            const totalCapacity = gameState.ships.reduce((total, ship) => total + ship.capacity, 0);
            
            const totalCapacityElement = document.getElementById('total-fleet-capacity');
            const availableShipsElement = document.getElementById('available-ships');
            if (totalCapacityElement) totalCapacityElement.textContent = totalCapacity;
            if (availableShipsElement) availableShipsElement.textContent = availableShips;
            
            // Indicateur de statut du pool
            const poolStatusIndicator = document.getElementById('pool-status-indicator');
            const poolStatusText = document.getElementById('pool-status-text');
            const poolStatusDesc = document.getElementById('pool-status-desc');
            
            if (poolStatusIndicator && poolStatusText && poolStatusDesc) {
                if (pool.totalPassengers >= totalCapacity) {
                    poolStatusIndicator.style.background = 'rgba(0, 184, 148, 0.1)';
                    poolStatusText.textContent = '‚úÖ';
                    poolStatusText.style.color = '#00b894';
                    poolStatusDesc.textContent = 'Pool Suffisant';
                } else if (pool.totalPassengers >= totalCapacity * 0.5) {
                    poolStatusIndicator.style.background = 'rgba(253, 203, 110, 0.1)';
                    poolStatusText.textContent = '‚ö†Ô∏è';
                    poolStatusText.style.color = '#fdcb6e';
                    poolStatusDesc.textContent = 'Pool Mod√©r√©';
                } else {
                    poolStatusIndicator.style.background = 'rgba(214, 48, 49, 0.1)';
                    poolStatusText.textContent = '‚ùå';
                    poolStatusText.style.color = '#d63031';
                    poolStatusDesc.textContent = 'Pool Insuffisant';
                }
            }
            
            // Afficher les promotions actives
            updateActivePromotionsList();
        }

        function updateActivePromotionsList() {
            const container = document.getElementById('active-promotions-list');
            if (!container) return;
            
            initializePassengerPool();
            const pool = gameState.passengerPool;
            const now = Date.now();
            const activePromotions = pool.activePromotions.filter(promo => now < promo.endTime);
            
            if (activePromotions.length === 0) {
                container.innerHTML = '';
                return;
            }
            
            let html = '<h3 style="color: #ffc107; margin-bottom: 15px;">üéÜ Promotions Actives</h3>';
            html += '<div style="display: grid; gap: 10px;">';
            
            activePromotions.forEach(promo => {
                const timeLeft = Math.ceil((promo.endTime - now) / (60 * 1000));
                html += `
                    <div style="background: rgba(255, 193, 7, 0.1); border: 1px solid #ffc107; border-radius: 10px; padding: 15px; display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-weight: bold; color: #ffc107;">${promo.name}</div>
                            <div style="font-size: 12px; opacity: 0.8;">G√©n√©ration x${promo.multiplier}</div>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-weight: bold; color: #00b894;">${timeLeft} min</div>
                            <div style="font-size: 10px; opacity: 0.8;">restantes</div>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
        }

        function calculatePromotionCost(type, discount) {
            const baseCosts = {
                'global': 500,
                'weekend': 800,
                'loyalty': 1200
            };
            return Math.floor((baseCosts[type] || 500) * (discount / 15));
        }

        function getPromotionDuration(type) {
            const durations = {
                'global': 5 * 60 * 1000, // 5 minutes
                'weekend': 10 * 60 * 1000, // 10 minutes
                'loyalty': 15 * 60 * 1000 // 15 minutes
            };
            return durations[type] || 5 * 60 * 1000;
        }

        function getPromotionName(type) {
            const names = {
                'global': 'Promotion G√©n√©rale',
                'weekend': 'Promotion Weekend',
                'loyalty': 'Clients Fid√®les'
            };
            return names[type] || 'Promotion';
        }

        function getPromotionEffect(type) {
            const effects = {
                'global': { demandBoost: 1.3, allDestinations: true },
                'weekend': { demandBoost: 1.5, weekendOnly: true },
                'loyalty': { demandBoost: 1.8, loyaltyBonus: true }
            };
            return effects[type] || { demandBoost: 1.2 };
        }

        function applyPromotionEffect(promotion) {
            gameState.destinations.forEach(dest => {
                const demand = gameState.clientSystem.demandByDestination[dest.id];
                const boost = Math.floor(demand.passengers * (promotion.effect.demandBoost - 1));
                demand.passengers += boost;
            });
            calculateTotalDemand();
        }

        function updatePromotions() {
            if (!gameState.clientSystem) return;
            
            const now = Date.now();
            gameState.clientSystem.activePromotions = gameState.clientSystem.activePromotions.filter(promo => {
                if (now - promo.startTime > promo.duration) {
                    showNotification(`‚è∞ Promotion "${getPromotionName(promo.type)}" termin√©e!`);
                    return false;
                }
                return true;
            });
        }

        function updateClientsDisplay() {
            initializeClientSystem();
            updateDemand();
            updatePromotions();
            
            // Mettre √† jour les statistiques
            document.getElementById('total-demand').textContent = gameState.clientSystem.totalDemand;
            document.getElementById('satisfaction-rate').textContent = Math.floor(gameState.clientSystem.satisfactionRate) + '%';
            document.getElementById('active-promos').textContent = gameState.clientSystem.activePromotions.length;
            
            // Afficher la demande par destination
            const container = document.getElementById('demand-by-destination');
            container.innerHTML = '';
            
            gameState.destinations.forEach(dest => {
                const demand = gameState.clientSystem.demandByDestination[dest.id];
                const demandCard = document.createElement('div');
                demandCard.className = 'destination-card';
                
                let trendIcon = 'üìä';
                let trendColor = '#74b9ff';
                if (demand.trend === 'increasing') {
                    trendIcon = 'üìà';
                    trendColor = '#00b894';
                } else if (demand.trend === 'decreasing') {
                    trendIcon = 'üìâ';
                    trendColor = '#e17055';
                }
                
                let capacityStatus = '';
                const totalCapacity = gameState.ships.reduce((sum, ship) => {
                    return ship.status === 'available' ? sum + ship.capacity : sum;
                }, 0);
                
                if (demand.passengers > totalCapacity) {
                    capacityStatus = '<div style="color: #e17055; font-size: 12px; margin-top: 5px;">‚ö†Ô∏è Capacit√© insuffisante</div>';
                } else if (demand.passengers < totalCapacity * 0.3) {
                    capacityStatus = '<div style="color: #fdcb6e; font-size: 12px; margin-top: 5px;">üí° Opportunit√© de promotion</div>';
                }
                
                // V√©rifier s'il y a une promo active sur cette destination
                const activePromo = gameState.clientSystem.activePromotions.find(p => p.targetDestination === dest.id);
                let promoStatus = '';
                if (activePromo) {
                    const timeLeft = Math.ceil((activePromo.startTime + activePromo.duration - Date.now()) / 60000);
                    promoStatus = `<div style="background: rgba(253, 203, 110, 0.2); border: 1px solid #fdcb6e; border-radius: 5px; padding: 5px; margin: 5px 0; font-size: 11px; text-align: center; color: #fdcb6e;">
                        üéÜ Promo -${activePromo.discount}% active (${timeLeft}min)
                    </div>`;
                }
                
                demandCard.innerHTML = `
                    <div class="destination-name">${dest.name}</div>
                    <div class="destination-info">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin: 10px 0;">
                            <span style="color: ${trendColor};">${trendIcon} ${demand.passengers} passagers</span>
                            <span style="color: #fdcb6e;">${demand.currentPrice || dest.reward || 100}‚Ç¨</span>
                        </div>
                        <div style="font-size: 12px; opacity: 0.8;">
                            Tendance: ${demand.trend === 'increasing' ? 'En hausse' : demand.trend === 'decreasing' ? 'En baisse' : 'Stable'}
                        </div>
                        ${promoStatus}
                        ${capacityStatus}
                        <div style="margin-top: 10px;">
                            <button onclick="launchTargetedPromotion(${dest.id}, 20)" 
                                    style="background: linear-gradient(45deg, #fdcb6e, #e17055); border: none; border-radius: 8px; color: white; padding: 8px 12px; font-size: 11px; font-weight: bold; cursor: pointer; width: 100%; margin-top: 5px;"
                                    ${activePromo ? 'disabled' : ''}>
                                ${activePromo ? '‚úÖ Promo Active' : 'üéÜ Promo -20%'}
                            </button>
                        </div>
                    </div>
                `;
                
                container.appendChild(demandCard);
            });
        }

        // Fonctions de navigation
        function showScreen(screenName) {
            currentScreen = screenName;
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.getElementById(screenName + '-screen').classList.add('active');
            event.target.classList.add('active');
            if(screenName === 'admin') updateGasFactoryAdminFields();
            if(screenName === 'sell') updateSellDisplay();
            if(screenName === 'clients') updateClientsDisplay();
        }

        // Fonctions audio
        function playSound(type) {
            const context = new (window.AudioContext || window.webkitAudioContext)();
            
            if (type === 'departure') {
                const oscillator = context.createOscillator();
                const gainNode = context.createGain();
                
                oscillator.frequency.setValueAtTime(150, context.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(100, context.currentTime + 1);
                
                gainNode.gain.setValueAtTime(0, context.currentTime);
                gainNode.gain.linearRampToValueAtTime(0.3, context.currentTime + 0.1);
                gainNode.gain.exponentialRampToValueAtTime(0.01, context.currentTime + 1);
                
                oscillator.connect(gainNode);
                gainNode.connect(context.destination);
                
                oscillator.start(context.currentTime);
                oscillator.stop(context.currentTime + 1);
                
            } else if (type === 'arrival') {
                const oscillator = context.createOscillator();
                const gainNode = context.createGain();
                
                oscillator.frequency.setValueAtTime(800, context.currentTime);
                oscillator.frequency.setValueAtTime(600, context.currentTime + 0.1);
                oscillator.frequency.setValueAtTime(800, context.currentTime + 0.2);
                
                gainNode.gain.setValueAtTime(0, context.currentTime);
                gainNode.gain.linearRampToValueAtTime(0.4, context.currentTime + 0.05);
                gainNode.gain.exponentialRampToValueAtTime(0.01, context.currentTime + 0.5);
                
                oscillator.connect(gainNode);
                gainNode.connect(context.destination);
                
                oscillator.start(context.currentTime);
                oscillator.stop(context.currentTime + 0.5);
                
            } else if (type === 'money') {
                for (let i = 0; i < 3; i++) {
                    setTimeout(() => {
                        const oscillator = context.createOscillator();
                        const gainNode = context.createGain();
                        
                        oscillator.frequency.setValueAtTime(1000 + Math.random() * 500, context.currentTime);
                        oscillator.frequency.exponentialRampToValueAtTime(600 + Math.random() * 200, context.currentTime + 0.1);
                        
                        gainNode.gain.setValueAtTime(0, context.currentTime);
                        gainNode.gain.linearRampToValueAtTime(0.2, context.currentTime + 0.01);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, context.currentTime + 0.15);
                        
                        oscillator.connect(gainNode);
                        gainNode.connect(context.destination);
                        
                        oscillator.start(context.currentTime);
                        oscillator.stop(context.currentTime + 0.15);
                    }, i * 50);
                }
            } else if (type === 'fuel') {
                const oscillator = context.createOscillator();
                const gainNode = context.createGain();
                
                oscillator.frequency.setValueAtTime(300, context.currentTime);
                oscillator.frequency.linearRampToValueAtTime(250, context.currentTime + 0.5);
                
                gainNode.gain.setValueAtTime(0, context.currentTime);
                gainNode.gain.linearRampToValueAtTime(0.3, context.currentTime + 0.1);
                gainNode.gain.exponentialRampToValueAtTime(0.01, context.currentTime + 0.8);
                
                oscillator.connect(gainNode);
                gainNode.connect(context.destination);
                
                oscillator.start(context.currentTime);
                oscillator.stop(context.currentTime + 0.8);
            }
        }

        // Fonctions Carburant
        function buyFuel() {
            const fuelToBuy = 50;
            const cost = fuelToBuy * (gameState.adminSettings?.fuelPricePerLiter || 2);
            
            if (gameState.money >= cost) {
                gameState.money -= cost;
                gameState.fuel += fuelToBuy;
                updateDisplay();
                showNotification(`+${fuelToBuy}L de carburant achet√© pour ${cost}‚Ç¨`);
                // Version simple - pas de son
                saveGame();
            } else {
                showNotification('Pas assez d\'argent pour acheter du carburant!');
                // Son d'erreur d√©sactiv√© pour version stable
            }
        }

        // Fonctions Admin
        function applyEconomySettings() {
            const startMoney = parseInt(document.getElementById('startMoney').value) || 1000;
            const startFuel = parseInt(document.getElementById('startFuel').value) || 100;
            const rewardMultiplier = parseFloat(document.getElementById('rewardMultiplier').value) || 1.0;
            
            gameState.adminSettings.startMoney = startMoney;
            gameState.adminSettings.startFuel = startFuel;
            gameState.adminSettings.rewardMultiplier = rewardMultiplier;
            
            showNotification('Param√®tres √©conomiques appliqu√©s !');
        }

        function applyShipPrices() {
            const prices = [
                parseInt(document.getElementById('ship1Price').value) || 2500,
                parseInt(document.getElementById('ship2Price').value) || 5000,
                parseInt(document.getElementById('ship3Price').value) || 15000,
                parseInt(document.getElementById('ship4Price').value) || 25000,
                parseInt(document.getElementById('ship5Price').value) || 45000,
                parseInt(document.getElementById('ship6Price').value) || 75000,
                parseInt(document.getElementById('ship7Price').value) || 120000,
                parseInt(document.getElementById('ship8Price').value) || 200000
            ];
            
            gameState.shopItems.forEach((item, index) => {
                if (index < prices.length) {
                    item.price = prices[index];
                }
            });
            
            showNotification('Prix des navires modifi√©s !');
            updateDisplay();
        }

        function applyShipSpecs() {
            const specs = [
                {
                    capacity: parseInt(document.getElementById('ship1Capacity').value) || 100,
                    speed: parseFloat(document.getElementById('ship1Speed').value) || 1.2,
                    fuelConsumption: parseFloat(document.getElementById('ship1Fuel').value) || 0.8
                },
                {
                    capacity: parseInt(document.getElementById('ship2Capacity').value) || 80,
                    speed: parseFloat(document.getElementById('ship2Speed').value) || 2,
                    fuelConsumption: parseFloat(document.getElementById('ship2Fuel').value) || 1.5
                },
                {
                    capacity: parseInt(document.getElementById('ship3Capacity').value) || 300,
                    speed: parseFloat(document.getElementById('ship3Speed').value) || 0.8,
                    fuelConsumption: parseFloat(document.getElementById('ship3Fuel').value) || 2.5
                },
                {
                    capacity: parseInt(document.getElementById('ship4Capacity').value) || 20,
                    speed: parseFloat(document.getElementById('ship4Speed').value) || 3,
                    fuelConsumption: parseFloat(document.getElementById('ship4Fuel').value) || 3
                },
                {
                    capacity: parseInt(document.getElementById('ship5Capacity').value) || 800,
                    speed: parseFloat(document.getElementById('ship5Speed').value) || 1.5,
                    fuelConsumption: parseFloat(document.getElementById('ship5Fuel').value) || 4.2
                },
                {
                    capacity: parseInt(document.getElementById('ship6Capacity').value) || 1500,
                    speed: parseFloat(document.getElementById('ship6Speed').value) || 1.8,
                    fuelConsumption: parseFloat(document.getElementById('ship6Fuel').value) || 6.5
                },
                {
                    capacity: parseInt(document.getElementById('ship7Capacity').value) || 2500,
                    speed: parseFloat(document.getElementById('ship7Speed').value) || 2.2,
                    fuelConsumption: parseFloat(document.getElementById('ship7Fuel').value) || 9.8
                },
                {
                    capacity: parseInt(document.getElementById('ship8Capacity').value) || 4000,
                    speed: parseFloat(document.getElementById('ship8Speed').value) || 2.5,
                    fuelConsumption: parseFloat(document.getElementById('ship8Fuel').value) || 15.0
                }
            ];
            
            gameState.shopItems.forEach((item, index) => {
                if (index < specs.length && specs[index]) {
                    item.specs.capacity = specs[index].capacity;
                    item.specs.speed = specs[index].speed;
                    item.specs.fuelConsumption = specs[index].fuelConsumption;
                }
            });
            
            // Mettre √† jour les navires existants avec les nouvelles sp√©cifications
            gameState.ships.forEach(ship => {
                const shopItem = gameState.shopItems.find(item => item.name === ship.name);
                if (shopItem) {
                    ship.capacity = shopItem.specs.capacity;
                    ship.speed = shopItem.specs.speed;
                    ship.fuelConsumption = shopItem.specs.fuelConsumption;
                }
            });
            
            showNotification('Sp√©cifications des navires mises √† jour !');
            updateDisplay();
        }

        function applyTicketPrices() {
            const ticketPrices = [
                parseFloat(document.getElementById('dest1Ticket').value) || 2,
                parseFloat(document.getElementById('dest2Ticket').value) || 8,
                parseFloat(document.getElementById('dest3Ticket').value) || 15,
                parseFloat(document.getElementById('dest4Ticket').value) || 45,
                parseFloat(document.getElementById('dest5Ticket').value) || 80,
                parseFloat(document.getElementById('dest6Ticket').value) || 60
            ];
            
            gameState.destinations.forEach((dest, index) => {
                if (ticketPrices[index] !== undefined) {
                    dest.ticketPrice = ticketPrices[index];
                }
            });
            
            showNotification('Prix des billets mis √† jour!');
            updateDisplay();
        }

        function applyDestinationRewards() {
            const rewards = [
                parseFloat(document.getElementById('dest1Reward').value) || 50,
                parseFloat(document.getElementById('dest2Reward').value) || 150,
                parseFloat(document.getElementById('dest3Reward').value) || 400,
                parseFloat(document.getElementById('dest4Reward').value) || 1200,
                parseFloat(document.getElementById('dest5Reward').value) || 2500,
                parseFloat(document.getElementById('dest6Reward').value) || 1800
            ];
            
            gameState.destinations.forEach((dest, index) => {
                if (rewards[index] !== undefined) {
                    dest.reward = rewards[index];
                }
            });
            
            showNotification('Gains des destinations mis √† jour!');
            updateDisplay();
        }

        function applyDestinationFuel() {
            const fuels = [
                parseInt(document.getElementById('dest1Fuel').value) || 5,
                parseInt(document.getElementById('dest2Fuel').value) || 15,
                parseInt(document.getElementById('dest3Fuel').value) || 40,
                parseInt(document.getElementById('dest4Fuel').value) || 120,
                parseInt(document.getElementById('dest5Fuel').value) || 200,
                parseInt(document.getElementById('dest6Fuel').value) || 150
            ];
            gameState.destinations.forEach((dest, i) => {
                if (i < fuels.length) {
                    dest.fuelCost = fuels[i];
                }
            });
            showNotification('Carburant requis par destination modifi√© !');
            updateDisplay();
        }

        function applyDestinationTimes() {
            const times = [
                parseFloat(document.getElementById('dest1Time').value) || 0.0833,
                parseFloat(document.getElementById('dest2Time').value) || 2,
                parseFloat(document.getElementById('dest3Time').value) || 6,
                parseFloat(document.getElementById('dest4Time').value) || 24,
                parseFloat(document.getElementById('dest5Time').value) || 48,
                parseFloat(document.getElementById('dest6Time').value) || 36
            ];
            
            gameState.destinations.forEach((dest, i) => {
                if (i < times.length) {
                    dest.distance = times[i];
                }
            });
            
            showNotification('Temps de livraison modifi√©s !');
            updateDisplay();
        }

        function applyMaintenanceSettings() {
            const maintenanceHours = parseInt(document.getElementById('maintenanceHours').value) || 50;
            const maintenanceCost = parseInt(document.getElementById('maintenanceCost').value) || 200;
            const maintenancePenalty = parseInt(document.getElementById('maintenancePenalty').value) || 50;
            
            if (!gameState.adminSettings) {
                gameState.adminSettings = {};
            }
            
            gameState.adminSettings.maintenanceHours = maintenanceHours;
            gameState.adminSettings.maintenanceCost = maintenanceCost;
            gameState.adminSettings.maintenancePenalty = maintenancePenalty;
            
            showNotification('Param√®tres de maintenance appliqu√©s !');
            updateDisplay();
        }

        function applyFuelSettings() {
            gameState.fuelPrice = parseFloat(document.getElementById('fuelPrice').value) || 2;
            showNotification('‚úÖ Param√®tres carburant appliqu√©s!');
            updateDisplay();
        }

        // Configuration admin pour le pool global de passagers
        function applyPassengerPoolSettings() {
            initializePassengerPool();
            
            const initialPool = parseInt(document.getElementById('initialPassengerPool').value) || 300;
            const generationRate = parseInt(document.getElementById('passengerGenerationRate').value) || 15;
            const generationInterval = parseInt(document.getElementById('generationInterval').value) || 30;
            const instantMultiplier = parseFloat(document.getElementById('instantPromoMultiplier').value) || 1.0;
            const temporalMultiplier = parseFloat(document.getElementById('temporalPromoMultiplier').value) || 2.0;
            
            // Appliquer les nouveaux param√®tres
            gameState.passengerPool.settings.generationRate = generationRate;
            gameState.passengerPool.settings.generationInterval = generationInterval * 60 * 1000; // Convertir en ms
            gameState.passengerPool.settings.instantPromoMultiplier = instantMultiplier;
            gameState.passengerPool.settings.temporalPromoMultiplier = temporalMultiplier;
            
            // R√©initialiser le pool si demand√©
            if (gameState.passengerPool.totalPassengers !== initialPool) {
                gameState.passengerPool.totalPassengers = initialPool;
            }
            
            showNotification('‚úÖ Param√®tres du pool de passagers appliqu√©s!');
            updateDisplay();
            updatePoolDisplay();
            saveGame();
        }

        function addMoney() {
            gameState.money += 1000;
            showNotification('+1000‚Ç¨ ajout√© !');
            updateDisplay();
        }

        function addFuel() {
            gameState.fuel += 500;
            showNotification('+500L de carburant ajout√© !');
            updateDisplay();
        }

        function maxReputation() {
            gameState.reputation += 1000;
            gameState.level = Math.floor(gameState.reputation / 100) + 1;
            showNotification('R√©putation maximis√©e !');
            updateDisplay();
        }

        function initializeAdminFields() {
            // Initialiser les champs avec les valeurs actuelles du jeu
            if (gameState.destinations && gameState.destinations.length >= 6) {
                // Temps de livraison
                if(document.getElementById('dest1Time')) document.getElementById('dest1Time').value = gameState.destinations[0].distance || 0.0833;
                if(document.getElementById('dest2Time')) document.getElementById('dest2Time').value = gameState.destinations[1].distance || 2;
                if(document.getElementById('dest3Time')) document.getElementById('dest3Time').value = gameState.destinations[2].distance || 6;
                if(document.getElementById('dest4Time')) document.getElementById('dest4Time').value = gameState.destinations[3].distance || 24;
                if(document.getElementById('dest5Time')) document.getElementById('dest5Time').value = gameState.destinations[4].distance || 48;
                if(document.getElementById('dest6Time')) document.getElementById('dest6Time').value = gameState.destinations[5].distance || 36;
                
                // Carburant par destination
                if(document.getElementById('dest1Fuel')) document.getElementById('dest1Fuel').value = gameState.destinations[0].fuelCost || 5;
                if(document.getElementById('dest2Fuel')) document.getElementById('dest2Fuel').value = gameState.destinations[1].fuelCost || 15;
                if(document.getElementById('dest3Fuel')) document.getElementById('dest3Fuel').value = gameState.destinations[2].fuelCost || 40;
                if(document.getElementById('dest4Fuel')) document.getElementById('dest4Fuel').value = gameState.destinations[3].fuelCost || 120;
                if(document.getElementById('dest5Fuel')) document.getElementById('dest5Fuel').value = gameState.destinations[4].fuelCost || 200;
                if(document.getElementById('dest6Fuel')) document.getElementById('dest6Fuel').value = gameState.destinations[5].fuelCost || 150;
                
                // R√©compenses par destination
                if(document.getElementById('dest1Reward')) document.getElementById('dest1Reward').value = gameState.destinations[0].reward || 50;
                if(document.getElementById('dest2Reward')) document.getElementById('dest2Reward').value = gameState.destinations[1].reward || 150;
                if(document.getElementById('dest3Reward')) document.getElementById('dest3Reward').value = gameState.destinations[2].reward || 400;
                if(document.getElementById('dest4Reward')) document.getElementById('dest4Reward').value = gameState.destinations[3].reward || 1200;
                if(document.getElementById('dest5Reward')) document.getElementById('dest5Reward').value = gameState.destinations[4].reward || 2500;
                if(document.getElementById('dest6Reward')) document.getElementById('dest6Reward').value = gameState.destinations[5].reward || 1800;
            }
            
            // Param√®tres de maintenance
            if (gameState.adminSettings) {
                if(document.getElementById('maintenanceHours')) document.getElementById('maintenanceHours').value = gameState.adminSettings.maintenanceHours || 50;
                if(document.getElementById('maintenanceCost')) document.getElementById('maintenanceCost').value = gameState.adminSettings.maintenanceCost || 200;
                if(document.getElementById('maintenancePenalty')) document.getElementById('maintenancePenalty').value = gameState.adminSettings.maintenancePenalty || 50;
            }
            
            // Prix des billets par destination
            if (gameState.destinations && gameState.destinations.length >= 6) {
                if(document.getElementById('dest1Ticket')) document.getElementById('dest1Ticket').value = gameState.destinations[0].ticketPrice || 2;
                if(document.getElementById('dest2Ticket')) document.getElementById('dest2Ticket').value = gameState.destinations[1].ticketPrice || 8;
                if(document.getElementById('dest3Ticket')) document.getElementById('dest3Ticket').value = gameState.destinations[2].ticketPrice || 15;
                if(document.getElementById('dest4Ticket')) document.getElementById('dest4Ticket').value = gameState.destinations[3].ticketPrice || 45;
                if(document.getElementById('dest5Ticket')) document.getElementById('dest5Ticket').value = gameState.destinations[4].ticketPrice || 80;
                if(document.getElementById('dest6Ticket')) document.getElementById('dest6Ticket').value = gameState.destinations[5].ticketPrice || 60;
            }
            
            // Prix des navires
            if (gameState.shopItems && gameState.shopItems.length >= 8) {
                if(document.getElementById('ship1Price')) document.getElementById('ship1Price').value = gameState.shopItems[0].price || 2500;
                if(document.getElementById('ship2Price')) document.getElementById('ship2Price').value = gameState.shopItems[1].price || 5000;
                if(document.getElementById('ship3Price')) document.getElementById('ship3Price').value = gameState.shopItems[2].price || 15000;
                if(document.getElementById('ship4Price')) document.getElementById('ship4Price').value = gameState.shopItems[3].price || 25000;
                if(document.getElementById('ship5Price')) document.getElementById('ship5Price').value = gameState.shopItems[4].price || 45000;
                if(document.getElementById('ship6Price')) document.getElementById('ship6Price').value = gameState.shopItems[5].price || 75000;
                if(document.getElementById('ship7Price')) document.getElementById('ship7Price').value = gameState.shopItems[6].price || 120000;
                if(document.getElementById('ship8Price')) document.getElementById('ship8Price').value = gameState.shopItems[7].price || 200000;
            }
            
            // Sp√©cifications des navires
            if (gameState.shopItems && gameState.shopItems.length >= 8) {
                if(document.getElementById('ship1Capacity')) document.getElementById('ship1Capacity').value = gameState.shopItems[0].specs.capacity || 100;
                if(document.getElementById('ship1Speed')) document.getElementById('ship1Speed').value = gameState.shopItems[0].specs.speed || 1.2;
                if(document.getElementById('ship1Fuel')) document.getElementById('ship1Fuel').value = gameState.shopItems[0].specs.fuelConsumption || 0.8;
                
                if(document.getElementById('ship2Capacity')) document.getElementById('ship2Capacity').value = gameState.shopItems[1].specs.capacity || 80;
                if(document.getElementById('ship2Speed')) document.getElementById('ship2Speed').value = gameState.shopItems[1].specs.speed || 2;
                if(document.getElementById('ship2Fuel')) document.getElementById('ship2Fuel').value = gameState.shopItems[1].specs.fuelConsumption || 1.5;
                
                if(document.getElementById('ship3Capacity')) document.getElementById('ship3Capacity').value = gameState.shopItems[2].specs.capacity || 300;
                if(document.getElementById('ship3Speed')) document.getElementById('ship3Speed').value = gameState.shopItems[2].specs.speed || 0.8;
                if(document.getElementById('ship3Fuel')) document.getElementById('ship3Fuel').value = gameState.shopItems[2].specs.fuelConsumption || 2.5;
                
                if(document.getElementById('ship4Capacity')) document.getElementById('ship4Capacity').value = gameState.shopItems[3].specs.capacity || 20;
                if(document.getElementById('ship4Speed')) document.getElementById('ship4Speed').value = gameState.shopItems[3].specs.speed || 3;
                if(document.getElementById('ship4Fuel')) document.getElementById('ship4Fuel').value = gameState.shopItems[3].specs.fuelConsumption || 3;
                
                if(document.getElementById('ship5Capacity')) document.getElementById('ship5Capacity').value = gameState.shopItems[4].specs.capacity || 800;
                if(document.getElementById('ship5Speed')) document.getElementById('ship5Speed').value = gameState.shopItems[4].specs.speed || 1.5;
                if(document.getElementById('ship5Fuel')) document.getElementById('ship5Fuel').value = gameState.shopItems[4].specs.fuelConsumption || 4.2;
                
                if(document.getElementById('ship6Capacity')) document.getElementById('ship6Capacity').value = gameState.shopItems[5].specs.capacity || 1500;
                if(document.getElementById('ship6Speed')) document.getElementById('ship6Speed').value = gameState.shopItems[5].specs.speed || 1.8;
                if(document.getElementById('ship6Fuel')) document.getElementById('ship6Fuel').value = gameState.shopItems[5].specs.fuelConsumption || 6.5;
                
                if(document.getElementById('ship7Capacity')) document.getElementById('ship7Capacity').value = gameState.shopItems[6].specs.capacity || 2500;
                if(document.getElementById('ship7Speed')) document.getElementById('ship7Speed').value = gameState.shopItems[6].specs.speed || 2.2;
                if(document.getElementById('ship7Fuel')) document.getElementById('ship7Fuel').value = gameState.shopItems[6].specs.fuelConsumption || 9.8;
                
                if(document.getElementById('ship8Capacity')) document.getElementById('ship8Capacity').value = gameState.shopItems[7].specs.capacity || 4000;
                if(document.getElementById('ship8Speed')) document.getElementById('ship8Speed').value = gameState.shopItems[7].specs.speed || 2.5;
                if(document.getElementById('ship8Fuel')) document.getElementById('ship8Fuel').value = gameState.shopItems[7].specs.fuelConsumption || 15.0;
            }
            
            // Param√®tres du pool de passagers
            initializePassengerPool();
            if (gameState.passengerPool && gameState.passengerPool.settings) {
                if(document.getElementById('initialPassengerPool')) document.getElementById('initialPassengerPool').value = gameState.passengerPool.totalPassengers || 300;
                if(document.getElementById('passengerGenerationRate')) document.getElementById('passengerGenerationRate').value = gameState.passengerPool.settings.generationRate || 15;
                if(document.getElementById('generationInterval')) document.getElementById('generationInterval').value = (gameState.passengerPool.settings.generationInterval || 1800000) / 60000; // Convertir ms en minutes
                if(document.getElementById('instantPromoMultiplier')) document.getElementById('instantPromoMultiplier').value = gameState.passengerPool.settings.instantPromoMultiplier || 1.0;
                if(document.getElementById('temporalPromoMultiplier')) document.getElementById('temporalPromoMultiplier').value = gameState.passengerPool.settings.temporalPromoMultiplier || 2.0;
            }
        }

        function resetToDefaults() {
            document.getElementById('startMoney').value = 1000;
            document.getElementById('startFuel').value = 100;
            document.getElementById('rewardMultiplier').value = 1.0;
            document.getElementById('fuelPrice').value = 2;
            
            document.getElementById('ship1Price').value = 2500;
            document.getElementById('ship2Price').value = 5000;
            document.getElementById('ship3Price').value = 15000;
            document.getElementById('ship4Price').value = 25000;
            if(document.getElementById('ship5Price')) document.getElementById('ship5Price').value = 45000;
            if(document.getElementById('ship6Price')) document.getElementById('ship6Price').value = 75000;
            if(document.getElementById('ship7Price')) document.getElementById('ship7Price').value = 120000;
            if(document.getElementById('ship8Price')) document.getElementById('ship8Price').value = 200000;
            
            document.getElementById('dest1Reward').value = 50;
            document.getElementById('dest2Reward').value = 150;
            document.getElementById('dest3Reward').value = 400;
            document.getElementById('dest4Reward').value = 1200;
            document.getElementById('dest5Reward').value = 2500;
            document.getElementById('dest6Reward').value = 1800;
            
            // Reset carburant par destination (si les champs existent)
            if(document.getElementById('dest1Fuel')) document.getElementById('dest1Fuel').value = 5;
            if(document.getElementById('dest2Fuel')) document.getElementById('dest2Fuel').value = 15;
            if(document.getElementById('dest3Fuel')) document.getElementById('dest3Fuel').value = 40;
            if(document.getElementById('dest4Fuel')) document.getElementById('dest4Fuel').value = 120;
            if(document.getElementById('dest5Fuel')) document.getElementById('dest5Fuel').value = 200;
            if(document.getElementById('dest6Fuel')) document.getElementById('dest6Fuel').value = 150;
            
            // Reset temps de livraison par destination (si les champs existent)
            if(document.getElementById('dest1Time')) document.getElementById('dest1Time').value = 0.0833;
            if(document.getElementById('dest2Time')) document.getElementById('dest2Time').value = 2;
            if(document.getElementById('dest3Time')) document.getElementById('dest3Time').value = 6;
            if(document.getElementById('dest4Time')) document.getElementById('dest4Time').value = 24;
            if(document.getElementById('dest5Time')) document.getElementById('dest5Time').value = 48;
            if(document.getElementById('dest6Time')) document.getElementById('dest6Time').value = 36;
            
            // Reset param√®tres de maintenance (si les champs existent)
            if(document.getElementById('maintenanceHours')) document.getElementById('maintenanceHours').value = 50;
            if(document.getElementById('maintenanceCost')) document.getElementById('maintenanceCost').value = 200;
            if(document.getElementById('maintenancePenalty')) document.getElementById('maintenancePenalty').value = 50;
            
            showNotification('Param√®tres r√©initialis√©s aux valeurs par d√©faut !');
        }

        function exportSettings() {
            const settings = {
                adminSettings: gameState.adminSettings,
                shipPrices: gameState.shopItems.map(item => item.price),
                destinationRewards: gameState.destinations.map(dest => dest.reward),
                destinationFuelCosts: gameState.destinations.map(dest => dest.fuelCost)
            };
            
            const dataStr = JSON.stringify(settings, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'maritime_empire_config.json';
            link.click();
            
            showNotification('Configuration export√©e !');
        }

        function importSettings() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const settings = JSON.parse(e.target.result);
                            
                            if (settings.adminSettings) {
                                gameState.adminSettings = settings.adminSettings;
                            }
                            if (settings.shipPrices) {
                                settings.shipPrices.forEach((price, index) => {
                                    if (gameState.shopItems[index]) {
                                        gameState.shopItems[index].price = price;
                                    }
                                });
                            }
                            if (settings.destinationRewards) {
                                settings.destinationRewards.forEach((reward, index) => {
                                    if (gameState.destinations[index]) {
                                        gameState.destinations[index].reward = reward;
                                    }
                                });
                            }
                            if (settings.destinationFuelCosts) {
                                settings.destinationFuelCosts.forEach((fuel, index) => {
                                    if (gameState.destinations[index]) {
                                        gameState.destinations[index].fuelCost = fuel;
                                    }
                                });
                            }
                            
                            showNotification('Configuration import√©e avec succ√®s !');
                            updateDisplay();
                        } catch (error) {
                            showNotification('Erreur lors de l\'importation !');
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }

        function resetGame() {
            if (confirm('√ätes-vous s√ªr de vouloir recommencer le jeu ? Toutes vos donn√©es seront perdues !')) {
                Object.keys(localStorage).forEach(key => {
                    if (key.startsWith('maritimeEmpire')) {
                        localStorage.removeItem(key);
                    }
                });
                
                gameState = {
                    money: gameState.adminSettings?.startMoney || 1000,
                    fuel: gameState.adminSettings?.startFuel || 100,
                    reputation: 0,
                    level: 1,
                    ships: [
                        {
                            id: 1,
                            name: "Petit Cargo",
                            type: "cargo",
                            capacity: 50,
                            speed: 1,
                            fuelConsumption: 1,
                            status: "available",
                            destination: null,
                            arrivalTime: null,
                            earnings: 0,
                            hoursNavigated: 0,
                            needsMaintenance: false
                        }
                    ],
                    destinations: [
                        {
                            id: 1,
                            name: "Port Local",
                            distance: 0.0833,
                            reward: 50,
                            reputation: 2,
                            fuelCost: 5,
                            description: "Livraison express locale"
                        },
                        {
                            id: 2,
                            name: "Marseille",
                            distance: 2,
                            reward: 150,
                            reputation: 5,
                            fuelCost: 15,
                            description: "Port m√©diterran√©en anim√©"
                        },
                        {
                            id: 3,
                            name: "Londres",
                            distance: 6,
                            reward: 400,
                            reputation: 15,
                            fuelCost: 40,
                            description: "Grand port commercial"
                        },
                        {
                            id: 4,
                            name: "New York",
                            distance: 24,
                            reward: 1200,
                            reputation: 40,
                            fuelCost: 120,
                            description: "M√©tropole am√©ricaine"
                        },
                        {
                            id: 5,
                            name: "Tokyo",
                            distance: 48,
                            reward: 2500,
                            reputation: 80,
                            fuelCost: 200,
                            description: "Capital du Pacifique"
                        },
                        {
                            id: 6,
                            name: "Singapour",
                            distance: 36,
                            reward: 1800,
                            reputation: 60,
                            fuelCost: 150,
                            description: "Hub asiatique"
                        }
                    ],
                    shopItems: [
                        {
                            id: 1,
                            name: "Cargo Standard",
                            price: 2500,
                            type: "ship",
                            specs: { capacity: 100, speed: 1.2, fuelConsumption: 0.8 }
                        },
                        {
                            id: 2,
                            name: "Cargo Rapide",
                            price: 5000,
                            type: "ship",
                            specs: { capacity: 80, speed: 2, fuelConsumption: 1.5 }
                        },
                        {
                            id: 3,
                            name: "Porte-conteneurs",
                            price: 15000,
                            type: "ship",
                            specs: { capacity: 300, speed: 0.8, fuelConsumption: 2.5 }
                        },
                        {
                            id: 4,
                            name: "Yacht de Luxe",
                            price: 25000,
                            type: "ship",
                            specs: { capacity: 20, speed: 3, fuelConsumption: 3 }
                        }
                    ],
                    statistics: {
                        totalEarnings: 0,
                        totalTrips: 0,
                        totalDistance: 0,
                        totalFuelConsumed: 0
                    },
                    adminSettings: gameState.adminSettings || {
                        rewardMultiplier: 1.0,
                        startMoney: 1000,
                        startFuel: 100,
                        fuelPricePerLiter: 2,
                        maintenanceHours: 50,
                        maintenanceCost: 200
                    }
                };
                
                selectedShip = null;
                updateDisplay();
                showNotification('Jeu r√©initialis√© avec succ√®s ! Bon voyage capitaine ! üö¢');
            }
        }

        // Fonctions de jeu
        function selectShipForTravel(shipId) {
            selectedShip = gameState.ships.find(ship => ship.id === shipId);
            showScreen('destinations');
            
            const info = document.getElementById('selected-ship-info');
            info.innerHTML = `
                <div style="background: rgba(0,212,255,0.1); padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                    <h3>üö¢ ${selectedShip.name} s√©lectionn√©</h3>
                    <p>Capacit√©: ${selectedShip.capacity} | Vitesse: ${selectedShip.speed}x | Consommation: ${selectedShip.fuelConsumption}x</p>
                </div>
            `;
        }

        function selectDestination(destination) {
            if (!selectedShip) {
                showNotification('Veuillez d\'abord s√©lectionner un navire');
                return;
            }

            const fuelRequired = Math.ceil(destination.fuelCost * selectedShip.fuelConsumption);
            
            if (gameState.fuel < fuelRequired) {
                showNotification(`Carburant insuffisant ! Il vous faut ${fuelRequired}L pour ce voyage.`);
                return;
            }

            const modal = document.getElementById('travel-modal');
            const details = document.getElementById('travel-details');
            
            let travelTime = destination.distance / selectedShip.speed;
            if (destination.name === "Port Local") {
                travelTime = 5 / 60;
            }
            
            // **NOUVEAU SYST√àME : Pool Global de Passagers**
            initializePassengerPool();
            const pool = gameState.passengerPool;
            const availablePassengers = pool.totalPassengers;
            const passengersBoarded = Math.min(availablePassengers, selectedShip.capacity);
            
            // Calculer les gains r√©els bas√©s sur les passagers du pool global
            let realEarnings = 0;
            if (passengersBoarded > 0) {
                // Utiliser le prix du billet (ticketPrice) au lieu de reward divis√© par 100
                const ticketPrice = destination.ticketPrice || destination.reward || 10;
                realEarnings = Math.floor(passengersBoarded * ticketPrice);
                realEarnings = Math.floor(realEarnings * (gameState.adminSettings?.rewardMultiplier || 1.0));
            } else {
                realEarnings = 0; // Pas de passagers = pas de gains
            }

            const timeDisplay = destination.name === "Port Local" ? 
                "5 minutes" :
                (travelTime < 1 ? 
                    Math.round(travelTime * 60) + ' minutes' : 
                    Math.round(travelTime) + ' heure(s)');
            
            // Statut de remplissage
            let fillStatus = '';
            let fillColor = '#74b9ff';
            if (passengersBoarded === 0) {
                fillStatus = 'üò≠ Voyage √† vide';
                fillColor = '#e17055';
            } else if (passengersBoarded === selectedShip.capacity) {
                fillStatus = 'üéâ Navire plein !';
                fillColor = '#00b894';
            } else if (passengersBoarded >= selectedShip.capacity * 0.8) {
                fillStatus = 'üòä Bien rempli';
                fillColor = '#fdcb6e';
            } else {
                fillStatus = 'üòê Partiellement rempli';
                fillColor = '#74b9ff';
            }

            details.innerHTML = `
                <h3>üö¢ ${selectedShip.name} ‚Üí ${destination.name}</h3>
                <div style="margin: 20px 0;">
                    <div style="background: rgba(0, 212, 255, 0.1); border: 1px solid #00d4ff; border-radius: 8px; padding: 10px; margin: 10px 0;">
                        <div style="color: #00d4ff; font-weight: bold; margin-bottom: 5px;">üèä Pool Global de Passagers</div>
                        <div><strong>Passagers disponibles:</strong> ${availablePassengers} dans le pool</div>
                        <div><strong>Embarquement:</strong> ${passengersBoarded}/${selectedShip.capacity} places</div>
                        <div style="color: ${fillColor}; font-weight: bold;">${fillStatus}</div>
                    </div>
                    <div><strong>Temps de voyage:</strong> ${timeDisplay}</div>
                    <div><strong>Gains r√©els:</strong> ${realEarnings}‚Ç¨ ${passengersBoarded === 0 ? '(üö® R√©duits - voyage √† vide)' : ''}</div>
                    <div><strong>R√©putation:</strong> +${destination.reputation}</div>
                    <div><strong>Carburant requis:</strong> ${fuelRequired}L</div>
                    <div style="margin-top: 10px; opacity: 0.8;">${destination.description}</div>
                </div>
            `;
            
            modal.style.display = 'block';
            modal.selectedDestination = destination;
        }

        function startTravel() {
            const destination = document.getElementById('travel-modal').selectedDestination;
            const fuelRequired = Math.ceil(destination.fuelCost * selectedShip.fuelConsumption);
            
            let travelTime = destination.distance / selectedShip.speed;
            
            // D√©duire le carburant
            gameState.fuel -= fuelRequired;
            gameState.statistics.totalFuelConsumed += fuelRequired;
            
            // Son de d√©part
            playSound('departure');
            
            // **NOUVEAU SYST√àME : Pool Global de Passagers**
            initializePassengerPool();
            const pool = gameState.passengerPool;
            
            // Calculer combien de passagers peuvent embarquer depuis le pool global
            const passengersBoarded = Math.min(pool.totalPassengers, selectedShip.capacity);
            
            // **NOUVEAU SYST√àME : Gain = Prix du billet √ó Nombre de passagers**
            let earnings = 0;
            if (passengersBoarded > 0) {
                // Prix du billet par passager (configurable par destination)
                const ticketPrice = destination.ticketPrice || destination.reward || 10; // Prix par billet
                earnings = Math.floor(passengersBoarded * ticketPrice);
                earnings = Math.floor(earnings * (gameState.adminSettings?.rewardMultiplier || 1.0));
                
                // R√©duire le pool global apr√®s embarquement
                pool.totalPassengers = Math.max(0, pool.totalPassengers - passengersBoarded);
            } else {
                // Pas de passagers = voyage √† vide = co√ªts de carburant seulement
                earnings = 0; // Aucun gain sans passagers
            }

            selectedShip.status = 'traveling';
            selectedShip.destination = destination;
            selectedShip.departureTime = Date.now();
            selectedShip.travelTime = travelTime;
            selectedShip.earnings = earnings;
            selectedShip.passengersBoarded = passengersBoarded; // Stocker pour affichage

            playSound('departure');

            closeModal();
            
            // Notification am√©lior√©e avec info passagers
            if (passengersBoarded > 0) {
                showNotification(`${selectedShip.name} part vers ${destination.name} avec ${passengersBoarded} passagers! (-${fuelRequired}L carburant)`);
            } else {
                showNotification(`${selectedShip.name} part vers ${destination.name} √† vide... (-${fuelRequired}L carburant)`);
            }
            
            selectedShip = null;
            
            updateDisplay();
            updatePoolDisplay(); // Mettre √† jour l'affichage du pool
            showScreen('fleet');
        }

        function buyItem(itemId) {
            const item = gameState.shopItems.find(i => i.id === itemId);
            if (!item) return;

            if (gameState.money >= item.price) {
                gameState.money -= item.price;
                
                const newShip = {
                    id: Date.now(),
                    name: item.name,
                    status: 'available',
                    capacity: item.specs.capacity,
                    speed: item.specs.speed,
                    fuelConsumption: item.specs.fuelConsumption,
                    earnings: 0,
                    hoursNavigated: 0,
                    needsMaintenance: false
                };
                
                gameState.ships.push(newShip);
                updateDisplay();
                showNotification(`${item.name} achet√© avec succ√®s !`);
                // Version simple - pas de son
                saveGame();
            } else {
                showNotification('Pas assez d\'argent pour cet achat!');
                playSound('error');
            }
        }

        function performMaintenance(shipId, isPreventive = false) {
            const ship = gameState.ships.find(s => s.id === shipId);
            if (!ship) return;
            
            // V√©rifier si le navire est en voyage
            if (ship.status === 'traveling') {
                showNotification('Impossible de faire la maintenance pendant un voyage!');
                return;
            }
            
            let cost = gameState.adminSettings?.maintenanceCost || 200;
            
            // Maintenance d'urgence (obligatoire) avec p√©nalit√©
            if (ship.needsMaintenance || ship.status === 'maintenance_required') {
                const penalty = gameState.adminSettings?.maintenancePenalty || 50;
                cost += penalty;
            }
            
            if (gameState.money >= cost) {
                gameState.money -= cost;
                ship.needsMaintenance = false;
                ship.hoursNavigated = 0;
                ship.status = 'available';
                
                updateDisplay();
                
                if (isPreventive) {
                    showNotification(`üîß ${ship.name} : maintenance pr√©ventive effectu√©e pour ${cost}‚Ç¨`);
                } else {
                    showNotification(`‚ö†Ô∏è ${ship.name} : maintenance d'urgence effectu√©e pour ${cost}‚Ç¨`);
                }
                
                playSound('success');
                saveGame();
            } else {
                showNotification('Pas assez d\'argent pour la maintenance!');
                playSound('error');
            }
        }

        function checkArrivals() {
            const now = Date.now();
            gameState.ships.forEach(ship => {
                if (ship.status === 'traveling') {
                    let hasArrived = false;
                    let destination = null;
                    
                    // Nouveau syst√®me avec arrivalTime
                    if (ship.arrivalTime && now >= ship.arrivalTime) {
                        hasArrived = true;
                        destination = gameState.destinations.find(d => d.id === ship.destination);
                    }
                    // Ancien syst√®me avec departureTime et travelTime (compatibilit√©)
                    else if (ship.departureTime && ship.travelTime) {
                        const travelTime = ship.travelTime * 60 * 60 * 1000;
                        const elapsed = now - ship.departureTime;
                        if (elapsed >= travelTime) {
                            hasArrived = true;
                            destination = ship.destination; // Dans l'ancien syst√®me, destination √©tait l'objet complet
                        }
                    }
                    
                    if (hasArrived && destination) {
                        ship.status = 'available';
                        
                        // **NOUVEAU SYST√àME : Calculer les gains bas√©s sur les passagers embarqu√©s**
                        let reward = 0;
                        let travelHours = 0;
                        let destObj = null;
                        
                        // Trouver l'objet destination
                        if (typeof destination === 'object' && destination.name) {
                            // Ancien format - destination est l'objet complet
                            destObj = destination;
                        } else {
                            // Nouveau format - destination est l'ID
                            destObj = gameState.destinations.find(d => d.id === destination);
                        }
                        
                        if (destObj) {
                            travelHours = destObj.distance / (ship.speed || 1);
                            gameState.reputation += destObj.reputation;
                            
                            // **NOUVEAU CALCUL : Gains = Passagers embarqu√©s √ó Prix du billet**
                            const passengersBoarded = ship.passengersBoarded || 0;
                            const ticketPrice = destObj.ticketPrice || destObj.reward || 10;
                            
                            if (passengersBoarded > 0) {
                                reward = Math.floor(passengersBoarded * ticketPrice * (gameState.adminSettings?.rewardMultiplier || 1.0));
                            } else {
                                // Voyage √† vide = aucun gain
                                reward = 0;
                            }
                            
                            destination = destObj; // Pour les notifications
                        }
                        
                        gameState.money += reward;
                        gameState.level = Math.floor(gameState.reputation / 100) + 1;
                        ship.earnings = (ship.earnings || 0) + reward;
                        
                        // Ajouter les heures de navigation
                        ship.hoursNavigated = (ship.hoursNavigated || 0) + travelHours;
                        
                        // V√©rifier si maintenance n√©cessaire
                        const maintenanceHours = gameState.adminSettings?.maintenanceHours || 50;
                        if (ship.hoursNavigated >= maintenanceHours) {
                            ship.needsMaintenance = true;
                            ship.status = "maintenance_required";
                            showNotification(`‚ö†Ô∏è ${ship.name} n√©cessite une maintenance !`);
                        }
                        
                        // Ajouter aux statistiques
                        if (!gameState.statistics) gameState.statistics = { totalTrips: 0, totalEarnings: 0, totalDistance: 0, totalFuelConsumed: 0 };
                        gameState.statistics.totalTrips = (gameState.statistics.totalTrips || 0) + 1;
                        gameState.statistics.totalEarnings = (gameState.statistics.totalEarnings || 0) + reward;
                        gameState.statistics.totalDistance = (gameState.statistics.totalDistance || 0) + travelHours;
                        
                        // Ajouter la consommation de carburant
                        let fuelConsumed = 0;
                        if (typeof destination === 'object' && destination.fuelCost) {
                            fuelConsumed = Math.ceil(destination.fuelCost * (ship.fuelConsumption || 1));
                        } else {
                            const destObj = gameState.destinations.find(d => d.id === destination || (typeof destination === 'object' && d.id === destination.id));
                            if (destObj) {
                                fuelConsumed = Math.ceil(destObj.fuelCost * (ship.fuelConsumption || 1));
                            }
                        }
                        gameState.statistics.totalFuelConsumed = (gameState.statistics.totalFuelConsumed || 0) + fuelConsumed;
                        
                        // Notifications et sons
                        if (ship.status === "available") {
                            showNotification(`${ship.name} est arriv√© √† ${destination.name} ! +${reward}‚Ç¨`);
                            // Version simple - pas de son
                            if (reward > 0) {
                                // Version simple - pas de son
                            }
                        } else if (ship.status === "maintenance_required") {
                            // Version simple - pas de son
                        }
                        
                        // Nettoyer les propri√©t√©s de voyage
                        ship.destination = null;
                        ship.arrivalTime = null;
                        ship.departureTime = null;
                        ship.travelTime = null;
                        ship.passengersBoarded = 0; // R√©initialiser les passagers
                    }
                }
            });
        }

        function launchPromotion(destination) {
            const cost = 500;
            
            if (gameState.money >= cost) {
                gameState.money -= cost;
                
                // Augmenter temporairement la demande pour cette destination
                if (!gameState.promotions) gameState.promotions = {};
                gameState.promotions[destination] = {
                    active: true,
                    duration: 300000, // 5 minutes
                    startTime: Date.now(),
                    multiplier: 2.0
                };
                
                updateDisplay();
                showNotification(`üéØ Promotion lanc√©e sur ${destination} ! Demande x2 pendant 5 min`);
                // Version simple - pas de son
                saveGame();
            } else {
                showNotification('Pas assez d\'argent pour lancer une promotion!');
                // Son d'erreur d√©sactiv√© pour version stable
            }
        }

        function saveGame() {
            const saveData = {
                ...gameState,
                timestamp: Date.now()
            };
            
            localStorage.setItem('maritimeEmpire_auto', JSON.stringify(saveData));
            const saveKey = `maritimeEmpire_${Date.now()}`;
            localStorage.setItem(saveKey, JSON.stringify(saveData));
            
            showNotification('Jeu sauvegard√© avec succ√®s!');
        }

        function loadGame() {
            const saveData = localStorage.getItem('maritimeEmpire_auto');
            if (saveData) {
                const parsed = JSON.parse(saveData);
                gameState = parsed;
                
                // Assurer la compatibilit√© avec les nouvelles fonctionnalit√©s
                if (!gameState.adminSettings) {
                    gameState.adminSettings = {
                        rewardMultiplier: 1.0,
                        startMoney: 1000,
                        startFuel: 100,
                        fuelPricePerLiter: 2,
                        maintenanceHours: 50,
                        maintenanceCost: 200
                    };
                }
                
                // Ajouter fuel si manquant
                if (gameState.fuel === undefined) {
                    gameState.fuel = 100;
                }
                
                // Ajouter fuelConsumption aux navires existants
                gameState.ships.forEach(ship => {
                    if (ship.fuelConsumption === undefined) {
                        ship.fuelConsumption = 1;
                    }
                    // Ajouter les propri√©t√©s de maintenance aux navires existants
                    if (ship.hoursNavigated === undefined) {
                        ship.hoursNavigated = 0;
                    }
                    if (ship.needsMaintenance === undefined) {
                        ship.needsMaintenance = false;
                    }
                });
                
                // Ajouter fuelCost aux destinations existantes
                const defaultFuelCosts = [5, 15, 40, 120, 200, 150];
                gameState.destinations.forEach((dest, index) => {
                    if (dest.fuelCost === undefined) {
                        dest.fuelCost = defaultFuelCosts[index] || 50;
                    }
                });
                
                // Ajouter ticketPrice aux destinations existantes (prix r√©alistes par billet)
                const defaultTicketPrices = [2, 8, 15, 45, 80, 60]; // Prix par passager
                gameState.destinations.forEach((dest, index) => {
                    if (dest.ticketPrice === undefined) {
                        dest.ticketPrice = defaultTicketPrices[index] || 20;
                    }
                });
                
                // Ajouter totalFuelConsumed aux statistiques
                if (gameState.statistics.totalFuelConsumed === undefined) {
                    gameState.statistics.totalFuelConsumed = 0;
                }
                
                // Ajouter les nouveaux navires aux anciennes sauvegardes
                if (!gameState.shopItems || gameState.shopItems.length < 8) {
                    gameState.shopItems = [
                        {
                            id: 1,
                            name: "Cargo Standard",
                            price: 2500,
                            type: "ship",
                            specs: { capacity: 100, speed: 1.2, fuelConsumption: 0.8 }
                        },
                        {
                            id: 2,
                            name: "Cargo Rapide",
                            price: 5000,
                            type: "ship",
                            specs: { capacity: 80, speed: 2, fuelConsumption: 1.5 }
                        },
                        {
                            id: 3,
                            name: "Porte-conteneurs",
                            price: 15000,
                            type: "ship",
                            specs: { capacity: 300, speed: 0.8, fuelConsumption: 2.5 }
                        },
                        {
                            id: 4,
                            name: "Yacht de Luxe",
                            price: 25000,
                            type: "ship",
                            specs: { capacity: 20, speed: 3, fuelConsumption: 3 }
                        },
                        {
                            id: 5,
                            name: "Paquebot Moderne",
                            price: 45000,
                            type: "ship",
                            specs: { capacity: 800, speed: 1.5, fuelConsumption: 4.2 }
                        },
                        {
                            id: 6,
                            name: "Navire de Croisi√®re",
                            price: 75000,
                            type: "ship",
                            specs: { capacity: 1500, speed: 1.8, fuelConsumption: 6.5 }
                        },
                        {
                            id: 7,
                            name: "M√©ga-Paquebot",
                            price: 120000,
                            type: "ship",
                            specs: { capacity: 2500, speed: 2.2, fuelConsumption: 9.8 }
                        },
                        {
                            id: 8,
                            name: "Titan des Mers",
                            price: 200000,
                            type: "ship",
                            specs: { capacity: 4000, speed: 2.5, fuelConsumption: 15.0 }
                        }
                    ];
                }
                
                // Calcul de la g√©n√©ration offline des passagers
                calculateOfflinePassengerGeneration(parsed.timestamp);
                
                updateDisplay();
                initializeAdminFields(); // Synchroniser les champs admin avec les valeurs du jeu
                showNotification('Jeu charg√© avec succ√®s!');
            } else {
                showNotification('Aucune sauvegarde trouv√©e');
                initializeAdminFields(); // Initialiser m√™me sans sauvegarde
            }
        }

        // Sauvegarde automatique toutes les 2 minutes
        setInterval(saveGame, 120000);

        // V√©rification des arriv√©es toutes les 10 secondes
        setInterval(() => {
            checkArrivals();
            updateDisplay();
        }, 10000);

        // Mise √† jour du syst√®me de pool global toutes les 15 secondes
        setInterval(() => {
            updatePassengerPool(); // Nouveau syst√®me de pool global
            updateDemand(); // Maintenir l'ancien syst√®me pour compatibilit√©
            updatePromotions();
            if (currentScreen === 'clients') {
                updatePoolDisplay(); // Nouveau syst√®me
            }
        }, 15000);

        // ===== FONCTIONS ESSENTIELLES =====
        
        // Fonction pour afficher les notifications
        function showNotification(message) {
            try {
                // Cr√©er l'√©l√©ment de notification s'il n'existe pas
                let notificationContainer = document.getElementById('notification-container');
                if (!notificationContainer) {
                    notificationContainer = document.createElement('div');
                    notificationContainer.id = 'notification-container';
                    notificationContainer.style.cssText = `
                        position: fixed;
                        top: 20px;
                        right: 20px;
                        z-index: 10000;
                        pointer-events: none;
                    `;
                    document.body.appendChild(notificationContainer);
                }
                
                // Cr√©er la notification
                const notification = document.createElement('div');
                notification.style.cssText = `
                    background: linear-gradient(135deg, rgba(0, 255, 255, 0.1), rgba(255, 0, 255, 0.1));
                    border: 1px solid #00ffff;
                    color: #00ffff;
                    padding: 12px 20px;
                    margin-bottom: 10px;
                    border-radius: 8px;
                    box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
                    backdrop-filter: blur(10px);
                    font-family: 'Orbitron', monospace;
                    font-size: 14px;
                    max-width: 300px;
                    word-wrap: break-word;
                    animation: slideIn 0.3s ease-out;
                `;
                notification.textContent = message;
                
                notificationContainer.appendChild(notification);
                
                // Supprimer apr√®s 3 secondes
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.remove();
                    }
                }, 3000);
                
            } catch (error) {
                // Fallback vers alert si erreur
                console.log('Notification:', message);
            }
        }
        
        // Fonction pour fermer les modales
        function closeModal() {
            try {
                const modals = document.querySelectorAll('.modal');
                modals.forEach(modal => {
                    modal.style.display = 'none';
                });
                
                // Fermer aussi les modales sp√©cifiques
                const travelModal = document.getElementById('travel-modal');
                if (travelModal) travelModal.style.display = 'none';
                
                const shipModal = document.getElementById('ship-modal');
                if (shipModal) shipModal.style.display = 'none';
                
                const adminModal = document.getElementById('admin-modal');
                if (adminModal) adminModal.style.display = 'none';
                
            } catch (error) {
                // Ignorer les erreurs silencieusement
            }
        }

        // ===== FONCTIONS UTILITAIRES =====
        
        // Fonction pour calculer la g√©n√©ration offline des passagers
        function calculateOfflinePassengerGeneration(lastTimestamp) {
            try {
                const now = Date.now();
                const timeDiff = Math.max(0, now - lastTimestamp);
                const hoursOffline = timeDiff / (1000 * 60 * 60);
                
                if (hoursOffline > 0.1) { // Si plus de 6 minutes offline
                    const baseRate = gameState.adminSettings?.passengerGenerationRate || 5;
                    const passengersGenerated = Math.floor(hoursOffline * baseRate);
                    
                    if (passengersGenerated > 0) {
                        initializePassengerPool();
                        gameState.passengerPool.totalPassengers += passengersGenerated;
                        showNotification(`+${passengersGenerated} passagers g√©n√©r√©s pendant votre absence !`);
                    }
                }
            } catch (error) {
                // Ignorer les erreurs silencieusement
            }
        }
        
        // Fonction pour mettre √† jour le pool de passagers
        function updatePassengerPool() {
            try {
                initializePassengerPool();
                const baseRate = gameState.adminSettings?.passengerGenerationRate || 5;
                const newPassengers = Math.floor(Math.random() * baseRate) + 1;
                gameState.passengerPool.totalPassengers += newPassengers;
                
                // Limiter le nombre maximum de passagers
                const maxPassengers = gameState.adminSettings?.maxPassengers || 1000;
                if (gameState.passengerPool.totalPassengers > maxPassengers) {
                    gameState.passengerPool.totalPassengers = maxPassengers;
                }
            } catch (error) {
                // Ignorer les erreurs silencieusement
            }
        }

        // ===== SYST√àME AUDIO SIMPLE =====
        
        // Fonction simple pour jouer des sons
        function playSound(type) {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                // Sons basiques
                switch(type) {
                    case 'success':
                    case 'purchase':
                    case 'arrival':
                        oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                        break;
                    case 'error':
                    case 'maintenance':
                        oscillator.frequency.setValueAtTime(300, audioContext.currentTime);
                        break;
                    case 'money':
                        oscillator.frequency.setValueAtTime(1000, audioContext.currentTime);
                        break;
                    case 'departure':
                    case 'fuel':
                        oscillator.frequency.setValueAtTime(400, audioContext.currentTime);
                        break;
                    default:
                        oscillator.frequency.setValueAtTime(600, audioContext.currentTime);
                }
                
                oscillator.type = 'sine';
                gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.2);
                
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.2);
                
            } catch (error) {
                // Ignorer les erreurs audio silencieusement
            }
        }
        
        // ===== SYST√àME AUDIO COMPLET =====
        
        // Configuration audio
        const audioConfig = {
            enabled: true,
            volume: 0.3,
            sounds: {}
        };

        // Fonction pour cr√©er un son synth√©tique
        function createSyntheticSound(frequency, duration, type = 'sine', volume = 0.3) {
            if (!audioConfig.enabled) return;
            
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);
                oscillator.type = type;
                
                gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                gainNode.gain.linearRampToValueAtTime(volume, audioContext.currentTime + 0.01);
                gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + duration);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + duration);
            } catch (error) {
                console.log('Audio non support√©:', error);
            }
        }

        // Fonction pour jouer des s√©quences de sons
        function playSequence(notes, interval = 100) {
            if (!audioConfig.enabled) return;
            
            notes.forEach((note, index) => {
                setTimeout(() => {
                    createSyntheticSound(note.freq, note.duration, note.type || 'sine', note.volume || 0.3);
                }, index * interval);
            });
        }

        // Sons pr√©d√©finis
        const soundLibrary = {
            // Sons d'interface
            click: () => createSyntheticSound(800, 0.1, 'square', 0.2),
            hover: () => createSyntheticSound(600, 0.05, 'sine', 0.1),
            success: () => playSequence([
                {freq: 523, duration: 0.2}, // Do
                {freq: 659, duration: 0.2}, // Mi
                {freq: 784, duration: 0.3}  // Sol
            ], 80),
            error: () => playSequence([
                {freq: 400, duration: 0.2, type: 'square'},
                {freq: 300, duration: 0.3, type: 'square'}
            ], 100),
            
            // Sons de jeu
            money: () => playSequence([
                {freq: 800, duration: 0.1, type: 'triangle'},
                {freq: 1000, duration: 0.1, type: 'triangle'},
                {freq: 1200, duration: 0.15, type: 'triangle'}
            ], 50),
            
            purchase: () => playSequence([
                {freq: 600, duration: 0.15},
                {freq: 800, duration: 0.15},
                {freq: 1000, duration: 0.2}
            ], 80),
            
            departure: () => playSequence([
                {freq: 300, duration: 0.3, type: 'sawtooth', volume: 0.2},
                {freq: 350, duration: 0.3, type: 'sawtooth', volume: 0.2},
                {freq: 400, duration: 0.4, type: 'sawtooth', volume: 0.2}
            ], 100),
            
            arrival: () => playSequence([
                {freq: 800, duration: 0.2, type: 'triangle'},
                {freq: 600, duration: 0.2, type: 'triangle'},
                {freq: 800, duration: 0.3, type: 'triangle'}
            ], 120),
            
            levelUp: () => playSequence([
                {freq: 523, duration: 0.2}, // Do
                {freq: 659, duration: 0.2}, // Mi
                {freq: 784, duration: 0.2}, // Sol
                {freq: 1047, duration: 0.4} // Do aigu
            ], 100),
            
            notification: () => createSyntheticSound(880, 0.3, 'sine', 0.25),
            
            maintenance: () => playSequence([
                {freq: 200, duration: 0.2, type: 'square'},
                {freq: 250, duration: 0.2, type: 'square'},
                {freq: 200, duration: 0.2, type: 'square'}
            ], 150),
            
            promotion: () => playSequence([
                {freq: 1000, duration: 0.15, type: 'triangle'},
                {freq: 1200, duration: 0.15, type: 'triangle'},
                {freq: 1400, duration: 0.15, type: 'triangle'},
                {freq: 1600, duration: 0.2, type: 'triangle'}
            ], 60),
            
            fuel: () => createSyntheticSound(150, 0.4, 'sawtooth', 0.2),
            
            warning: () => playSequence([
                {freq: 800, duration: 0.1, type: 'square'},
                {freq: 600, duration: 0.1, type: 'square'},
                {freq: 800, duration: 0.1, type: 'square'},
                {freq: 600, duration: 0.1, type: 'square'}
            ], 120)
        };

        // Fonction principale pour jouer un son
        function playSound(soundName, force = false) {
            if (!audioConfig.enabled && !force) return;
            
            if (soundLibrary[soundName]) {
                try {
                    soundLibrary[soundName]();
                } catch (error) {
                    console.log('Erreur audio:', error);
                }
            }
        }

        // Fonction pour activer/d√©sactiver les sons
        function toggleAudio() {
            audioConfig.enabled = !audioConfig.enabled;
            showNotification(audioConfig.enabled ? 'üîä Sons activ√©s' : 'üîá Sons d√©sactiv√©s');
            playSound('click', true); // Toujours jouer le son de confirmation
            saveGame(); // Sauvegarder la pr√©f√©rence
        }

        // Ajouter les sons aux √©v√©nements existants
        function addSoundToFunction(originalFunction, soundName, delay = 0) {
            return function(...args) {
                if (delay > 0) {
                    setTimeout(() => playSound(soundName), delay);
                } else {
                    playSound(soundName);
                }
                return originalFunction.apply(this, args);
            };
        }

        // Initialisation
        window.onload = function() {
            loadGame();
            initializePassengerPool(); // Nouveau syst√®me de pool global
            initializeClientSystem(); // Maintenir pour compatibilit√©
            
            // Charger les pr√©f√©rences audio
            const savedAudio = localStorage.getItem('maritimeEmpire_audio');
            if (savedAudio !== null) {
                audioConfig.enabled = JSON.parse(savedAudio);
            }
            
            // Ajouter un bouton pour activer/d√©sactiver les sons
            addAudioToggleButton();
            
            // Son de d√©marrage
            setTimeout(() => playSound('success'), 500);
        };

        // Fonction pour ajouter le bouton audio
        function addAudioToggleButton() {
            const header = document.querySelector('.header-stats');
            if (header) {
                const audioButton = document.createElement('div');
                audioButton.className = 'stat-item audio-toggle';
                audioButton.innerHTML = `
                    <span class="stat-label">Sons</span>
                    <span class="stat-value" id="audio-status">${audioConfig.enabled ? 'üîä' : 'üîá'}</span>
                `;
                audioButton.onclick = toggleAudio;
                audioButton.style.cursor = 'pointer';
                audioButton.style.userSelect = 'none';
                header.appendChild(audioButton);
            }
        }

        // Sauvegarder les pr√©f√©rences audio
        function saveAudioPreferences() {
            localStorage.setItem('maritimeEmpire_audio', JSON.stringify(audioConfig.enabled));
        }

        // Mettre √† jour l'affichage du bouton audio
        function updateAudioButton() {
            const audioStatus = document.getElementById('audio-status');
            if (audioStatus) {
                audioStatus.textContent = audioConfig.enabled ? 'üîä' : 'üîá';
            }
        }

        // Am√©liorer la fonction toggleAudio
        function toggleAudio() {
            audioConfig.enabled = !audioConfig.enabled;
            updateAudioButton();
            saveAudioPreferences();
            showNotification(audioConfig.enabled ? 'üîä Sons activ√©s' : 'üîá Sons d√©sactiv√©s');
            playSound('click', true); // Toujours jouer le son de confirmation
        }

        window.onclick = function(event) {
            const modal = document.getElementById('travel-modal');
            if (event.target === modal) {
                closeModal();
            }
        };
    </script>
</body>
</html>