<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Empire Maritime - Gestionnaire de Port</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            overflow-x: hidden;
            touch-action: manipulation;
        }

        .container {
            max-width: 100vw;
            min-height: 100vh;
            padding: 10px;
        }

        .header {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            color: #00d4ff;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .resources {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .resource {
            background: rgba(255, 255, 255, 0.1);
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
        }

        .fuel-resource {
            background: rgba(255, 193, 7, 0.2);
            border: 1px solid #ffc107;
        }

        .navigation {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .nav-btn {
            flex: 1;
            min-width: 80px;
            padding: 12px 8px;
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            border: none;
            border-radius: 25px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 12px;
        }

        .nav-btn:hover, .nav-btn:active {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
        }

        .nav-btn.active {
            background: linear-gradient(45deg, #00d4ff, #0984e3);
        }

        .screen {
            display: none;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            min-height: 60vh;
        }

        .screen.active {
            display: block;
            animation: fadeIn 0.5s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .ships-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .ship-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .ship-card:hover {
            border-color: #00d4ff;
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 212, 255, 0.2);
        }

        .ship-card.traveling {
            border-color: #fdcb6e;
            background: rgba(253, 203, 110, 0.2);
        }

        .ship-status {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .ship-name {
            font-size: 18px;
            font-weight: bold;
            color: #00d4ff;
        }

        .status-badge {
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
        }

        .status-available {
            background: #00b894;
            color: white;
        }

        .status-traveling {
            background: #fdcb6e;
            color: #2d3436;
        }

        .ship-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 15px 0;
        }

        .stat {
            text-align: center;
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
        }

        .stat-value {
            font-size: 20px;
            font-weight: bold;
            color: #00d4ff;
        }

        .stat-label {
            font-size: 12px;
            opacity: 0.8;
        }

        .destinations-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .destination-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .destination-card:hover {
            border-color: #00d4ff;
            transform: scale(1.02);
        }

        .destination-card.insufficient-fuel {
            border-color: #d63031;
            background: rgba(214, 48, 49, 0.2);
        }

        .destination-name {
            font-size: 16px;
            font-weight: bold;
            color: #00d4ff;
            margin-bottom: 8px;
        }

        .destination-info {
            font-size: 14px;
            opacity: 0.9;
        }

        .fuel-cost {
            background: rgba(255, 193, 7, 0.2);
            border-radius: 10px;
            padding: 5px 8px;
            margin: 5px 0;
            font-weight: bold;
            color: #ffc107;
        }

        .btn {
            padding: 12px 20px;
            background: linear-gradient(45deg, #00d4ff, #0984e3);
            border: none;
            border-radius: 25px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 10px;
        }

        .btn:hover, .btn:active {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0, 212, 255, 0.4);
        }

        .btn:disabled {
            background: #636e72;
            cursor: not-allowed;
            transform: none;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00d4ff, #0984e3);
            transition: width 0.3s ease;
            border-radius: 10px;
        }

        .ship-animation {
            position: relative;
            width: 100%;
            height: 40px;
            background: linear-gradient(to right, #0984e3, #74b9ff, #0984e3);
            border-radius: 20px;
            margin: 10px 0;
            overflow: hidden;
        }

        .sailing-ship {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            font-size: 24px;
            animation: sailing 3s ease-in-out infinite;
            z-index: 2;
        }

        .wave {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 200%;
            height: 20px;
            background: repeating-linear-gradient(
                90deg,
                rgba(255,255,255,0.1) 0px,
                rgba(255,255,255,0.2) 10px,
                rgba(255,255,255,0.1) 20px
            );
            animation: waves 2s linear infinite;
        }

        @keyframes sailing {
            0%, 100% { transform: translateY(-50%) rotate(-2deg); }
            50% { transform: translateY(-50%) rotate(2deg); }
        }

        @keyframes waves {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }

        .ship-trail {
            position: absolute;
            top: 50%;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(to right, transparent, rgba(255,255,255,0.3), transparent);
            transform: translateY(-50%);
            animation: trail 4s ease-in-out infinite;
        }

        @keyframes trail {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 0.8; }
        }

        .shop-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .shop-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
        }

        .shop-item h3 {
            color: #00d4ff;
            margin-bottom: 10px;
        }

        .price {
            font-size: 18px;
            font-weight: bold;
            color: #fdcb6e;
            margin: 10px 0;
        }

        .refinery-section {
            background: rgba(255, 193, 7, 0.1);
            border: 2px solid #ffc107;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .refinery-title {
            color: #ffc107;
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .fuel-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .maintenance-progress {
            margin: 10px 0;
            padding: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
        }

        .maintenance-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            overflow: hidden;
            margin: 5px 0;
        }

        .maintenance-fill {
            height: 100%;
            transition: all 0.3s ease;
            border-radius: 4px;
        }

        .maintenance-fill.good {
            background: linear-gradient(90deg, #00b894, #00cec9);
        }

        .maintenance-fill.warning {
            background: linear-gradient(90deg, #fdcb6e, #e17055);
        }

        .maintenance-fill.critical {
            background: linear-gradient(90deg, #d63031, #e84393);
        }

        .maintenance-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
            opacity: 0.9;
        }

        .fuel-option {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
        }

        .fuel-amount {
            font-size: 24px;
            font-weight: bold;
            color: #ffc107;
            margin: 10px 0;
        }

        .save-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .save-btn {
            flex: 1;
            padding: 10px;
            background: linear-gradient(45deg, #00b894, #00a085);
            border: none;
            border-radius: 20px;
            color: white;
            font-weight: bold;
            cursor: pointer;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #2d3436;
            padding: 30px;
            border-radius: 20px;
            max-width: 90vw;
            max-height: 90vh;
            overflow-y: auto;
        }

        .close {
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            color: #ddd;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #00b894;
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            z-index: 1001;
            display: none;
        }

        .admin-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            border: 2px solid #e17055;
        }

        .admin-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }

        .admin-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
        }

        .admin-input {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            border: none;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            font-size: 16px;
        }

        .admin-input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        .btn {
            background: linear-gradient(135deg, #00b894, #00cec9);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 184, 148, 0.3);
        }

        .btn.maintenance-preventive {
            background: linear-gradient(135deg, #fdcb6e, #e17055);
            box-shadow: 0 4px 15px rgba(253, 203, 110, 0.3);
        }

        .btn.maintenance-emergency {
            background: linear-gradient(135deg, #d63031, #e84393);
            box-shadow: 0 4px 15px rgba(214, 48, 49, 0.3);
        }

        .admin-btn {
            background: linear-gradient(45deg, #e17055, #d63031);
            border: none;
            border-radius: 10px;
            color: white;
            padding: 10px 15px;
            margin: 5px;
            cursor: pointer;
            font-weight: bold;
        }

        .admin-btn:hover {
            transform: scale(1.05);
        }

        .admin-warning {
            background: rgba(231, 112, 85, 0.2);
            border: 1px solid #e17055;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            color: #fdcb6e;
            font-weight: bold;
        }

        @media (max-width: 768px) {
            .container {
                padding: 5px;
            }

            .header {
                flex-direction: column;
                gap: 10px;
            }

            .resources {
                justify-content: center;
            }

            .nav-btn {
                font-size: 11px;
                padding: 10px 6px;
            }

            .ships-grid {
                grid-template-columns: 1fr;
            }

            .destinations-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">üö¢ Empire Maritime</div>
            <div class="resources">
                <div class="resource">üí∞ <span id="money">1000</span>‚Ç¨</div>
                <div class="resource fuel-resource">‚õΩ <span id="fuel">100</span>L</div>
                <div class="resource">‚öì <span id="reputation">0</span></div>
                <div class="resource">üèÜ <span id="level">1</span></div>
            </div>
        </div>

        <div class="save-buttons">
            <button class="save-btn" onclick="saveGame()">üíæ Sauvegarder</button>
            <button class="save-btn" onclick="loadGame()">üìÇ Charger</button>
            <button class="save-btn" onclick="resetGame()" style="background: linear-gradient(45deg, #e17055, #d63031);">üîÑ Reset</button>
        </div>

        <div class="navigation">
            <button class="nav-btn" onclick="showScreen('fleet')">üö¢ Flotte</button>
            <button class="nav-btn" onclick="showScreen('destinations')">üåç Destinations</button>
            <button class="nav-btn" onclick="showScreen('shop')">üõí Boutique</button>
            <button class="nav-btn" onclick="sellShip()">üí∞ Vendre Bateau</button>
            <button class="nav-btn" onclick="showScreen('stats')">üìä Statistiques</button>
            <button class="nav-btn admin-btn" onclick="showScreen('admin')">üîß Admin</button>
            <button class="nav-btn" onclick="showScreen('gasfactory')">üè≠ Usine √† Gasoil</button>
        </div>

        <div id="fleet-screen" class="screen active">
            <h2>üö¢ Votre Flotte</h2>
            <div id="ships-container" class="ships-grid"></div>
        </div>

        <div id="destinations-screen" class="screen">
            <h2>üó∫Ô∏è Destinations Disponibles</h2>
            <div id="selected-ship-info"></div>
            <div id="destinations-container" class="destinations-grid"></div>
        </div>

        <div id="shop-screen" class="screen">
            <h2>üõí Boutique Maritime</h2>
            
            <div class="refinery-section">
                <div class="refinery-title">
                    <span>‚õΩ</span> Raffinerie de Carburant
                </div>
                <p style="opacity: 0.9; margin-bottom: 15px;">Achetez du gasoil pour alimenter vos navires. Chaque destination n√©cessite du carburant pour le voyage.</p>
                
                <div class="fuel-controls">
                    <div class="fuel-option">
                        <h4>Petit Plein</h4>
                        <div class="fuel-amount">50L</div>
                        <div class="price">100‚Ç¨</div>
                        <button class="btn" onclick="buyFuel(50, 100)">Acheter</button>
                    </div>
                    <div class="fuel-option">
                        <h4>Plein Moyen</h4>
                        <div class="fuel-amount">150L</div>
                        <div class="price">280‚Ç¨</div>
                        <button class="btn" onclick="buyFuel(150, 280)">Acheter</button>
                    </div>
                    <div class="fuel-option">
                        <h4>Grand Plein</h4>
                        <div class="fuel-amount">500L</div>
                        <div class="price">900‚Ç¨</div>
                        <button class="btn" onclick="buyFuel(500, 900)">Acheter</button>
                    </div>
                    <div class="fuel-option">
                        <h4>Plein Maximum</h4>
                        <div class="fuel-amount">1000L</div>
                        <div class="price">1600‚Ç¨</div>
                        <button class="btn" onclick="buyFuel(1000, 1600)">Acheter</button>
                    </div>
                </div>
            </div>

            <h3 style="margin-top: 30px; margin-bottom: 20px;">üö¢ Navires</h3>
            <div id="shop-container" class="shop-grid"></div>
        </div>

        <div id="admin-screen" class="screen">
            <h2>‚öôÔ∏è Panneau d'Administration</h2>
            <div class="admin-warning">
                ‚ö†Ô∏è ATTENTION : Ces param√®tres modifient l'√©quilibre du jeu. Utilisez avec pr√©caution !
            </div>
            
            <div class="admin-buttons" style="margin-bottom: 20px; display: flex; gap: 10px;">
                <button class="nav-btn" onclick="showScreen('manage-ships')">üõ≥Ô∏è G√©rer Bateaux</button>
                <button class="nav-btn" onclick="showScreen('manage-destinations')">üåê G√©rer Destinations</button>
            </div>
            <div class="admin-grid">
                <div class="admin-card">
                    <h3>üí∞ √âconomie G√©n√©rale</h3>
                    <label>Argent de d√©part :</label>
                    <input type="number" id="startMoney" class="admin-input" placeholder="1000" value="1000">
                    
                    <label>Gasoil de d√©part :</label>
                    <input type="number" id="startFuel" class="admin-input" placeholder="100" value="100">
                    
                    <label>Multiplicateur gains :</label>
                    <input type="number" id="rewardMultiplier" class="admin-input" placeholder="1.0" value="1.0" step="0.1">
                    
                    <button class="admin-btn" onclick="applyEconomySettings()">Appliquer √âconomie</button>
                </div>

                <div class="admin-card">
                    <h3>üè≠ Usine √† Gasoil</h3>
                    <label>Intervalle production (secondes) :</label>
                    <input type="number" id="admin-gasfactory-interval" class="admin-input" placeholder="3600" value="3600">
                    <label>Litres/cycle :</label>
                    <input type="number" id="admin-gasfactory-prod" class="admin-input" placeholder="2" value="2">
                    <label>Prix am√©lioration (‚Ç¨) :</label>
                    <input type="number" id="admin-gasfactory-upgrade-price" class="admin-input" placeholder="500" value="500">
                    <button class="admin-btn" onclick="applyGasFactorySettings()">Appliquer Usine</button>
                </div>

                <div class="admin-card">
                    <h3>üîß Maintenance Navires</h3>
                    <label>Heures avant maintenance :</label>
                    <input type="number" id="maintenanceHours" class="admin-input" placeholder="50" value="50" step="1">
                    <label>Co√ªt maintenance (‚Ç¨) :</label>
                    <input type="number" id="maintenanceCost" class="admin-input" placeholder="200" value="200" step="10">
                    <label>P√©nalit√© urgence (‚Ç¨) :</label>
                    <input type="number" id="maintenancePenalty" class="admin-input" placeholder="50" value="50" step="10">
                    <button class="admin-btn" onclick="applyMaintenanceSettings()">Appliquer Maintenance</button>
                </div>

                <div class="admin-card">
                    <h3>üó∫Ô∏è Gains Destinations</h3>
                    <label>Port Local :</label>
                    <input type="number" id="dest1Reward" class="admin-input" placeholder="50" value="50">
                    
                    <label>Marseille :</label>
                    <input type="number" id="dest2Reward" class="admin-input" placeholder="150" value="150">
                    
                    <label>Londres :</label>
                    <input type="number" id="dest3Reward" class="admin-input" placeholder="400" value="400">
                    
                    <label>New York :</label>
                    <input type="number" id="dest4Reward" class="admin-input" placeholder="1200" value="1200">
                    
                    <label>Tokyo :</label>
                    <input type="number" id="dest5Reward" class="admin-input" placeholder="2500" value="2500">
                    
                    <label>Singapour :</label>
                    <input type="number" id="dest6Reward" class="admin-input" placeholder="1800" value="1800">
                    
                    <button class="admin-btn" onclick="applyDestinationRewards()">Appliquer Destinations</button>
                </div>
                <div class="admin-card">
                    <h3>‚õΩ Carburant par Destination</h3>
                    <label>Port Local :</label>
                    <input type="number" id="dest1Fuel" class="admin-input" placeholder="5" value="5">
                    <label>Marseille :</label>
                    <input type="number" id="dest2Fuel" class="admin-input" placeholder="15" value="15">
                    <label>Londres :</label>
                    <input type="number" id="dest3Fuel" class="admin-input" placeholder="40" value="40">
                    <label>New York :</label>
                    <input type="number" id="dest4Fuel" class="admin-input" placeholder="120" value="120">
                    <label>Tokyo :</label>
                    <input type="number" id="dest5Fuel" class="admin-input" placeholder="200" value="200">
                    <label>Singapour :</label>
                    <input type="number" id="dest6Fuel" class="admin-input" placeholder="150" value="150">
                    <button class="admin-btn" onclick="applyDestinationFuel()">Appliquer Carburant</button>
                </div>

                <div class="admin-card">
                    <h3>‚è±Ô∏è Temps de Livraison (heures)</h3>
                    <label>Port Local :</label>
                    <input type="number" id="dest1Time" class="admin-input" placeholder="0.0833" value="0.0833" step="0.1">
                    <label>Marseille :</label>
                    <input type="number" id="dest2Time" class="admin-input" placeholder="2" value="2" step="0.1">
                    <label>Londres :</label>
                    <input type="number" id="dest3Time" class="admin-input" placeholder="6" value="6" step="0.1">
                    <label>New York :</label>
                    <input type="number" id="dest4Time" class="admin-input" placeholder="24" value="24" step="0.1">
                    <label>Tokyo :</label>
                    <input type="number" id="dest5Time" class="admin-input" placeholder="48" value="48" step="0.1">
                    <label>Singapour :</label>
                    <input type="number" id="dest6Time" class="admin-input" placeholder="36" value="36" step="0.1">
                    <button class="admin-btn" onclick="applyDestinationTimes()">Appliquer Temps</button>
                </div>

                <div class="admin-card">
                    <h3>üö¢ Prix des Navires</h3>
                    <label>Cargo Standard :</label>
                    <input type="number" id="ship1Price" class="admin-input" placeholder="2500" value="2500">
                    
                    <label>Cargo Rapide :</label>
                    <input type="number" id="ship2Price" class="admin-input" placeholder="5000" value="5000">
                    
                    <label>Porte-conteneurs :</label>
                    <input type="number" id="ship3Price" class="admin-input" placeholder="15000" value="15000">
                    
                    <label>Yacht de Luxe :</label>
                    
                    <button class="admin-btn" onclick="applyFuelSettings()">Appliquer Carburant</button>
                </div>

                <div class="admin-card">
                    <h3>üéÆ Actions Rapides</h3>
                    <button class="admin-btn" onclick="addMoney()">+1000‚Ç¨</button>
                    <button class="admin-btn" onclick="addFuel()">+500L Gasoil</button>
                    <button class="admin-btn" onclick="maxReputation()">Max R√©putation</button>
                    <button class="admin-btn" onclick="resetToDefaults()">R√©initialiser Param√®tres</button>
                    <button class="admin-btn" onclick="exportSettings()">Exporter Config</button>
                    <button class="admin-btn" onclick="importSettings()">Importer Config</button>
                </div>
            </div>
        </div>

        <div id="stats-screen" class="screen">
            <h2>üìä Statistiques de l'Empire</h2>
            <div id="stats-container"></div>
        </div>

        <!-- √âcran de gestion des bateaux -->
        <div id="manage-ships-screen" class="screen">
            <h2>üõ≥Ô∏è Gestion des Bateaux</h2>
            <button class="nav-btn" onclick="addNewShip()">‚ûï Ajouter un Bateau</button>
            <div id="ships-management-container" class="ships-grid"></div>
        </div>

        <!-- √âcran d'ajout/√©dition de bateau -->
        <div id="edit-ship-screen" class="screen">
            <h2>‚úèÔ∏è Modifier Bateau</h2>
            <div class="admin-card">
                <input type="hidden" id="edit-ship-id">
                <label>Nom :</label>
                <input type="text" id="edit-ship-name" class="admin-input">
                <label>Type :</label>
                <input type="text" id="edit-ship-type" class="admin-input" placeholder="ex: cargo, paquebot, etc.">
                <label>Capacit√© :</label>
                <input type="number" id="edit-ship-capacity" class="admin-input">
                <label>Vitesse :</label>
                <input type="number" step="0.1" id="edit-ship-speed" class="admin-input">
                <label>Consommation carburant :</label>
                <input type="number" step="0.1" id="edit-ship-fuel" class="admin-input">
                <div style="display: flex; gap: 10px; margin-top: 15px;">
                    <button class="nav-btn" onclick="saveShip()">üíæ Enregistrer</button>
                    <button class="nav-btn" onclick="showScreen('manage-ships')">‚ùå Annuler</button>
                </div>
            </div>
        </div>

        <!-- √âcran de gestion des destinations -->
        <div id="manage-destinations-screen" class="screen">
            <h2>üåê Gestion des Destinations</h2>
            <button class="nav-btn" onclick="addNewDestination()">‚ûï Ajouter une Destination</button>
            <div id="destinations-management-container" class="destinations-grid"></div>
        </div>

        <!-- √âcran d'ajout/√©dition de destination -->
        <div id="edit-destination-screen" class="screen">
            <h2>‚úèÔ∏è Modifier Destination</h2>
            <div class="admin-card">
                <input type="hidden" id="edit-destination-id">
                <label>Nom :</label>
                <input type="text" id="edit-destination-name" class="admin-input">
                <label>Distance :</label>
                <input type="number" step="0.1" id="edit-destination-distance" class="admin-input">
                <label>R√©compense :</label>
                <input type="number" id="edit-destination-reward" class="admin-input">
                <label>R√©putation :</label>
                <input type="number" id="edit-destination-reputation" class="admin-input">
                <label>Co√ªt carburant :</label>
                <input type="number" id="edit-destination-fuel" class="admin-input">
                <label>Description :</label>
                <textarea id="edit-destination-description" class="admin-input" style="height: 100px;"></textarea>
                <div style="display: flex; gap: 10px; margin-top: 15px;">
                    <button class="nav-btn" onclick="saveDestination()">üíæ Enregistrer</button>
                    <button class="nav-btn" onclick="showScreen('manage-destinations')">‚ùå Annuler</button>
                </div>
            </div>
        </div>

        <div id="gasfactory-screen" class="screen">
            <h2>üè≠ Usine √† Gasoil</h2>
            <div id="gasfactory-container" style="margin-top: 25px;">
                <div style="font-size: 18px; margin-bottom: 10px;">Niveau : <span id="gasfactory-level"></span></div>
                <div style="font-size: 16px;">Production/cycle : <span id="gasfactory-prod"></span> L</div>
                <div style="font-size: 16px;">Intervalle : <span id="gasfactory-interval"></span></div>
                <div style="font-size: 16px;">Stock actuel : <span id="gasfactory-stock"></span> L</div>
                <div style="font-size: 16px; margin-top:10px;">Prix am√©lioration : <span id="gasfactory-upgrade-price"></span> ‚Ç¨</div>
                <button id="gasfactory-upgrade-btn" class="btn" style="margin-top: 18px;" onclick="upgradeGasFactory()">üîº Am√©liorer l'usine</button>
            </div>
        </div>
    </div>

    <div id="travel-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2>üö¢ Envoyer en Mission</h2>
            <div id="travel-details"></div>
            <button class="btn" onclick="startTravel()">üöÄ Commencer le Voyage</button>
        </div>
    </div>

    <div id="notification" class="notification"></div>

    <script>
        // √âtat du jeu
        let gameState = {
            money: 1000,
            fuel: 100,
            reputation: 0,
            level: 1,
            ships: [
                {
                    id: 1,
                    name: "Petit Cargo",
                    type: "cargo",
                    capacity: 50,
                    speed: 1,
                    fuelConsumption: 1,
                    status: "available",
                    destination: null,
                    arrivalTime: null,
                    earnings: 0
                }
            ],
            destinations: [
                {
                    id: 1,
                    name: "Port Local",
                    distance: 0.0833,
                    reward: 50,
                    reputation: 2,
                    fuelCost: 5,
                    description: "Livraison express locale"
                },
                {
                    id: 2,
                    name: "Marseille",
                    distance: 2,
                    reward: 150,
                    reputation: 5,
                    fuelCost: 15,
                    description: "Port m√©diterran√©en anim√©"
                },
                {
                    id: 3,
                    name: "Londres",
                    distance: 6,
                    reward: 400,
                    reputation: 15,
                    fuelCost: 40,
                    description: "Grand port commercial"
                },
                {
                    id: 4,
                    name: "New York",
                    distance: 24,
                    reward: 1200,
                    reputation: 40,
                    fuelCost: 120,
                    description: "M√©tropole am√©ricaine"
                },
                {
                    id: 5,
                    name: "Tokyo",
                    distance: 48,
                    reward: 2500,
                    reputation: 80,
                    fuelCost: 200,
                    description: "Capital du Pacifique"
                },
                {
                    id: 6,
                    name: "Singapour",
                    distance: 36,
                    reward: 1800,
                    reputation: 60,
                    fuelCost: 150,
                    description: "Hub asiatique"
                }
            ],
            shopItems: [
                {
                    id: 1,
                    name: "Cargo Standard",
                    price: 2500,
                    type: "ship",
                    specs: { capacity: 100, speed: 1.2, fuelConsumption: 0.8 }
                },
                {
                    id: 2,
                    name: "Cargo Rapide",
                    price: 5000,
                    type: "ship",
                    specs: { capacity: 80, speed: 2, fuelConsumption: 1.5 }
                },
                {
                    id: 3,
                    name: "Porte-conteneurs",
                    price: 15000,
                    type: "ship",
                    specs: { capacity: 300, speed: 0.8, fuelConsumption: 2.5 }
                },
                {
                    id: 4,
                    name: "Yacht de Luxe",
                    price: 25000,
                    type: "ship",
                    specs: { capacity: 20, speed: 3, fuelConsumption: 3 }
                }
            ],
            statistics: {
                totalEarnings: 0,
                totalTrips: 0,
                totalDistance: 0,
                totalFuelConsumed: 0
            },
            adminSettings: {
                rewardMultiplier: 1.0,
                startMoney: 1000,
                startFuel: 100,
                fuelPricePerLiter: 2
            }
        };

        let selectedShip = null;
        let currentScreen = 'fleet';

        // Ajout structure usine √† gasoil si absente
        function ensureGasFactory() {
            if (!gameState.gasFactory) {
                gameState.gasFactory = {};
            }
            if (typeof gameState.gasFactory.level !== 'number') gameState.gasFactory.level = 1;
            if (typeof gameState.gasFactory.productionPerCycle !== 'number') gameState.gasFactory.productionPerCycle = 2;
            if (typeof gameState.gasFactory.productionInterval !== 'number') gameState.gasFactory.productionInterval = 3600000;
            if (typeof gameState.gasFactory.nextUpgradePrice !== 'number') gameState.gasFactory.nextUpgradePrice = 500;
        }

        // Affichage usine √† gasoil
        function updateGasFactoryDisplay() {
            ensureGasFactory();
            if (!document.getElementById('gasfactory-level')) return;
            document.getElementById('gasfactory-level').textContent = gameState.gasFactory.level;
            document.getElementById('gasfactory-prod').textContent = gameState.gasFactory.productionPerCycle;
            document.getElementById('gasfactory-interval').textContent = msToHuman(gameState.gasFactory.productionInterval);
            document.getElementById('gasfactory-stock').textContent = gameState.fuel;
            document.getElementById('gasfactory-upgrade-price').textContent = gameState.gasFactory.nextUpgradePrice;
            document.getElementById('gasfactory-upgrade-btn').disabled = gameState.money < gameState.gasFactory.nextUpgradePrice;
        }
        window.updateGasFactoryDisplay = updateGasFactoryDisplay;

        // Am√©lioration usine √† gasoil
        function upgradeGasFactory() {
            ensureGasFactory();
            if (gameState.money >= gameState.gasFactory.nextUpgradePrice) {
                gameState.money -= gameState.gasFactory.nextUpgradePrice;
                gameState.gasFactory.level += 1;
                gameState.gasFactory.productionPerCycle += 1;
                gameState.gasFactory.nextUpgradePrice = Math.floor(gameState.gasFactory.nextUpgradePrice * 1.6);
                updateDisplay();
                saveGame();
                showNotification('Usine am√©lior√©e ! Production accrue.');
            } else {
                showNotification('Pas assez d\'argent pour am√©liorer l\'usine !');
            }
        }
        window.upgradeGasFactory = upgradeGasFactory;

        // Production automatique usine √† gasoil
        let gasFactoryIntervalId = null;
        function startGasFactoryInterval() {
            if (gasFactoryIntervalId) clearInterval(gasFactoryIntervalId);
            ensureGasFactory();
            gasFactoryIntervalId = setInterval(() => {
                ensureGasFactory();
                gameState.fuel += gameState.gasFactory.productionPerCycle;
                gameState.gasFactory.lastProductionTime = Date.now();
                updateDisplay();
                saveGame();
                showNotification('Production de gasoil : +' + gameState.gasFactory.productionPerCycle + 'L');
            }, gameState.gasFactory.productionInterval);
        }
        window.startGasFactoryInterval = startGasFactoryInterval;

        // Appliquer les param√®tres usine √† gasoil depuis l'admin
        function updateGasFactoryAdminFields() {
            ensureGasFactory();
            var intervalInput = document.getElementById('admin-gasfactory-interval');
            var prodInput = document.getElementById('admin-gasfactory-prod');
            var priceInput = document.getElementById('admin-gasfactory-upgrade-price');
            if (intervalInput) intervalInput.value = Math.floor(gameState.gasFactory.productionInterval / 1000);
            if (prodInput) prodInput.value = gameState.gasFactory.productionPerCycle;
            if (priceInput) priceInput.value = gameState.gasFactory.nextUpgradePrice;
        }
        window.updateGasFactoryAdminFields = updateGasFactoryAdminFields;

        function applyGasFactorySettings() {
            const intervalSec = parseInt(document.getElementById('admin-gasfactory-interval').value) || 3600;
            const interval = intervalSec * 1000;
            const prod = parseInt(document.getElementById('admin-gasfactory-prod').value) || 2;
            const price = parseInt(document.getElementById('admin-gasfactory-upgrade-price').value) || 500;
            ensureGasFactory();
            gameState.gasFactory.productionInterval = interval;
            gameState.gasFactory.productionPerCycle = prod;
            gameState.gasFactory.nextUpgradePrice = price;
            showNotification('Param√®tres usine appliqu√©s !');
            saveGame();
            updateDisplay();
            startGasFactoryInterval();
            updateGasFactoryAdminFields();
        }
        window.applyGasFactorySettings = applyGasFactorySettings;

        // Conversion ms -> texte humain
        function msToHuman(ms) {
            if (!ms) return '';
            let min = Math.floor(ms/60000)%60;
            let h = Math.floor(ms/3600000);
            return (h>0?h+'h ':'') + (min>0?min+'min':'');
        }
        window.msToHuman = msToHuman;

        // Sauvegarde/chargement usine √† gasoil
        const origSaveGame = saveGame;
        saveGame = function() {
            ensureGasFactory();
            origSaveGame();
        }
        window.saveGame = saveGame;

        const origLoadGame = loadGame;
        loadGame = function() {
            origLoadGame();
            ensureGasFactory();
            // Production offline usine √† gasoil bas√©e sur le timestamp global
            const now = Date.now();
            const last = gameState.timestamp || now;
            const elapsed = now - last;
            const cycles = Math.floor(elapsed / gameState.gasFactory.productionInterval);
            if (cycles > 0) {
                gameState.fuel += cycles * gameState.gasFactory.productionPerCycle;
            }
            updateGasFactoryDisplay();
            startGasFactoryInterval();
        }
        window.loadGame = loadGame;

        updateGasFactoryDisplay();

        // Fonctions d'affichage
        function updateDisplay() {
            document.getElementById('money').textContent = gameState.money;
            document.getElementById('fuel').textContent = gameState.fuel;
            document.getElementById('reputation').textContent = gameState.reputation;
            document.getElementById('level').textContent = gameState.level;
            
            updateShipsDisplay();
            updateDestinationsDisplay();
            updateShopDisplay();
            updateStatsDisplay();
            updateGasFactoryDisplay();
        }

        function getMaintenanceProgressBar(ship) {
            const maintenanceHours = gameState.adminSettings?.maintenanceHours || 50;
            const hoursNavigated = ship.hoursNavigated || 0;
            const percentage = Math.min(100, (hoursNavigated / maintenanceHours) * 100);
            
            let fillClass = 'good';
            let statusText = 'Bon √©tat';
            
            if (percentage >= 85) {
                fillClass = 'critical';
                statusText = 'Critique';
            } else if (percentage >= 60) {
                fillClass = 'warning';
                statusText = 'Attention';
            }
            
            return `
                <div class="maintenance-progress">
                    <div class="maintenance-info">
                        <span>üîß Maintenance: ${Math.round(percentage)}%</span>
                        <span>${statusText}</span>
                    </div>
                    <div class="maintenance-bar">
                        <div class="maintenance-fill ${fillClass}" style="width: ${percentage}%"></div>
                    </div>
                    <div class="maintenance-info">
                        <span>${Math.round(hoursNavigated)}h / ${maintenanceHours}h</span>
                    </div>
                </div>
            `;
        }

        function updateShipsDisplay() {
            const container = document.getElementById('ships-container');
            container.innerHTML = '';

            gameState.ships.forEach(ship => {
                const shipCard = document.createElement('div');
                shipCard.className = `ship-card ${ship.status === 'traveling' ? 'traveling' : ''}`;
                
                let statusBadge = '';
                if (ship.status === 'available') {
                    statusBadge = '<span class="status-badge status-available">Disponible</span>';
                } else if (ship.status === 'traveling') {
                    statusBadge = '<span class="status-badge status-traveling">En voyage</span>';
                } else if (ship.status === 'maintenance_required') {
                    statusBadge = '<span class="status-badge" style="background: #d63031;">Maintenance requise</span>';
                }

                let progressBar = '';
                let actionButton = '';

                if (ship.status === 'traveling') {
                    const totalTime = ship.travelTime * 60 * 60 * 1000;
                    const elapsed = Date.now() - ship.departureTime;
                    const progress = Math.min(100, (elapsed / totalTime) * 100);
                    const remainingMs = Math.max(0, totalTime - elapsed);
                    const remainingHours = Math.floor(remainingMs / (60 * 60 * 1000));
                    const remainingMinutes = Math.floor((remainingMs % (60 * 60 * 1000)) / (60 * 1000));
                    
                    let timeDisplay = '';
                    if (remainingHours > 0) {
                        timeDisplay = `${remainingHours}h ${remainingMinutes}min`;
                    } else {
                        timeDisplay = `${remainingMinutes}min`;
                    }
                    
                    progressBar = `
                        <div class="ship-animation">
                            <div class="wave"></div>
                            <div class="ship-trail"></div>
                            <div class="sailing-ship" style="left: ${progress}%">üö¢</div>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${progress}%"></div>
                        </div>
                        <div>Arriv√©e dans: ${timeDisplay} vers ${ship.destination.name}</div>
                    `;
                } else if (ship.status === 'maintenance_required') {
                    const baseCost = gameState.adminSettings?.maintenanceCost || 200;
                    const penalty = gameState.adminSettings?.maintenancePenalty || 50;
                    const totalCost = baseCost + penalty;
                    actionButton = `<button class="btn maintenance-emergency" onclick="performMaintenance(${ship.id})">‚ö†Ô∏è Maintenance d'urgence (${totalCost}‚Ç¨)</button>`;
                } else {
                    const maintenanceHours = gameState.adminSettings?.maintenanceHours || 50;
                    const hoursNavigated = ship.hoursNavigated || 0;
                    const percentage = (hoursNavigated / maintenanceHours) * 100;
                    const baseCost = gameState.adminSettings?.maintenanceCost || 200;
                    
                    let buttons = `<button class="btn" onclick="selectShipForTravel(${ship.id})">üöÄ Envoyer en Mission</button>`;
                    
                    // Ajouter bouton maintenance pr√©ventive si >= 50%
                    if (percentage >= 50) {
                        buttons = `
                            <button class="btn maintenance-preventive" onclick="performMaintenance(${ship.id}, true)">üîß Maintenance (${baseCost}‚Ç¨)</button>
                            <button class="btn" onclick="selectShipForTravel(${ship.id})">üöÄ Mission</button>
                        `;
                    }
                    
                    actionButton = buttons;
                }

                shipCard.innerHTML = `
                    <div class="ship-status">
                        <div class="ship-name">${ship.name}</div>
                        ${statusBadge}
                    </div>
                    <div class="ship-stats">
                        <div class="stat">
                            <div class="stat-value">${ship.capacity}</div>
                            <div class="stat-label">Capacit√©</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value">${ship.speed}x</div>
                            <div class="stat-label">Vitesse</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value">${ship.fuelConsumption}x</div>
                            <div class="stat-label">Consommation</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value">${Math.round(ship.hoursNavigated || 0)}h</div>
                            <div class="stat-label">Navigation</div>
                        </div>
                    </div>
                    ${getMaintenanceProgressBar(ship)}
                    ${progressBar}
                    ${actionButton}
                `;

                container.appendChild(shipCard);
            });
        }

        function updateDestinationsDisplay() {
            const container = document.getElementById('destinations-container');
            container.innerHTML = '';

            gameState.destinations.forEach(destination => {
                const destCard = document.createElement('div');
                let fuelCost = destination.fuelCost;
                
                if (selectedShip) {
                    fuelCost = Math.ceil(destination.fuelCost * selectedShip.fuelConsumption);
                }
                
                const hasEnoughFuel = gameState.fuel >= fuelCost;
                destCard.className = `destination-card ${!hasEnoughFuel ? 'insufficient-fuel' : ''}`;
                destCard.onclick = () => selectDestination(destination);

                destCard.innerHTML = `
                    <div class="destination-name">${destination.name}</div>
                    <div class="destination-info">
                        <div>üïí ${destination.name === "Port Local" ? "5 min" : (destination.distance < 1 ? Math.round(destination.distance * 60) + 'min' : destination.distance + 'h')} de voyage</div>
                        <div>üí∞ ${destination.reward}‚Ç¨ de r√©compense</div>
                        <div>‚öì +${destination.reputation} r√©putation</div>
                        <div class="fuel-cost">‚õΩ ${fuelCost}L de carburant</div>
                        ${!hasEnoughFuel ? '<div style="color: #d63031; font-weight: bold;">‚ùå Carburant insuffisant</div>' : ''}
                        <div style="margin-top: 8px; opacity: 0.8;">${destination.description}</div>
                    </div>
                `;

                container.appendChild(destCard);
            });
        }

        function updateShopDisplay() {
            const container = document.getElementById('shop-container');
            container.innerHTML = '';

            gameState.shopItems.forEach(item => {
                const shopItem = document.createElement('div');
                shopItem.className = 'shop-item';

                const canAfford = gameState.money >= item.price;
                const buttonClass = canAfford ? 'btn' : 'btn';
                const buttonText = canAfford ? 'Acheter' : 'Pas assez d\'argent';

                shopItem.innerHTML = `
                    <h3>${item.name}</h3>
                    <div>Capacit√©: ${item.specs.capacity}</div>
                    <div>Vitesse: ${item.specs.speed}x</div>
                    <div>Consommation: ${item.specs.fuelConsumption}x</div>
                    <div class="price">${item.price}‚Ç¨</div>
                    <button class="${buttonClass}" onclick="buyItem(${item.id})" ${!canAfford ? 'disabled' : ''}>
                        ${buttonText}
                    </button>
                `;

                container.appendChild(shopItem);
            });
        }

        function updateStatsDisplay() {
            const container = document.getElementById('stats-container');
            container.innerHTML = `
                <div class="ship-stats">
                    <div class="stat">
                        <div class="stat-value">${gameState.statistics.totalEarnings}</div>
                        <div class="stat-label">Gains totaux (‚Ç¨)</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value">${gameState.statistics.totalTrips}</div>
                        <div class="stat-label">Voyages effectu√©s</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value">${gameState.statistics.totalDistance}</div>
                        <div class="stat-label">Distance parcourue (h)</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value">${gameState.statistics.totalFuelConsumed}</div>
                        <div class="stat-label">Carburant consomm√© (L)</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value">${gameState.ships.length}</div>
                        <div class="stat-label">Navires poss√©d√©s</div>
                    </div>
                </div>
            `;
        }



        // Fonctions de navigation
        function showScreen(screenName) {
            // Masquer tous les √©crans
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            
            // Afficher l'√©cran s√©lectionn√©
            const screenElement = document.getElementById(screenName + '-screen');
            if (screenElement) {
                screenElement.classList.add('active');
            }
            
            // Mettre √† jour l'affichage si n√©cessaire
            if (screenName === 'fleet') {
                updateShipsDisplay();
            } else if (screenName === 'destinations') {
                updateDestinationsDisplay();
            } else if (screenName === 'shop') {
                updateShopDisplay();
            } else if (screenName === 'stats') {
                updateStatsDisplay();
            } else if (screenName === 'admin') {
                initializeAdminFields();
            } else if (screenName === 'manage-ships') {
                updateShipsManagementDisplay();
            } else if (screenName === 'manage-destinations') {
                updateDestinationsManagementDisplay();
            }
        }

        // Fonctions audio
        function playSound(type) {
            const context = new (window.AudioContext || window.webkitAudioContext)();
            
            if (type === 'departure') {
                const oscillator = context.createOscillator();
                const gainNode = context.createGain();
                
                oscillator.frequency.setValueAtTime(150, context.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(100, context.currentTime + 1);
                
                gainNode.gain.setValueAtTime(0, context.currentTime);
                gainNode.gain.linearRampToValueAtTime(0.3, context.currentTime + 0.1);
                gainNode.gain.exponentialRampToValueAtTime(0.01, context.currentTime + 1);
                
                oscillator.connect(gainNode);
                gainNode.connect(context.destination);
                
                oscillator.start(context.currentTime);
                oscillator.stop(context.currentTime + 1);
                
            } else if (type === 'arrival') {
                const oscillator = context.createOscillator();
                const gainNode = context.createGain();
                
                oscillator.frequency.setValueAtTime(800, context.currentTime);
                oscillator.frequency.setValueAtTime(600, context.currentTime + 0.1);
                oscillator.frequency.setValueAtTime(800, context.currentTime + 0.2);
                
                gainNode.gain.setValueAtTime(0, context.currentTime);
                gainNode.gain.linearRampToValueAtTime(0.4, context.currentTime + 0.05);
                gainNode.gain.exponentialRampToValueAtTime(0.01, context.currentTime + 0.5);
                
                oscillator.connect(gainNode);
                gainNode.connect(context.destination);
                
                oscillator.start(context.currentTime);
                oscillator.stop(context.currentTime + 0.5);
                
            } else if (type === 'money') {
                for (let i = 0; i < 3; i++) {
                    setTimeout(() => {
                        const oscillator = context.createOscillator();
                        const gainNode = context.createGain();
                        
                        oscillator.frequency.setValueAtTime(1000 + Math.random() * 500, context.currentTime);
                        oscillator.frequency.exponentialRampToValueAtTime(600 + Math.random() * 200, context.currentTime + 0.1);
                        
                        gainNode.gain.setValueAtTime(0, context.currentTime);
                        gainNode.gain.linearRampToValueAtTime(0.2, context.currentTime + 0.01);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, context.currentTime + 0.15);
                        
                        oscillator.connect(gainNode);
                        gainNode.connect(context.destination);
                        
                        oscillator.start(context.currentTime);
                        oscillator.stop(context.currentTime + 0.15);
                    }, i * 50);
                }
            } else if (type === 'fuel') {
                const oscillator = context.createOscillator();
                const gainNode = context.createGain();
                
                oscillator.frequency.setValueAtTime(300, context.currentTime);
                oscillator.frequency.linearRampToValueAtTime(250, context.currentTime + 0.5);
                
                gainNode.gain.setValueAtTime(0, context.currentTime);
                gainNode.gain.linearRampToValueAtTime(0.3, context.currentTime + 0.1);
                gainNode.gain.exponentialRampToValueAtTime(0.01, context.currentTime + 0.8);
                
                oscillator.connect(gainNode);
                gainNode.connect(context.destination);
                
                oscillator.start(context.currentTime);
                oscillator.stop(context.currentTime + 0.8);
            }
        }

        // Fonctions Carburant
        function buyFuel(amount, cost) {
            if (gameState.money >= cost) {
                gameState.money -= cost;
                gameState.fuel += amount;
                playSound('fuel');
                showNotification(`+${amount}L de carburant achet√© pour ${cost}‚Ç¨!`);
                updateDisplay();
            } else {
                showNotification('Pas assez d\'argent pour acheter ce carburant!');
            }
        }

        // Fonctions Admin
        function applyEconomySettings() {
            const startMoney = parseInt(document.getElementById('startMoney').value) || 1000;
            const startFuel = parseInt(document.getElementById('startFuel').value) || 100;
            const rewardMultiplier = parseFloat(document.getElementById('rewardMultiplier').value) || 1.0;
            
            gameState.adminSettings.startMoney = startMoney;
            gameState.adminSettings.startFuel = startFuel;
            gameState.adminSettings.rewardMultiplier = rewardMultiplier;
            
            showNotification('Param√®tres √©conomiques appliqu√©s !');
        }

        function applyShipPrices() {
            const prices = [
                parseInt(document.getElementById('ship1Price').value) || 2500,
                parseInt(document.getElementById('ship2Price').value) || 5000,
                parseInt(document.getElementById('ship3Price').value) || 15000,
                parseInt(document.getElementById('ship4Price').value) || 25000
            ];
            
            gameState.shopItems.forEach((item, index) => {
                if (index < prices.length) {
                    item.price = prices[index];
                }
            });
            
            showNotification('Prix des navires modifi√©s !');
            updateDisplay();
        }

        function applyDestinationRewards() {
            const rewards = [
                parseInt(document.getElementById('dest1Reward').value) || 50,
                parseInt(document.getElementById('dest2Reward').value) || 150,
                parseInt(document.getElementById('dest3Reward').value) || 400,
                parseInt(document.getElementById('dest4Reward').value) || 1200,
                parseInt(document.getElementById('dest5Reward').value) || 2500,
                parseInt(document.getElementById('dest6Reward').value) || 1800
            ];
            
            gameState.destinations.forEach((dest, index) => {
                if (index < rewards.length) {
                    dest.reward = rewards[index];
                }
            });
            
            showNotification('Gains des destinations modifi√©s !');
            updateDisplay();
        }

        function applyDestinationFuel() {
            const fuels = [
                parseInt(document.getElementById('dest1Fuel').value) || 5,
                parseInt(document.getElementById('dest2Fuel').value) || 15,
                parseInt(document.getElementById('dest3Fuel').value) || 40,
                parseInt(document.getElementById('dest4Fuel').value) || 120,
                parseInt(document.getElementById('dest5Fuel').value) || 200,
                parseInt(document.getElementById('dest6Fuel').value) || 150
            ];
            gameState.destinations.forEach((dest, i) => {
                if (i < fuels.length) {
                    dest.fuelCost = fuels[i];
                }
            });
            showNotification('Carburant requis par destination modifi√© !');
            updateDisplay();
        }

        function applyDestinationTimes() {
            const times = [
                parseFloat(document.getElementById('dest1Time').value) || 0.0833,
                parseFloat(document.getElementById('dest2Time').value) || 2,
                parseFloat(document.getElementById('dest3Time').value) || 6,
                parseFloat(document.getElementById('dest4Time').value) || 24,
                parseFloat(document.getElementById('dest5Time').value) || 48,
                parseFloat(document.getElementById('dest6Time').value) || 36
            ];
            
            gameState.destinations.forEach((dest, i) => {
                if (i < times.length) {
                    dest.distance = times[i];
                }
            });
            
            showNotification('Temps de livraison modifi√©s !');
            updateDisplay();
        }

        function applyMaintenanceSettings() {
            const maintenanceHours = parseInt(document.getElementById('maintenanceHours').value) || 50;
            const maintenanceCost = parseInt(document.getElementById('maintenanceCost').value) || 200;
            const maintenancePenalty = parseInt(document.getElementById('maintenancePenalty').value) || 50;
            
            if (!gameState.adminSettings) {
                gameState.adminSettings = {};
            }
            
            gameState.adminSettings.maintenanceHours = maintenanceHours;
            gameState.adminSettings.maintenanceCost = maintenanceCost;
            gameState.adminSettings.maintenancePenalty = maintenancePenalty;
            
            showNotification('Param√®tres de maintenance appliqu√©s !');
            updateDisplay();
        }

        function applyFuelSettings() {
            const fuelPrice = parseFloat(document.getElementById('fuelPrice').value) || 2;
            gameState.adminSettings.fuelPricePerLiter = fuelPrice;
            showNotification('Prix du carburant modifi√© !');
        }

        function addMoney() {
            gameState.money += 1000;
            showNotification('+1000‚Ç¨ ajout√© !');
            updateDisplay();
        }

        function addFuel() {
            gameState.fuel += 500;
            showNotification('+500L de carburant ajout√© !');
            updateDisplay();
        }

        function maxReputation() {
            gameState.reputation += 1000;
            gameState.level = Math.floor(gameState.reputation / 100) + 1;
            showNotification('R√©putation maximis√©e !');
            updateDisplay();
        }

        function initializeAdminFields() {
            // Initialiser les champs avec les valeurs actuelles du jeu
            if (gameState.destinations && gameState.destinations.length >= 6) {
                // Temps de livraison
                if(document.getElementById('dest1Time')) document.getElementById('dest1Time').value = gameState.destinations[0].distance || 0.0833;
                if(document.getElementById('dest2Time')) document.getElementById('dest2Time').value = gameState.destinations[1].distance || 2;
                if(document.getElementById('dest3Time')) document.getElementById('dest3Time').value = gameState.destinations[2].distance || 6;
                if(document.getElementById('dest4Time')) document.getElementById('dest4Time').value = gameState.destinations[3].distance || 24;
                if(document.getElementById('dest5Time')) document.getElementById('dest5Time').value = gameState.destinations[4].distance || 48;
                if(document.getElementById('dest6Time')) document.getElementById('dest6Time').value = gameState.destinations[5].distance || 36;
                
                // Carburant par destination
                if(document.getElementById('dest1Fuel')) document.getElementById('dest1Fuel').value = gameState.destinations[0].fuelCost || 5;
                if(document.getElementById('dest2Fuel')) document.getElementById('dest2Fuel').value = gameState.destinations[1].fuelCost || 15;
                if(document.getElementById('dest3Fuel')) document.getElementById('dest3Fuel').value = gameState.destinations[2].fuelCost || 40;
                if(document.getElementById('dest4Fuel')) document.getElementById('dest4Fuel').value = gameState.destinations[3].fuelCost || 120;
                if(document.getElementById('dest5Fuel')) document.getElementById('dest5Fuel').value = gameState.destinations[4].fuelCost || 200;
                if(document.getElementById('dest6Fuel')) document.getElementById('dest6Fuel').value = gameState.destinations[5].fuelCost || 150;
                
                // R√©compenses par destination
                if(document.getElementById('dest1Reward')) document.getElementById('dest1Reward').value = gameState.destinations[0].reward || 50;
                if(document.getElementById('dest2Reward')) document.getElementById('dest2Reward').value = gameState.destinations[1].reward || 150;
                if(document.getElementById('dest3Reward')) document.getElementById('dest3Reward').value = gameState.destinations[2].reward || 400;
                if(document.getElementById('dest4Reward')) document.getElementById('dest4Reward').value = gameState.destinations[3].reward || 1200;
                if(document.getElementById('dest5Reward')) document.getElementById('dest5Reward').value = gameState.destinations[4].reward || 2500;
                if(document.getElementById('dest6Reward')) document.getElementById('dest6Reward').value = gameState.destinations[5].reward || 1800;
            }
            
            // Param√®tres de maintenance
            if (gameState.adminSettings) {
                if(document.getElementById('maintenanceHours')) document.getElementById('maintenanceHours').value = gameState.adminSettings.maintenanceHours || 50;
                if(document.getElementById('maintenanceCost')) document.getElementById('maintenanceCost').value = gameState.adminSettings.maintenanceCost || 200;
                if(document.getElementById('maintenancePenalty')) document.getElementById('maintenancePenalty').value = gameState.adminSettings.maintenancePenalty || 50;
            }
        }

        function resetToDefaults() {
            document.getElementById('startMoney').value = 1000;
            document.getElementById('startFuel').value = 100;
            document.getElementById('rewardMultiplier').value = 1.0;
            document.getElementById('fuelPrice').value = 2;
            
            document.getElementById('ship1Price').value = 2500;
            document.getElementById('ship2Price').value = 5000;
            document.getElementById('ship3Price').value = 15000;
            document.getElementById('ship4Price').value = 25000;
            
            document.getElementById('dest1Reward').value = 50;
            document.getElementById('dest2Reward').value = 150;
            document.getElementById('dest3Reward').value = 400;
            document.getElementById('dest4Reward').value = 1200;
            document.getElementById('dest5Reward').value = 2500;
            document.getElementById('dest6Reward').value = 1800;
            
            // Reset carburant par destination (si les champs existent)
            if(document.getElementById('dest1Fuel')) document.getElementById('dest1Fuel').value = 5;
            if(document.getElementById('dest2Fuel')) document.getElementById('dest2Fuel').value = 15;
            if(document.getElementById('dest3Fuel')) document.getElementById('dest3Fuel').value = 40;
            if(document.getElementById('dest4Fuel')) document.getElementById('dest4Fuel').value = 120;
            if(document.getElementById('dest5Fuel')) document.getElementById('dest5Fuel').value = 200;
            if(document.getElementById('dest6Fuel')) document.getElementById('dest6Fuel').value = 150;
            
            // Reset temps de livraison par destination (si les champs existent)
            if(document.getElementById('dest1Time')) document.getElementById('dest1Time').value = 0.0833;
            if(document.getElementById('dest2Time')) document.getElementById('dest2Time').value = 2;
            if(document.getElementById('dest3Time')) document.getElementById('dest3Time').value = 6;
            if(document.getElementById('dest4Time')) document.getElementById('dest4Time').value = 24;
            if(document.getElementById('dest5Time')) document.getElementById('dest5Time').value = 48;
            if(document.getElementById('dest6Time')) document.getElementById('dest6Time').value = 36;
            
            // Reset param√®tres de maintenance (si les champs existent)
            if(document.getElementById('maintenanceHours')) document.getElementById('maintenanceHours').value = 50;
            if(document.getElementById('maintenanceCost')) document.getElementById('maintenanceCost').value = 200;
            if(document.getElementById('maintenancePenalty')) document.getElementById('maintenancePenalty').value = 50;
            
            showNotification('Param√®tres r√©initialis√©s aux valeurs par d√©faut !');
        }

        function exportSettings() {
            const settings = {
                adminSettings: gameState.adminSettings,
                shipPrices: gameState.shopItems.map(item => item.price),
                destinationRewards: gameState.destinations.map(dest => dest.reward),
                destinationFuelCosts: gameState.destinations.map(dest => dest.fuelCost)
            };
            
            const dataStr = JSON.stringify(settings, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'maritime_empire_config.json';
            link.click();
            
            showNotification('Configuration export√©e !');
        }

        function importSettings() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const settings = JSON.parse(e.target.result);
                            
                            if (settings.adminSettings) {
                                gameState.adminSettings = settings.adminSettings;
                            }
                            if (settings.shipPrices) {
                                settings.shipPrices.forEach((price, index) => {
                                    if (gameState.shopItems[index]) {
                                        gameState.shopItems[index].price = price;
                                    }
                                });
                            }
                            if (settings.destinationRewards) {
                                settings.destinationRewards.forEach((reward, index) => {
                                    if (gameState.destinations[index]) {
                                        gameState.destinations[index].reward = reward;
                                    }
                                });
                            }
                            if (settings.destinationFuelCosts) {
                                settings.destinationFuelCosts.forEach((fuel, index) => {
                                    if (gameState.destinations[index]) {
                                        gameState.destinations[index].fuelCost = fuel;
                                    }
                                });
                            }
                            
                            showNotification('Configuration import√©e avec succ√®s !');
                            updateDisplay();
                        } catch (error) {
                            showNotification('Erreur lors de l\'importation !');
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }

        function resetGame() {
            if (confirm('√ätes-vous s√ªr de vouloir recommencer le jeu ? Toutes vos donn√©es seront perdues !')) {
                Object.keys(localStorage).forEach(key => {
                    if (key.startsWith('maritimeEmpire')) {
                        localStorage.removeItem(key);
                    }
                });
                
                gameState = {
                    money: gameState.adminSettings?.startMoney || 1000,
                    fuel: gameState.adminSettings?.startFuel || 100,
                    reputation: 0,
                    level: 1,
                    ships: [
                        {
                            id: 1,
                            name: "Petit Cargo",
                            type: "cargo",
                            capacity: 50,
                            speed: 1,
                            fuelConsumption: 1,
                            status: "available",
                            destination: null,
                            arrivalTime: null,
                            earnings: 0,
                            hoursNavigated: 0,
                            needsMaintenance: false
                        }
                    ],
                    destinations: [
                        {
                            id: 1,
                            name: "Port Local",
                            distance: 0.0833,
                            reward: 50,
                            reputation: 2,
                            fuelCost: 5,
                            description: "Livraison express locale"
                        },
                        {
                            id: 2,
                            name: "Marseille",
                            distance: 2,
                            reward: 150,
                            reputation: 5,
                            fuelCost: 15,
                            description: "Port m√©diterran√©en anim√©"
                        },
                        {
                            id: 3,
                            name: "Londres",
                            distance: 6,
                            reward: 400,
                            reputation: 15,
                            fuelCost: 40,
                            description: "Grand port commercial"
                        },
                        {
                            id: 4,
                            name: "New York",
                            distance: 24,
                            reward: 1200,
                            reputation: 40,
                            fuelCost: 120,
                            description: "M√©tropole am√©ricaine"
                        },
                        {
                            id: 5,
                            name: "Tokyo",
                            distance: 48,
                            reward: 2500,
                            reputation: 80,
                            fuelCost: 200,
                            description: "Capital du Pacifique"
                        },
                        {
                            id: 6,
                            name: "Singapour",
                            distance: 36,
                            reward: 1800,
                            reputation: 60,
                            fuelCost: 150,
                            description: "Hub asiatique"
                        }
                    ],
                    shopItems: [
                        {
                            id: 1,
                            name: "Cargo Standard",
                            price: 2500,
                            type: "ship",
                            specs: { capacity: 100, speed: 1.2, fuelConsumption: 0.8 }
                        },
                        {
                            id: 2,
                            name: "Cargo Rapide",
                            price: 5000,
                            type: "ship",
                            specs: { capacity: 80, speed: 2, fuelConsumption: 1.5 }
                        },
                        {
                            id: 3,
                            name: "Porte-conteneurs",
                            price: 15000,
                            type: "ship",
                            specs: { capacity: 300, speed: 0.8, fuelConsumption: 2.5 }
                        },
                        {
                            id: 4,
                            name: "Yacht de Luxe",
                            price: 25000,
                            type: "ship",
                            specs: { capacity: 20, speed: 3, fuelConsumption: 3 }
                        }
                    ],
                    statistics: {
                        totalEarnings: 0,
                        totalTrips: 0,
                        totalDistance: 0,
                        totalFuelConsumed: 0
                    },
                    adminSettings: gameState.adminSettings || {
                        rewardMultiplier: 1.0,
                        startMoney: 1000,
                        startFuel: 100,
                        fuelPricePerLiter: 2,
                        maintenanceHours: 50,
                        maintenanceCost: 200
                    }
                };
                
                selectedShip = null;
                updateDisplay();
                showNotification('Jeu r√©initialis√© avec succ√®s ! Bon voyage capitaine ! üö¢');
            }
        }

        // Fonctions de jeu
        function selectShipForTravel(shipId) {
            selectedShip = gameState.ships.find(ship => ship.id === shipId);
            showScreen('destinations');
            
            const info = document.getElementById('selected-ship-info');
            info.innerHTML = `
                <div style="background: rgba(0,212,255,0.1); padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                    <h3>üö¢ ${selectedShip.name} s√©lectionn√©</h3>
                    <p>Capacit√©: ${selectedShip.capacity} | Vitesse: ${selectedShip.speed}x | Consommation: ${selectedShip.fuelConsumption}x</p>
                </div>
            `;
        }

        function selectDestination(destination) {
            if (!selectedShip) {
                showNotification('Veuillez d\'abord s√©lectionner un navire');
                return;
            }

            const fuelRequired = Math.ceil(destination.fuelCost * selectedShip.fuelConsumption);
            
            if (gameState.fuel < fuelRequired) {
                showNotification(`Carburant insuffisant ! Il vous faut ${fuelRequired}L pour ce voyage.`);
                return;
            }

            const modal = document.getElementById('travel-modal');
            const details = document.getElementById('travel-details');
            
            let travelTime = destination.distance / selectedShip.speed;
            if (destination.name === "Port Local") {
                travelTime = 5 / 60;
            }
            
            const baseEarnings = Math.floor(destination.reward * (selectedShip.capacity / 100));
            const earnings = Math.floor(baseEarnings * (gameState.adminSettings?.rewardMultiplier || 1.0));

            const timeDisplay = destination.name === "Port Local" ? 
                "5 minutes" :
                (travelTime < 1 ? 
                    Math.round(travelTime * 60) + ' minutes' : 
                    Math.round(travelTime) + ' heure(s)');

            details.innerHTML = `
                <h3>üö¢ ${selectedShip.name} ‚Üí ${destination.name}</h3>
                <div style="margin: 20px 0;">
                    <div><strong>Temps de voyage:</strong> ${timeDisplay}</div>
                    <div><strong>Gains estim√©s:</strong> ${earnings}‚Ç¨</div>
                    <div><strong>R√©putation:</strong> +${destination.reputation}</div>
                    <div><strong>Carburant requis:</strong> ${fuelRequired}L</div>
                    <div style="margin-top: 10px; opacity: 0.8;">${destination.description}</div>
                </div>
            `;

            modal.style.display = 'block';
            modal.selectedDestination = destination;
        }

        function startTravel() {
            const destination = document.getElementById('travel-modal').selectedDestination;
            const fuelRequired = Math.ceil(destination.fuelCost * selectedShip.fuelConsumption);
            
            let travelTime = destination.distance / selectedShip.speed;
            
            if (destination.name === "Port Local") {
                travelTime = 5 / 60;
            }
            
            // D√©duire le carburant
            gameState.fuel -= fuelRequired;
            gameState.statistics.totalFuelConsumed += fuelRequired;
            
            selectedShip.status = 'traveling';
            selectedShip.destination = destination;
            selectedShip.departureTime = Date.now();
            selectedShip.travelTime = travelTime;
            
            const baseEarnings = Math.floor(destination.reward * (selectedShip.capacity / 100));
            selectedShip.earnings = Math.floor(baseEarnings * (gameState.adminSettings?.rewardMultiplier || 1.0));

            playSound('departure');

            closeModal();
            showNotification(`${selectedShip.name} part vers ${destination.name}! (-${fuelRequired}L carburant)`);
            selectedShip = null;
            
            updateDisplay();
            showScreen('fleet');
        }

        function buyItem(itemId) {
            const item = gameState.shopItems.find(i => i.id === itemId);
            if (gameState.money >= item.price) {
                gameState.money -= item.price;
                
                const newShip = {
                    id: gameState.ships.length + 1,
                    name: item.name,
                    type: item.type,
                    capacity: item.specs.capacity,
                    speed: item.specs.speed,
                    fuelConsumption: item.specs.fuelConsumption,
                    status: 'available',
                    destination: null,
                    arrivalTime: null,
                    earnings: 0
                };
                
                gameState.ships.push(newShip);
                showNotification(`${item.name} achet√© avec succ√®s!`);
                updateDisplay();
            }
        }

        function performMaintenance(shipId, isPreventive = false) {
            const ship = gameState.ships.find(s => s.id === shipId);
            if (!ship) return;
            
            const maintenanceHours = gameState.adminSettings?.maintenanceHours || 50;
            const baseCost = gameState.adminSettings?.maintenanceCost || 200;
            const penalty = gameState.adminSettings?.maintenancePenalty || 50;
            
            // Calculer le co√ªt selon le type de maintenance
            let totalCost = baseCost;
            let message = '';
            
            if (ship.needsMaintenance || ship.hoursNavigated >= maintenanceHours) {
                // Maintenance obligatoire (100%) - avec p√©nalit√©
                totalCost = baseCost + penalty;
                message = `‚ö†Ô∏è Maintenance d'urgence de ${ship.name} ! -${totalCost}‚Ç¨ (p√©nalit√© incluse)`;
            } else {
                // Maintenance pr√©ventive (50-99%) - co√ªt normal
                message = `üîß Maintenance pr√©ventive de ${ship.name} ! -${totalCost}‚Ç¨`;
            }
            
            if (gameState.money >= totalCost) {
                gameState.money -= totalCost;
                ship.hoursNavigated = 0;
                ship.needsMaintenance = false;
                ship.status = "available";
                
                showNotification(message);
                updateDisplay();
            } else {
                showNotification(`‚ö†Ô∏è Pas assez d'argent pour la maintenance ! (${totalCost}‚Ç¨ n√©cessaires)`);
            }
        }

        function checkArrivals() {
            const now = Date.now();
            gameState.ships.forEach(ship => {
                if (ship.status === 'traveling') {
                    let hasArrived = false;
                    let destination = null;
                    
                    // Nouveau syst√®me avec arrivalTime
                    if (ship.arrivalTime && now >= ship.arrivalTime) {
                        hasArrived = true;
                        destination = gameState.destinations.find(d => d.id === ship.destination);
                    }
                    // Ancien syst√®me avec departureTime et travelTime (compatibilit√©)
                    else if (ship.departureTime && ship.travelTime) {
                        const travelTime = ship.travelTime * 60 * 60 * 1000;
                        const elapsed = now - ship.departureTime;
                        if (elapsed >= travelTime) {
                            hasArrived = true;
                            destination = ship.destination; // Dans l'ancien syst√®me, destination √©tait l'objet complet
                        }
                    }
                    
                    if (hasArrived && destination) {
                        ship.status = 'available';
                        
                        // Calculer la r√©compense
                        let reward = 0;
                        let travelHours = 0;
                        
                        if (typeof destination === 'object' && destination.reward) {
                            // Ancien format - destination est l'objet complet
                            reward = Math.floor(destination.reward * (gameState.adminSettings?.rewardMultiplier || 1));
                            travelHours = destination.distance / (ship.speed || 1);
                            gameState.reputation += destination.reputation;
                        } else {
                            // Nouveau format - destination est l'ID
                            const destObj = gameState.destinations.find(d => d.id === destination);
                            if (destObj) {
                                reward = Math.floor(destObj.reward * (gameState.adminSettings?.rewardMultiplier || 1));
                                travelHours = destObj.distance / (ship.speed || 1);
                                gameState.reputation += destObj.reputation;
                                destination = destObj; // Pour les notifications
                            }
                        }
                        
                        gameState.money += reward;
                        gameState.level = Math.floor(gameState.reputation / 100) + 1;
                        ship.earnings = (ship.earnings || 0) + reward;
                        
                        // Ajouter les heures de navigation
                        ship.hoursNavigated = (ship.hoursNavigated || 0) + travelHours;
                        
                        // V√©rifier si maintenance n√©cessaire
                        const maintenanceHours = gameState.adminSettings?.maintenanceHours || 50;
                        if (ship.hoursNavigated >= maintenanceHours) {
                            ship.needsMaintenance = true;
                            ship.status = "maintenance_required";
                            showNotification(`‚ö†Ô∏è ${ship.name} n√©cessite une maintenance !`);
                        }
                        
                        // Ajouter aux statistiques
                        if (!gameState.statistics) gameState.statistics = { totalTrips: 0, totalEarnings: 0, totalDistance: 0, totalFuelConsumed: 0 };
                        gameState.statistics.totalTrips = (gameState.statistics.totalTrips || 0) + 1;
                        gameState.statistics.totalEarnings = (gameState.statistics.totalEarnings || 0) + reward;
                        gameState.statistics.totalDistance = (gameState.statistics.totalDistance || 0) + travelHours;
                        
                        // Ajouter la consommation de carburant
                        let fuelConsumed = 0;
                        if (typeof destination === 'object' && destination.fuelCost) {
                            fuelConsumed = Math.ceil(destination.fuelCost * (ship.fuelConsumption || 1));
                        } else {
                            const destObj = gameState.destinations.find(d => d.id === destination || (typeof destination === 'object' && d.id === destination.id));
                            if (destObj) {
                                fuelConsumed = Math.ceil(destObj.fuelCost * (ship.fuelConsumption || 1));
                            }
                        }
                        gameState.statistics.totalFuelConsumed = (gameState.statistics.totalFuelConsumed || 0) + fuelConsumed;
                        
                        // Notifications et sons
                        if (ship.status === "available") {
                            showNotification(`${ship.name} est arriv√© √† ${destination.name} ! +${reward}‚Ç¨`);
                            playSound('arrival');
                            setTimeout(() => playSound('money'), 500);
                        }
                        
                        // Nettoyer les propri√©t√©s de voyage
                        ship.destination = null;
                        ship.arrivalTime = null;
                        ship.departureTime = null;
                        ship.travelTime = null;
                    }
                }
            });
        }

        // Fonction pour vendre un bateau
        function sellShip() {
            const availableShips = gameState.ships.filter(ship => ship.status === 'available' && ship.id !== 1); // Ne pas vendre le premier bateau
            
            if (availableShips.length === 0) {
                showNotification("Aucun bateau disponible √† la vente !");
                return;
            }
            
            let message = "S√©lectionnez un bateau √† vendre :\n\n";
            availableShips.forEach((ship, index) => {
                const shipValue = Math.floor(calculateShipValue(ship) * 0.7); // 70% de la valeur
                message += `${index + 1}. ${ship.name} - Valeur: ${shipValue}‚Ç¨\n`;
                message += `   Type: ${ship.type}, Cap: ${ship.capacity}, Vitesse: ${ship.speed}, Carburant: ${ship.fuelConsumption}/h\n\n`;
            });
            
            const choice = prompt(message + "\nEntrez le num√©ro du bateau √† vendre (ou Annuler) :");
            if (choice === null) return;
            
            const index = parseInt(choice) - 1;
            if (isNaN(index) || index < 0 || index >= availableShips.length) {
                showNotification("Num√©ro invalide !");
                return;
            }
            
            const shipToSell = availableShips[index];
            const sellPrice = Math.floor(calculateShipValue(shipToSell) * 0.7);
            
            if (confirm(`Vendre le ${shipToShip.name} pour ${sellPrice}‚Ç¨ ?`)) {
                gameState.ships = gameState.ships.filter(ship => ship.id !== shipToSell.id);
                gameState.money += sellPrice;
                showNotification(`Vente effectu√©e ! +${sellPrice}‚Ç¨`);
                updateDisplay();
            }
        }
        
        // Calculer la valeur d'un bateau
        function calculateShipValue(ship) {
            return (ship.capacity * 20) + (ship.speed * 1000) - (ship.fuelConsumption * 50);
        }
        
        // Fonctions de gestion des bateaux
        function updateShipsManagementDisplay() {
            const container = document.getElementById('ships-management-container');
            if (!container) return;
            
            container.innerHTML = '';
            
            gameState.shopItems.forEach((ship, index) => {
                const shipCard = document.createElement('div');
                shipCard.className = 'ship-card';
                shipCard.innerHTML = `
                    <h3>${ship.name}</h3>
                    <p>Prix: ${ship.price}‚Ç¨</p>
                    <p>Capacit√©: ${ship.specs.capacity}</p>
                    <p>Vitesse: ${ship.specs.speed}</p>
                    <p>Carburant: ${ship.specs.fuelConsumption}/h</p>
                    <div style="display: flex; gap: 5px; margin-top: 10px;">
                        <button class="nav-btn" onclick="editShip(${index})">‚úèÔ∏è Modifier</button>
                        <button class="nav-btn" style="background: #ff6b6b;" onclick="deleteShip(${index})">üóëÔ∏è Supprimer</button>
                    </div>
                `;
                container.appendChild(shipCard);
            });
        }
        
        function addNewShip() {
            document.getElementById('edit-ship-id').value = '';
            document.getElementById('edit-ship-name').value = '';
            document.getElementById('edit-ship-type').value = 'cargo';
            document.getElementById('edit-ship-capacity').value = '100';
            document.getElementById('edit-ship-speed').value = '1.0';
            document.getElementById('edit-ship-fuel').value = '1.0';
            showScreen('edit-ship');
        }
        
        function editShip(index) {
            const ship = gameState.shopItems[index];
            document.getElementById('edit-ship-id').value = index;
            document.getElementById('edit-ship-name').value = ship.name;
            document.getElementById('edit-ship-type').value = ship.type || 'cargo';
            document.getElementById('edit-ship-capacity').value = ship.specs.capacity;
            document.getElementById('edit-ship-speed').value = ship.specs.speed;
            document.getElementById('edit-ship-fuel').value = ship.specs.fuelConsumption;
            showScreen('edit-ship');
        }
        
        function saveShip() {
            const id = document.getElementById('edit-ship-id').value;
            const name = document.getElementById('edit-ship-name').value.trim();
            const type = document.getElementById('edit-ship-type').value.trim();
            const capacity = parseInt(document.getElementById('edit-ship-capacity').value);
            const speed = parseFloat(document.getElementById('edit-ship-speed').value);
            const fuel = parseFloat(document.getElementById('edit-ship-fuel').value);
            
            if (!name || isNaN(capacity) || isNaN(speed) || isNaN(fuel) || capacity <= 0 || speed <= 0 || fuel <= 0) {
                showNotification("Veuillez remplir tous les champs avec des valeurs valides !");
                return;
            }
            
            const newShip = {
                id: gameState.shopItems.length + 1,
                name: name,
                type: type,
                price: Math.floor((capacity * 20) + (speed * 1000) - (fuel * 50)),
                specs: {
                    capacity: capacity,
                    speed: speed,
                    fuelConsumption: fuel
                }
            };
            
            if (id === '') {
                // Nouveau bateau
                gameState.shopItems.push(newShip);
                showNotification("Nouveau bateau ajout√© avec succ√®s !");
            } else {
                // Mise √† jour d'un bateau existant
                const index = parseInt(id);
                newShip.id = gameState.shopItems[index].id; // Garder le m√™me ID
                gameState.shopItems[index] = newShip;
                showNotification("Bateau mis √† jour avec succ√®s !");
            }
            
            showScreen('manage-ships');
            updateShopDisplay();
        }
        
        function deleteShip(index) {
            if (confirm(`√ätes-vous s√ªr de vouloir supprimer le bateau "${gameState.shopItems[index].name}" ?`)) {
                gameState.shopItems.splice(index, 1);
                updateShipsManagementDisplay();
                updateShopDisplay();
                showNotification("Bateau supprim√© avec succ√®s !");
            }
        }
        
        // Fonctions de gestion des destinations
        function updateDestinationsManagementDisplay() {
            const container = document.getElementById('destinations-management-container');
            if (!container) return;
            
            container.innerHTML = '';
            
            gameState.destinations.forEach((dest, index) => {
                const destCard = document.createElement('div');
                destCard.className = 'destination-card';
                destCard.innerHTML = `
                    <h3>${dest.name}</h3>
                    <p>Distance: ${dest.distance} h</p>
                    <p>R√©compense: ${dest.reward}‚Ç¨</p>
                    <p>R√©putation: +${dest.reputation}</p>
                    <p>Carburant: ${dest.fuelCost}L</p>
                    <p>${dest.description}</p>
                    <div style="display: flex; gap: 5px; margin-top: 10px;">
                        <button class="nav-btn" onclick="editDestination(${index})">‚úèÔ∏è Modifier</button>
                        <button class="nav-btn" style="background: #ff6b6b;" onclick="deleteDestination(${index})" ${index === 0 ? 'disabled' : ''}>üóëÔ∏è Supprimer</button>
                    </div>
                `;
                container.appendChild(destCard);
            });
        }
        
        function addNewDestination() {
            document.getElementById('edit-destination-id').value = '';
            document.getElementById('edit-destination-name').value = '';
            document.getElementById('edit-destination-distance').value = '1.0';
            document.getElementById('edit-destination-reward').value = '100';
            document.getElementById('edit-destination-reputation').value = '5';
            document.getElementById('edit-destination-fuel').value = '10';
            document.getElementById('edit-destination-description').value = '';
            showScreen('edit-destination');
        }
        
        function editDestination(index) {
            const dest = gameState.destinations[index];
            document.getElementById('edit-destination-id').value = index;
            document.getElementById('edit-destination-name').value = dest.name;
            document.getElementById('edit-destination-distance').value = dest.distance;
            document.getElementById('edit-destination-reward').value = dest.reward;
            document.getElementById('edit-destination-reputation').value = dest.reputation;
            document.getElementById('edit-destination-fuel').value = dest.fuelCost;
            document.getElementById('edit-destination-description').value = dest.description || '';
            showScreen('edit-destination');
        }
        
        function saveDestination() {
            const id = document.getElementById('edit-destination-id').value;
            const name = document.getElementById('edit-destination-name').value.trim();
            const distance = parseFloat(document.getElementById('edit-destination-distance').value);
            const reward = parseInt(document.getElementById('edit-destination-reward').value);
            const reputation = parseInt(document.getElementById('edit-destination-reputation').value);
            const fuel = parseInt(document.getElementById('edit-destination-fuel').value);
            const description = document.getElementById('edit-destination-description').value.trim();
            
            if (!name || isNaN(distance) || isNaN(reward) || isNaN(reputation) || isNaN(fuel) || distance <= 0 || reward <= 0 || fuel <= 0) {
                showNotification("Veuillez remplir tous les champs avec des valeurs valides !");
                return;
            }
            
            const newDest = {
                id: gameState.destinations.length + 1,
                name: name,
                distance: distance,
                reward: reward,
                reputation: reputation,
                fuelCost: fuel,
                description: description
            };
            
            if (id === '') {
                // Nouvelle destination
                gameState.destinations.push(newDest);
                showNotification("Nouvelle destination ajout√©e avec succ√®s !");
            } else {
                // Mise √† jour d'une destination existante
                const index = parseInt(id);
                newDest.id = gameState.destinations[index].id; // Garder le m√™me ID
                gameState.destinations[index] = newDest;
                showNotification("Destination mise √† jour avec succ√®s !");
            }
            
            showScreen('manage-destinations');
            updateDestinationsDisplay();
        }
        
        function deleteDestination(index) {
            if (index === 0) {
                showNotification("Impossible de supprimer le port local !");
                return;
            }
            
            // V√©rifier si des navires sont en route vers cette destination
            const shipsToThisDestination = gameState.ships.some(ship => 
                ship.destination && ship.destination.id === gameState.destinations[index].id
            );
            
            if (shipsToThisDestination) {
                showNotification("Impossible de supprimer cette destination car des navires y sont en route !");
                return;
            }
            
            if (confirm(`√ätes-vous s√ªr de vouloir supprimer la destination "${gameState.destinations[index].name}" ?`)) {
                gameState.destinations.splice(index, 1);
                updateDestinationsManagementDisplay();
                updateDestinationsDisplay();
                showNotification("Destination supprim√©e avec succ√®s !");
            }
        }
        
        // Fonctions utilitaires
        function closeModal() {
            document.getElementById('travel-modal').style.display = 'none';
        }

        function showNotification(message) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.style.display = 'block';
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }

        function saveGame() {
            const saveData = {
                ...gameState,
                timestamp: Date.now()
            };
            
            localStorage.setItem('maritimeEmpire_auto', JSON.stringify(saveData));
            const saveKey = `maritimeEmpire_${Date.now()}`;
            localStorage.setItem(saveKey, JSON.stringify(saveData));
            
            showNotification('Jeu sauvegard√© avec succ√®s!');
        }

        function loadGame() {
            const saveData = localStorage.getItem('maritimeEmpire_auto');
            if (saveData) {
                const parsed = JSON.parse(saveData);
                gameState = parsed;
                
                // Assurer la compatibilit√© avec les nouvelles fonctionnalit√©s
                if (!gameState.adminSettings) {
                    gameState.adminSettings = {
                        rewardMultiplier: 1.0,
                        startMoney: 1000,
                        startFuel: 100,
                        fuelPricePerLiter: 2,
                        maintenanceHours: 50,
                        maintenanceCost: 200
                    };
                }
                
                // Ajouter fuel si manquant
                if (gameState.fuel === undefined) {
                    gameState.fuel = 100;
                }
                
                // Ajouter fuelConsumption aux navires existants
                gameState.ships.forEach(ship => {
                    if (ship.fuelConsumption === undefined) {
                        ship.fuelConsumption = 1;
                    }
                    // Ajouter les propri√©t√©s de maintenance aux navires existants
                    if (ship.hoursNavigated === undefined) {
                        ship.hoursNavigated = 0;
                    }
                    if (ship.needsMaintenance === undefined) {
                        ship.needsMaintenance = false;
                    }
                });
                
                // Ajouter fuelCost aux destinations existantes
                const defaultFuelCosts = [5, 15, 40, 120, 200, 150];
                gameState.destinations.forEach((dest, index) => {
                    if (dest.fuelCost === undefined) {
                        dest.fuelCost = defaultFuelCosts[index] || 50;
                    }
                });
                
                // Ajouter totalFuelConsumed aux statistiques
                if (gameState.statistics.totalFuelConsumed === undefined) {
                    gameState.statistics.totalFuelConsumed = 0;
                }
                
                updateDisplay();
                initializeAdminFields(); // Synchroniser les champs admin avec les valeurs du jeu
                showNotification('Jeu charg√© avec succ√®s!');
            } else {
                showNotification('Aucune sauvegarde trouv√©e');
                initializeAdminFields(); // Initialiser m√™me sans sauvegarde
            }
        }

        // Sauvegarde automatique toutes les 2 minutes
        setInterval(saveGame, 120000);

        // V√©rification des arriv√©es toutes les 10 secondes
        setInterval(() => {
            checkArrivals();
            updateDisplay();
        }, 10000);

        // Initialisation
        window.onload = function() {
            loadGame();
        };

        window.onclick = function(event) {
            const modal = document.getElementById('travel-modal');
            if (event.target === modal) {
                closeModal();
            }
        };
    </script>
</body>
</html>